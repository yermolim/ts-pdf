/**
 * Copyright 2021 yermolim
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * 
 * FlateStream class is based on the corresponding one from PDF.js,
 * so the code of that class is also subject to the next license notice:
 * 
 * Copyright 2012 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Copyright 1996-2003 Glyph & Cog, LLC
 * 
 * The flate stream implementation contained in this file is a JavaScript port
 * of XPDF's implementation, made available under the Apache 2.0 open source
 * license.
 */

import{renderTextLayer as t,RenderingCancelledException as e,GlobalWorkerOptions as n,getDocument as r}from"pdfjs-dist";import{v4 as s}from"uuid";import i from"crypto-es";import a from"pako";var o="data:image/png;base64,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",h="data:image/png;base64,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";const c=`\n  <div id="main-container" class="hide-previewer" \n    ondragstart="return false;" ondrop="return false;">\n    <div id="viewer"></div>\n    <div id="previewer"></div>\n    <div id="top-panel"> \n      <div class="subpanel panel-item">\n        <div id="toggle-previewer" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcmlDQ1BpY2MAACiRdZE9S8NQFIbftkpFWwrqIOKQoYpCC0VBHKWCXapDW8GqS3KbtEKShpsUKa6Ci0PBQXTxa/Af6Cq4KgiCIoi4+Af8WqTEc5tCi7Qn3JyH9573cO+5gD+tM8PuSQCG6fBMKimt5tek4Dt8GEQYQ5iSmW0tZRdz6Bo/j1RN8RAXvbrXdYyBgmozwNdHPMss7hDPE6e3HEvwHvEwK8kF4hPiGKcDEt8KXfH4TXDR4y/BPJdZAPyip1RsY6WNWYkbxJPEUUOvsOZ5xE1CqrmSpTxKaww2MkghCQkKKtiEDgdxyibNrLMv0fAto0weRn8LVXByFFEib4zUCnVVKWukq/TpqIq5/5+nrc1Me91DSaD31XU/x4HgPlCvue7vqevWz4DAC3BttvxlmtPcN+m1lhY9BiI7wOVNS1MOgKtdYOTZkrnckAK0/JoGfFwA4TwwdA/0r3uzau7j/AnIbdMT3QGHR8AE1Uc2/gDt82gCvNGYhAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAcpJREFUeNrtWwFuwyAMjBEPWNf8/4XpugesoWMKUppBYidQ5cAnVZWaRtGdDxscoC6Bvu9d7PfRue6sMETJa8MwRC8Slzi6ACkhiEu8FgGWQpiucdBW9FNj5wiWzyvxjOk5/muVm30n8Xfjl8NfkNeEMLHo10Cem/CbyAHeCZMb/sGePfqTfXfh5/Hovu/3F25Lx9ujiURad6WIld1xHDtjTLLshXv8f7Zgka2dY04ClQNCxDmR5eL0Dvi63Vavf16vh1xjzzy13YKUPPQQWFaDHOShBJjX8VzkIRdDa+RDvvBlskoBOOSlVcLURr7KIVCKPIQAJclDJsGc5FkzwdBUqJE8pANykocTIDd59mKI2zIv0Q8oSR7GAaXIQwhQkjx0GVQBGI5xjEWRrTGqkmGjQ0AFUAFUABVABVAB2sXmRMi3pEbnSDLJyNm3h3MAEvnsAqCRZw0Bb/l5Q2THjg1qaghoFVABVAAVQAVQAVQAFUCCI9thxYSJXj5WcspCHaACNNgP+LhcTr+gySqAX/nNX2nP99ujI/aaX3NAbAPDkQ0RSNFfPTUWbkA/QLUVTNoT9RpOj+rJ0aUDJE5AdkDy8LRECEQBUrnsCeUexwK5uUFRAAAAAElFTkSuQmCC"/>\n        </div> \n      </div>\n      <div id="modes" class="subpanel panel-item">\n        <div id="button-mode-text" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIU/N4piFBEtRCxSRLFQCApiKRFMoxYxgq8mu24SIRuX3Q0itoKNRcBCtPFV+A+0FWwVBEERRGz8A74akfVOVohIMsvs/Tgz5zJzBrTJvGG59TGwCp6TTMQjc/MLkcYXQmiE6aQ9bbj21MxEiprj8446VW8HVa/a+6qO8LLpGlDXJDxi2I4nPCY8uebZireFO41celn4UHjAkQMKXyldD/hZcTbgd8VOKjkOmuoZyf5h/Q8bOccS7heOWvmi8XsedZMWszA7I7VbZg8uSRLEiaBTZIU8HoNSC5JZdV+s7JtmVTyG/G3WccSRJSfeAVGL0tWUmhHdlC/Pusr9f55uZngo6N4Sh4Yn33/rhcYd+C75/teR738fQ+gRLgoV/6rkNPoheqmiRQ+gbRPOLiuavgvnW9D1YKeddFkKydQyGXg9hdZ56LiB5sUgq991Tu4htSFPdA17+9An+9uWfgCZXmfbLPy9EwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAtBJREFUeNrlWwtuwjAMra2cALj/CWFHWLYiQKGLEzu282GRqiFo3bznT23PhY1Yl8vl/vd6vW6VFTf5AitZp/P5JQsByPMoHEABr12oAE/d21IWG0+gTuywYrLx2OumR8sOSnmg3LwaONcFiqZT0j4jBngAhoZYVDX/HLbQCfgRWJT6MkVGycefn0tEQO5HS7YJWWwCanI5+y8REKxUu99UEEhzsQO0hFOKK5GFrdrfhT2PQU+RJiVVCdA8WkYA0O4DPTdrHUg5AKUk4AhNzURy0DIqDH4uJB/3sH+mAt+fVPg7Ri+Nx5bonpFtIscrFeZkfFGxeSs5pLLQGfww2Vy3xIXAu9wDO2xMY7bgTQJODF5EQi4Q59zg+B1ODt7FElIS4HQ+v/34dbv1Ah8NrqleW+t14OSad7cEXAi8Cwm4GHgVCRbl8Azgm0igiqagBf/rR+BZCVaKGaor/ZY2l/aEC2reNCaE9LGXtrgy1diM4KuW8Lt/YPcDMqayAniVO+CiZm/mDvhB4JtIwA8DLyYBt3++Qmsw6bUa8wq2FeOoRoTjErkw9io6ZgR/dwGLVHMl8Mf+BzIaCCtYQvOTC5m9tJlJUD22JdVg1h0etQKsCP7lAtyO6mSWYJKwoaQWn4gEs2wVGxOOkSSYpuqaVHgECeZ1ingqy3BTUXl+E/gU3z4aYFEM9bAEc/B38wdonxLrSIJreW5ZDnuQYAaecm3UChjQNDG7B/m/QcoNJiDBXDZ22CiMluM6K1wQDoqgaqb12mMdS/6hcINlFqZDz9z3hVYnIcUVtg9dZmNyveZ+e4En3xpLL+aAfp43G0Fdp8UVsSCOKKWzEyKcbtAKbpAL4hwMotfmDF6vE78252mJr1RYo+G9KfpojHIOiYuwjlalNI3LCwYopFle1ChAky2GI7iOSc4xz+/SVK0+BrlEPH6HwgyR1MebSOBOqVHf/wB4polu0KoYHQAAAABJRU5ErkJggg=="/>\n        </div> \n        <div id="button-mode-hand" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZE9S8NQFIbfpkpFqx3qIMUhQxWHFoqCOEoFu1SHtoJVl+Q2aYQkDUmKFFfBxaHgILr4NfgPdBVcFQRBEURc/AN+LVLiuU2hRdoTbs7De897uPdcQMjqzHD6UoBhunYukxZXi2ti6B0BxDACAVGJOdZSfrGAnvHzSNUUD0neq3dd1xgqKQ4DAgPEs8yyXeJ54uyWa3HeIx5lmlQiPiFO2HRA4luuyz6/cS77/MXZLuQWAIH3FMsdLHcw02yDeIo4buhV1joPv0lYMVfylGO0xuEghwzSECGjik3ocJGkbNLMuvtSTd8yKuRh9LdQg02OMjTyJkitUleFskq6Qp+OGp/7/3k66sy03z2cBvpfPe9zAgjtA4265/2eel7jDAi+ANdm21+hOc19k15va/FjILIDXN60NfkAuNoFxp4tyZaaUpCWoKrAxwUwXASi98Dguj+r1j7On4DCNj3RHXB4BExSfWTjD603Z+Sp2ztrAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGklEQVR42uVbC47jIAytESeY6f1P2NkjLCOqInmoP5g4BChSpLZJAT8/G9sQuDHtfr+Tv/9P6WZp/35+tP6lDsEyXgBg7z0eD3qAVsE9AWgU/s8cOQG+vr+bAOCAiK2Cn9CS4TnwGrTIWYAItw9voGmfo56DJlI1DnD38jx75qGxOvcZRwuuCV++V888zaCmLyUkvlc+S0BE6uZBtBMDKHjYbvnMzVG6Rz0bvbSaByWo+0frR0GQWCSZicSE0Kv93Fm5mAl10V/4PSkrSGpRkgrAUXoatWbq8yVA8ujfFQBOg56UbxXQCoIXACytvUHwBjkepffL+Q0PYGqQseaxw5WWyScDcmyPr6uEYOzdnT3YcTcxwMsBtsTlXv1aVoJwpv0bNH16tDl8FThTmwygXeYSBtn61YAmLn6YlgFW0Bg/UgueatMYWQ+AWRiFQZjSBOql6kwneWlF6MyaA8E+6EqHtUleEQUeMD2ofcJH1QRPS4cno7tp/NjoMGbSIljpL4EfPo3ybwzAOzd5aRC0DSOTllEgBEPykBSAlmzBkjkhILyWJLb2Vy7qP54heW89oGu/rgiEKskiRdGETyurBUr7L08L0sA9FdhpTYBaZopmpMKjBwjO+5KiuVD9xVYPSuzXTRdAtdQRc90TnyMIBxBetuHib+jQxjYgPNnQ68m3igOsjm0nEALl4Q2BzvIgRC3Qwaewciu5A9pzr4sM65nAQRYszYioxPzqQUXsDzJbOMZMDwAX6GQB6vM522WDStKzdYt1HlCzQNrBXZEROAxuDYS2YUGtrAwGmw1+SmsNhdMm2n87Wxha1/PdvH/xa8GQg69eEL3ufMBszg+zPBjD2jRwgmfavv7CxC7rvqbcgA89E4cKYQNfkCTlDt0XmGDZezNt1QmuGBgJwvNvjeE/t5Siy3ncq/f9LcJTrA1Wp7GAQ2SFJ0+ItGx5C0XQNJPmhYIuiG+Otm5P9QzQypwjpmSlPR4TNDoTr6iRA40+ak/l95QD1+RaemdIE96UDqMDCUuBYBW+lhM0O1VC4nQl/SkW1MJrcvwCJhH28gf87HUAAAAASUVORK5CYII="/>\n        </div> \n        <div id="button-mode-annotation" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIU/N4piFBEtRCxSRLFQCApiKRFMoxYxgq8mu24SIRuX3Q0itoKNRcBCtPFV+A+0FWwVBEERRGz8A74akfVOVohIMsvs/Tgz5zJzBrTJvGG59TGwCp6TTMQjc/MLkcYXQmiE6aQ9bbj21MxEiprj8446VW8HVa/a+6qO8LLpGlDXJDxi2I4nPCY8uebZireFO41celn4UHjAkQMKXyldD/hZcTbgd8VOKjkOmuoZyf5h/Q8bOccS7heOWvmi8XsedZMWszA7I7VbZg8uSRLEiaBTZIU8HoNSC5JZdV+s7JtmVTyG/G3WccSRJSfeAVGL0tWUmhHdlC/Pusr9f55uZngo6N4Sh4Yn33/rhcYd+C75/teR738fQ+gRLgoV/6rkNPoheqmiRQ+gbRPOLiuavgvnW9D1YKeddFkKydQyGXg9hdZ56LiB5sUgq991Tu4htSFPdA17+9An+9uWfgCZXmfbLPy9EwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAhxJREFUeNrtW1lywyAMtRhO0OT+J3SaHqCxanfijsuAEQaEWDTjn2CM3kMbS2ByyP1+R9vvC+IkVRSAs22eZ2sjUIHXToCLCKACb4UAkwg1dS7gm32X78TIOp45RhZw73FOsWlO4NzyJhbOiFC22W8BPDXgdxEDNktwuZmWPvtmvAiR79dr+no+/2EzLV7nVCBFgLOl3WVZJqWUM+3tfbZ3fKJrNu0UNYmOncFYCwktdDbQlJlNRkBp+Xw8Tts/brcoq4H1A2gMSAmCUuthr+4m3iu2hIINJli37tcCKoeZSXaB4CDoiPLkgWxZ5Opi6Czg7cHSfMcXRKtxAQp4LhdoBnwVBOQEX3UWSAF+FEKbBWxMBrLZVCG0d/p9THZ87wt9KBbw94ClU9MuYOquMw7UbCnc/VpgEDAIaEhitsQ4MgFItQCuNIjDBYQSwFUHgOQYAD1bwEiDzRBw3HEJPWWpUUyMuhfgLhJ0dyZvHKnrkKtlIwgOAgYB7RNAvTJbo9iwjauyLmZauyzpwqh9HWonwufScMX3z66nHc7pkxK3fhcpVSu1rslyXf54xLYrnBK8OUbS/YCdkZRZYFM81hJSEmlzaedd4VRExJCQEjz5P0MJBH3xhvk7/jQokATk0jdnirsKAjl1zZ3jQ8Egt54cRQ4VFJbQkavK84HDUvpxlrkoUTfuOh+l6VVioYOSdCq50kNBuhQloegO1A9Y7hjyBIja5wAAAABJRU5ErkJggg=="/>\n        </div> \n        <div class="panel-v-separator margin-s-5 panel-item"></div>\n        <div id="button-download-file" class="panel-button panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABbmlDQ1BpY2MAACiRdZG9S0JRGMZ/amGY4VBDRIODhYRCFERjGORiDWqQ1aLXr8CPy71KSGvQ0iA0RC19Df0HtQatBUFQBBEt/QN9LSG392RghJ7Lue+P55zn5ZzngD1S0Ipm1zgUSxUjGg55lxLLXucLDly4GcOf1Ex9PjYXp+P4vMOm6m1Q9eq8r+3oTWdMDWw9wlOablSEZ4Qj6xVd8bbwgJZPpoUPhQOGHFD4SumpJj8rzjX5XbERj86CXfX05v5w6g9reaMo7Bf2FQtV7fc86ibuTGkxJnVI5jAmUcKE8JKiyhoFKgSlliSz9r7xH98CZfFo8tepYYgjR168AVGr0jUjNSt6Rr4CNZX7/zzN7OREs7s7BN1PlvU2As4daNQt6+vIshrH4HiEi1LLX5acpj9Er7c03wF4NuHssqWlduF8CwYf9KSR/JEcMu3ZLLyeQl8C+m/AtdLM6nedk3uIb8gTXcPePozKfs/qNw5zaBHJcPVKAAAACXBIWXMAAAsTAAALEwEAmpwYAAADIUlEQVR42u1bPY7UMBS2PZYQotmdTMMhqFhKGsR23IN6F1pEg7bj5xZUnICSluEAXIBmnEkFQsomPId45bGcxEnsTJ4nT7I0cX7s73u/diaUNMhms7H2F2VJ+kgqhK3b9hBqu3CdJM5jMUobz+12O2s/dwWOXRQukwgeO/AuIhg5caFd2m/ynZHiHAN8aLsNG58Y+KSiMLQRwWwnYwDvaiEnEQOkQp3T4Ny0PyY75be3JNvvD7CZz+MhJ+CDUFvhVRQFYYw1Fj7qHnlNl3DMpt23KrUGQUyAlcZdNOsqR7EAWd/rawTz2GEtMWitYLMa7sOMhpIwh2egcQEzGPsAj4oAPZv4Ao9yMdQGXsULmSajJMAFfN8swWIDH6ULhAKPgoCQ4FEGQZ/gnSrBOe4N+AKP0gJ8gkdHgG/wzouhMXsCvlwoBHg0FhAKPAoCQoJHnQYXAhwspnRYFPEYtdrHbRYXWAhYCFgIWAhYCDhhGV0H5Hn+iDF2Qyh9UedgGmqy6yT5/xanLL+lafpMDu/DAkqjmYNWr5NUU+/aVaOUfqnBi4NJhgIvhdKnSZK8HPioA7zjXYCxz/WvxDpZ3+DvOKBfZxED9kK8BZN87zJpX+DlsGB9PychQNbV8rW0anJzRG/VNWn6OgQJlvv3MIfHMKf17LKAbxJs9wH456D5H7NNgxUJhHwYS0KD5i98gw9SB4B5vhpDgpbq/mqavwTwWzSFUE0C6UuCOl8UxR8I8/e0gBcEfNBKUBZEBSEfXUnQ+6Gwul9r/sJnwAtSCXZsmV/nUDwBy1e1Zn8BuIct12fQztTvkJqfbC2QCXGtLKEDPKnBZ7Xmz6NZDOkk2ERahpHqtmQimWw1KEkAJ/9kr6Yry8hgFfUkNHi9qKua2RFSoGy+aiIBRr4UQnyPfj9AkmA3kOnBH21DRKZIsIR34Pu/pwx4gwg4O/c/N5k6V5S+4avVAzjcHvODLdtncyUEortgoP/fHrtIbLNwgTkJ07XdxlSM2pfYedcNNoKwAzfSb3+tH+sv9q6FjosoxS5fjg7xf8wWYLo0HeI7GAloimX/ANBjieJDfrkhAAAAAElFTkSuQmCC"/>\n        </div> \n      </div>\n    </div>\n    <div id="bottom-panel" class="disabled">\n      <div id="paginator" class="subpanel panel-item">\n        <div id="paginator-prev" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="paginator-next" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <input id="paginator-input" type="text">\n        <span>&nbsp/&nbsp</span>\n        <span id="paginator-total">0</span>\n      </div>\n      <div class="panel-v-separator panel-item"></div>\n      <div id="zoomer" class="subpanel panel-item">\n        <div id="zoom-out" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-in" class="panel-button">\n          <img src="data:image/png;base64,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"/>\n        </div>\n        <div id="zoom-fit-viewer" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVR42u2bMW/EIAyFA7qla5Ol///HdUm6dguFKlQuBwnh7ADKs5TlTsrxPp6NAZ16H0czCMTXsijO90mNUw83DwC4OwAV5hZ37rYWoV6kAAAAAAAAAAAAAAAAAAAAAADcMh6CO63F7iwnkR2cUmqe57YcEIq3zyg4cWaapnYARM7rRjtLYupXY9ggaAHxzqKDtSgbAXdIkwBqqgK4QryP8J3OBe6xLjBVAFwpnjoh9rmDUJoOuhfxqXTwTiitCbon8WE6ROrCaQi6N/GxdFjX9XtzwWkIukS8/cHPmuKfnKD1W6kTdMnM2x/8qC0+VhNIPciGoEts7+nb75ro53cm4nCJ3L0ZkrqRvWSXRwokBZR9M9SzeJoOR82SziHYe5C6kA/A2cZB8E/PsXfh+zgqLt4+DgIl2cotsivEdizJlD0aZ84ymOy/G5nd5FhyJukQwHby8td60jW3hULpxP8Wu605O+vQrEaIQqDtZ20nePG+OStJz+xW+MkJpP2s4QQqvmTmizZDUSdsg7jSCVzii7bDHkK4PF5VEzjFFx+IOAip/lsSArf4YgCxZkl6iZQQ/zKAVJ/AnQ5S4lkA0Jog3Msv3OK5HBBdHZjj300TZxvOdjcoCYHrjlHMAT0HAAAAAAAAAAAAAAAAAAAAANwzFP47jBQAgFvHDyRnPtj60cBDAAAAAElFTkSuQmCC"/>\n        </div>\n        <div id="zoom-fit-page" class="panel-button">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABcWlDQ1BpY2MAACiRdZG9S8NQFMVPW8Wi1Q46SHHIUMWhhaIgjlLBLtWhrWDVJXlN2kKShpcUKa6Ci0PBQXTxa/A/0FVwVRAERRBx8R/wa5ES72sKLdLe8PJ+nHfP5eUE8Kd1Zth9CcAwHZ5JJaW1/Lo08A4fRhBEHBGZ2dZydimHnvXzSN1UD3Exq3df1xoqqDYDfEHiOWZxh3iBOL3lWIL3iMdYSS4QnxDHOF2Q+Fboisdvgosefwnmucwi4BczpWIHKx3MStwgniaOGnqVte4jviSkmqtZ2iO0JmAjgxSSkKCgijJ0OJRLGSZl1t2XaPpWUCEPo7eFGjg5iiiRN0ZqlaaqtGukq/ToqInc/+dpa7Mz3vRQEuh/dd3PSWBgH2jUXff31HUbZ0DgBbg22/4K5TT/TXq9rUWPgfAOcHnT1pQD4GoXGH+2ZC43pQAtv6YBHxfAcB4YvQcGN7ysWuc4fwJy2/SL7oDDI2CK+sObf/JNaAQfxWcoAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB30lEQVR42u2bzXKDIBCAw+ql6cnqpQ/Q93+f9gF60aan9GKwmkqHsXZA5Wd3YWcyySFO+D4WCLKKU+R4qush5u/DKfHIAlIXIFIDXs45eQhkAYlHiaUhTdMMcvgZniDcTE397Xb9vFweKQgoFfwU+ue1kFJ+AcDDf6J+RQKcqWRAv+cikyhqc4Ax71WPT73Pbg746Lpd/0uO7iVIrwIuNlJkBIyrhJddJBkBbdt62UIDp7Qf5xExL5PvLAXYwM+rxDM7AbbwLIeAL3gSAnzCoxfgGx61gBDwaAWEgkcpICQ8OgGh4VEJiAGPRkAseBQCPMF3JAQo+LV7e3vh9esGKd9M3xeppT2Kk6GYY/5PBiwb47sBmOCDZwA2eCsBVVW9Tg0fX63TsadNfLHgrQQIgBebHtza8+pQIyb81iFQc0n7YHMAdnivAijAexNABd6LAErwzgVQg3cqgCK8MwFU4Z0IoAx/WAB1+EMCOMBvEqAfOXOB3yRAHTlzgne6DOrwy3IW9gKWPa+Xs7AXQDHt9ThcJ7h2p8eiglPMdYF85oCpfvf+ble+OpDMAFNx8o7f7tELGHv2WhbF2SQGisJYv7soh+9JZICp3p565EdmsoDEQ8R+dpfSwUgeAlkAw/gGgdL3j4c6UpkAAAAASUVORK5CYII="/>\n        </div>\n      </div>\n    </div>\n    <div id="annotation-panel">\n      <div class="annotation-panel-row">\n        <div id="button-annotation-delete" \n          class="panel-button annotation-panel-subitem">\n          <img src="${h}"/>\n        </div> \n        <div id="button-annotation-mode-select" \n          class="panel-button annotation-panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIW/JIpioim0ELHYIgaLCKIglhJBG7WIEYzabDabRNjEZTdBgq1gYyFYiDa+Cv+BtoKtgiAogoiNf8BXI2G9Y4SImFlm78eZOZeZM+CfsoyC2zQIhWLJSUzGtfnUgtbyTIAQHQSJ6oZrT89OJGk4Pm7xqXozoHo13vfvCGZM1wBfq/CIYTsl4THhqdWSrXhTuMvI6xnhA+GYIwcUvlR6usZPinM1flPsJBPj4Fc9tdwvTv9iI+8UhPuFIwWrbPycR90kZBbnZqX2yOzFJcEkcTTSlFnGosSA1KJk9r9v8Ns3w4p4DPnbVHDEkSMv3pioZelqSs2KbspnUVG5/83TzQ4P1bqH4tD86HmvfdCyDdUtz/s89LzqEQQe4LxY969ITqPvom/Vtcg+hNfh9KKupXfgbAO6723d0b+lgEx/NgsvJ9Cegs5raFusZfWzzvEdJNfkia5gdw+isj+89AXPlWf0rTeiAwAAAAlwSFlzAAALEwAACxMBAJqcGAAAA0dJREFUeNrlWwmO5CAMjBEv2On/v7BnnjDeZhUkixgfQELIIkXqzgG4XD64YKuU1+vF3v9F3Dzl5/vbVX9PewGg+uz9frP3wduxskMVAdHSlgeImgB/vr5MANTqid6OGAoK92GbXLKcGYgwuH7sfH55iZr2a9TrBAmkdjxsrPkYrZ70LLUZBwpes3vUQCjbSv+5zpf05YSkz/JvCYjAPRykdZCcX6vtWjTrqTOeZPtgZMIQQDTFSUwIrdpPlY2IHFqnRxauzrDNKzhKwz2hPFxA/22UL7AI6AVhJgOGULrXVOJoRK8UvhY2c4zXwuQ/BqTcnl53FHB09KCgTDeBGsPOYl5pNuHJmr7ECVobKqnXo+GRoIWRdmUNU/m9VhBGmkeYaecjtcy9Lw2oLgWgFq8/93BPpNjrrDR5ehRwJDBIQDqFlXGG8C3ffDqMwrfQCkLs7fBVmaLSD2wF4w5jAahcbpB306qaDAfi5SZAhfl0SJoqB6pdmt9bTWYTpt1cANxlQLSDAJY5hV1g1TSWHg5z5qL4iQNgkU4rJ9oI2gZrsjEJiEx70VSSj/i8BwcG5I8lBBWAblO0PlJHGYzCl0B0aarQWjVR2jUJLSGucKTDw2BTZrYLBVR4ia4EHI+tm/xEdpKB0z7pJAidw22tYosCOcxkzaT/QrzGM+21IW3WzAVcY4Fi4hFmaN0DAuMzDiXtJ6D7CMIIGq1W6ORvaNDGY0BIV2ik5CNAYBlgsfMngRA4D+9IdJYHIQqJDmSvSUseO5Clp+Fr/5ebQCcLlmZEVHJ+0NYLqT9IbKkx5vYA1BKdJMCoFZ0losCIQc+yJsCxgNuadsMJEbvGSRpsTYQew4LDstgHjOpo8H8p1lQYH6L9w4auYI3nT/P+2a8FxxgcFwcBe0zgUc6Psjw401q8sINn2r5+YOIpcV9TbqD7e5hNhfAAX4CScmNHpbCA3auHt1QnuGJiJAhfPzVGP7ZMRe9bVuCsjY5nCM+xNnidxgIOsSo8e2DCsuQtTILinTQvTOiCeHLUujzV0oCVOT2m5KU9bRM0OjNH1NiGZm21V84LgybX0itDmvCu4bB19+YKiyKS8KWcoNmpkhLjTPpzLCiF1+T4C+eX+V1keq0EAAAAAElFTkSuQmCC"/>\n        </div> \n      </div>\n      <div class="annotation-panel-row">\n        <div id="button-annotation-mode-stamp" \n          class="panel-button annotation-panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIW/JIpioim0ELHYIgaLCKIglhJBG7WIEYzabDabRNjEZTdBgq1gYyFYiDa+Cv+BtoKtgiAogoiNf8BXI2G9Y4SImFlm78eZOZeZM+CfsoyC2zQIhWLJSUzGtfnUgtbyTIAQHQSJ6oZrT89OJGk4Pm7xqXozoHo13vfvCGZM1wBfq/CIYTsl4THhqdWSrXhTuMvI6xnhA+GYIwcUvlR6usZPinM1flPsJBPj4Fc9tdwvTv9iI+8UhPuFIwWrbPycR90kZBbnZqX2yOzFJcEkcTTSlFnGosSA1KJk9r9v8Ns3w4p4DPnbVHDEkSMv3pioZelqSs2KbspnUVG5/83TzQ4P1bqH4tD86HmvfdCyDdUtz/s89LzqEQQe4LxY969ITqPvom/Vtcg+hNfh9KKupXfgbAO6723d0b+lgEx/NgsvJ9Cegs5raFusZfWzzvEdJNfkia5gdw+isj+89AXPlWf0rTeiAwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAZBJREFUeNrtmlGOwyAMRDOoJ9jm/idM9wjrzVZaKWpDoBI2YzBSf6oqeB5jjGmWZfKBDnMKU0wgEd0tPpAKN4sTDsSrxgqyPDffH2AoHp2eYwqgddDqEEAs3gQCyMWrPz85KbHUZVA6VxewOsDFSOTWV392UrAkW3Nl6gCL5grMKSDsK94aAAhSIKpAACADIF7yvxUAeM3/SAFFAOIltRKLFXvNqZkCwr76sQc0BgBv9rdwgDDbP1Ig2uFwQAAIAI46QZU5wgEOdmzEHuAEgOV/BMJk0VxAFu8eQA3Auq6nlH/k/evvx+Ptu6/7van6mjkS8jy2bUMVgJzwKwCvAbYWXzvHFYAcCNQKLwGg2NBQnxH/IKavAiitfi53vIySttuowo86dgjZ0okzQqOIP7ggW0qn2AP2BX1+sifB4w9GW/2Ss3FiC4zshteUjzK4n6jk7Jg5w/g7TWLheNNr2AsRfgBajYunFOh1qdG9BYgUCAABIADcPuymnsPLrVCuAQoHXABAafWd3gNM0+x9PH4BvDJ3ZJJMpIIAAAAASUVORK5CYII="/>\n        </div> \n      </div>\n      <div class="annotation-panel-row">\n        <div id="button-annotation-pen-undo" \n          class="panel-button annotation-panel-subitem">\n          <img src="data:image/png;base64,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"/>\n        </div> \n        <div id="button-annotation-pen-clear" \n          class="panel-button annotation-panel-subitem">\n          <img src="${h}"/>\n        </div> \n        <div id="button-annotation-pen-save" \n          class="panel-button annotation-panel-subitem">\n          <img src="${o}"/>\n        </div> \n        <div id="button-annotation-mode-pen" \n          class="panel-button annotation-panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIW/JIpioim0ELHYIgaLCKIglhJBG7WIEYzabDabRNjEZTdBgq1gYyFYiDa+Cv+BtoKtgiAogoiNf8BXI2G9Y4SImFlm78eZOZeZM+CfsoyC2zQIhWLJSUzGtfnUgtbyTIAQHQSJ6oZrT89OJGk4Pm7xqXozoHo13vfvCGZM1wBfq/CIYTsl4THhqdWSrXhTuMvI6xnhA+GYIwcUvlR6usZPinM1flPsJBPj4Fc9tdwvTv9iI+8UhPuFIwWrbPycR90kZBbnZqX2yOzFJcEkcTTSlFnGosSA1KJk9r9v8Ns3w4p4DPnbVHDEkSMv3pioZelqSs2KbspnUVG5/83TzQ4P1bqH4tD86HmvfdCyDdUtz/s89LzqEQQe4LxY969ITqPvom/Vtcg+hNfh9KKupXfgbAO6723d0b+lgEx/NgsvJ9Cegs5raFusZfWzzvEdJNfkia5gdw+isj+89AXPlWf0rTeiAwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAaNJREFUeNrlm0sOgzAMRHHEEbj/CbmDq7Ko2opWxBk79pBNuwCTN/4lCshSc+jbfxkxJMXhhzmEAH6IRUjgzTxCBG9iaoXhBSBW+gi4Aq8jbELiebMIQhL2ZhGEBN58rxDBm2wIGXy3LSGE77LZSOEv399I4S8viORm8GlqQDR8qjaYBn5GDZie8zMjIEXOzxIgJXyUAGnhIwRIDe8tQHp4TwFKwHsJUAbeQ4BS8GgBysEjBSgJf2pk27bjd993evjnWL/B7+J5xGaoPPxLAIP3KeCtEUADfxg+8/6fAkgF3xsBdPCnAvzwPiX8Rxsk8Tz8bDAzPOStkdUw8dnwipxf73l7NnjxqgG6+AwFpSKsQDYQQEl49EqwHPw/g8iXEhHwbmsCj91gGfgeAQSYDqneS2oArym4jWqkWM2hZmgV+F8PUcM1iLDXGWnSgMKhcj60RvTsBTwLni6ThjhOxgIf3iHWIFFTwp89VIPAU8BbIqDiV2bDAngfoU8VVYInqdkiKmpTolnTCXEuUBbeskTtTZ30RTRqpZa2eyA/R6FvmZTjAXQIhaMv+ge0AAAAAElFTkSuQmCC"/>\n        </div> \n      </div>\n      \x3c!--\n      <div class="annotation-panel-row">\n        <div id="button-annotation-mode-geometric" \n          class="panel-button annotation-panel-item">\n          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABb2lDQ1BpY2MAACiRdZE7SwNBFIW/JIpioim0ELHYIgaLCKIglhJBG7WIEYzabDabRNjEZTdBgq1gYyFYiDa+Cv+BtoKtgiAogoiNf8BXI2G9Y4SImFlm78eZOZeZM+CfsoyC2zQIhWLJSUzGtfnUgtbyTIAQHQSJ6oZrT89OJGk4Pm7xqXozoHo13vfvCGZM1wBfq/CIYTsl4THhqdWSrXhTuMvI6xnhA+GYIwcUvlR6usZPinM1flPsJBPj4Fc9tdwvTv9iI+8UhPuFIwWrbPycR90kZBbnZqX2yOzFJcEkcTTSlFnGosSA1KJk9r9v8Ns3w4p4DPnbVHDEkSMv3pioZelqSs2KbspnUVG5/83TzQ4P1bqH4tD86HmvfdCyDdUtz/s89LzqEQQe4LxY969ITqPvom/Vtcg+hNfh9KKupXfgbAO6723d0b+lgEx/NgsvJ9Cegs5raFusZfWzzvEdJNfkia5gdw+isj+89AXPlWf0rTeiAwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAeNJREFUeNrlm2uOwjAMhDsWJ4De/4bsEfD+WGm3QqTNw54460hIBbWNP2ec2G3Alq/p4RhIDP/jgczwmRyghd9NQ0AbzkUEeAtD1MBAzIIf6VwdjAUbvqdTJUgWLPjWztQAQAlO0JZ7wgAeTnMIvOFrOlFSzFr0oz3Xw/qGrNi1shWB4Hv7HrJVAiYvICjm9EQNkjJf2WGiUgSFv7LHLERlW6+Zzk8IPPotyVO3nRKkYhuBG7JTiDl+yLpBssV8rQMQHN5UQp6TX/TQgqw8ehY2SmD5U5psydst0JJVM9urgVo1ogKmld+SGT6CA6bCz3bAdPiSAzQL/CwFWD/4HHYAFpU9VlPACLyyQ4CVx09Pu+XEEA0MD28FRBp5ZSiAqYJReDDmgH+zzrc6wEIFVvCUx/S1D0SUHK+0dxRiMLIMeHoq3PoqWo3A6XPHaP6NzX/vkOvuMa809JNj0OFc9xXq1jByq+wSc00pV9knWM0g+77/fjkeTzAOMxKlCApgQzfPAbUZngaGLucB98fDKr3F26ck8VD1AIzga64L+cpdnOCXaZIZ/swBKeBLDkgD/8kBqeDfHZAO/uiAlPBX9TxKNcJL/y75ej5nFk5uq0CajVKXD0UrKsTlQ+AoV9afF8PwfwNGBXNgWGrhCQAAAABJRU5ErkJggg=="/>\n        </div> \n      </div>\n      --\x3e\n    </div>\n  </div>\n`,d=`\n    <div class="form">\n      <input id="password-input" type="password" maxlength="127"/>\n      <div class="buttons">\n        <div id="password-ok" class="panel-button">\n          <img src="${o}"/>\n        </div>\n        <div id="password-cancel" class="panel-button">\n          <img src="${h}"/>\n        </div>\n      </div>\n    </div>\n`;function l(){return s()}function p(t,e,n,r){return Math.hypot(n-t,r-e)}class u{constructor(t){this.data=t}}class f{constructor(t){this._length=0,t&&this.push(t)}get head(){return this._head.data}get length(){return this._length}get tail(){return this.get(this._length-1)}push(t){const e=new u(t);let n;if(this._head){for(n=this._head;n.next;)n=n.next;n.next=e}else this._head=e;this._length++}insert(t,e){if(e<0||e>this._length-1)return null;const n=new u(t);let r,s=this._head,i=0;if(e){for(;i++<e;)r=s,s=s.next;r.next=n}else this._head=n;return n.next=s,this._length++,n.data}replace(t,e){if(e<0||e>this._length-1)return null;const n=new u(t);let r,s=this._head,i=0;if(e){for(;i++<e;)r=s,s=s.next;r.next=n}else this._head=n;return n.next=s.next,s.data}remove(t){if(t<0||t>this._length-1)return null;let e,n=this._head,r=0;if(t){for(;r++<t;)e=n,n=n.next;e.next=n.next}else this._head=n.next;return this._length--,n.data}clear(){this._head=null,this._length=0}get(t){if(t<0||t>this._length-1)return null;let e=this._head,n=0;for(;n++<t;)e=e.next;return e.data}pop(){return this.remove(this._length-1)}has(t,e){if(!this._length)return!1;e||(e=(t,e)=>t===e);let n=this._head,r=0;for(;r<this._length;){if(e(t,n.data))return!0;n=n.next,r++}return!1}findIndex(t,e){if(!this._length)return-1;e||(e=(t,e)=>t===e);let n=this._head,r=0;for(;r<this._length;){if(e(t,n.data))return r;n=n.next,r++}return-1}*[Symbol.iterator](){let t=this._head;for(;t;)yield t.data,t=t.next}}function g(t,e,n){return Math.max(e,Math.min(t,n))}class A{constructor(t=0,e=0){this.length=2,this.x=t,this.y=e}static multiplyByScalar(t,e){return new A(t.x*e,t.y*e)}static addScalar(t,e){return new A(t.x+e,t.y+e)}static normalize(t){return(new A).setFromVec2(t).normalize()}static add(t,e){return new A(t.x+e.x,t.y+e.y)}static substract(t,e){return new A(t.x-e.x,t.y-e.y)}static dotProduct(t,e){return t.x*e.x+t.y*e.y}static applyMat3(t,e){return t.clone().applyMat3(e)}static lerp(t,e,n){return t.clone().lerp(e,n)}static rotate(t,e,n){return t.clone().rotate(e,n)}static equals(t,e,n=6){return t.equals(e)}static getDistance(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}clone(){return new A(this.x,this.y)}set(t,e){return this.x=t,this.y=e,this}setFromVec2(t){return this.x=t.x,this.y=t.y,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this}addScalar(t){return this.x+=t,this.y+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return A.dotProduct(this,t)}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:n}=this,[r,s,,i,a,,o,h]=t;return this.x=e*r+n*i+o,this.y=e*s+n*a+h,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this}rotate(t,e){const n=Math.sin(e),r=Math.cos(e),s=this.x-t.x,i=this.y-t.y;return this.x=s*r-i*n+t.x,this.y=s*n+i*r+t.y,this}equals(t,e=6){return+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)}toArray(){return[this.x,this.y]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y}}class m{constructor(t=0,e=0,n=0){this.length=3,this.x=t,this.y=e,this.z=n}static multiplyByScalar(t,e){return new m(t.x*e,t.y*e,t.z*e)}static addScalar(t,e){return new m(t.x+e,t.y+e,t.z+e)}static normalize(t){return(new m).setFromVec3(t).normalize()}static add(t,e){return new m(t.x+e.x,t.y+e.y,t.z+e.z)}static substract(t,e){return new m(t.x-e.x,t.y-e.y,t.z-e.z)}static dotProduct(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static crossProduct(t,e){return new m(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static onVector(t,e){return t.clone().onVector(e)}static onPlane(t,e){return t.clone().onPlane(e)}static applyMat3(t,e){return t.clone().applyMat3(e)}static lerp(t,e,n){return t.clone().lerp(e,n)}static equals(t,e,n=6){return!!t&&t.equals(e,n)}static getDistance(t,e){const n=e.x-t.x,r=e.y-t.y,s=e.z-t.z;return Math.sqrt(n*n+r*r+s*s)}static getAngle(t,e){return t.getAngle(e)}clone(){return new m(this.x,this.y,this.z)}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}setFromVec3(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}multiplyByScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getAngle(t){const e=this.getMagnitude()*t.getMagnitude();if(!e)return Math.PI/2;const n=this.dotProduct(t)/e;return Math.acos(g(n,-1,1))}normalize(){const t=this.getMagnitude();return t&&(this.x/=t,this.y/=t,this.z/=t),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}substract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}dotProduct(t){return m.dotProduct(this,t)}crossProduct(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x,this}onVector(t){const e=this.getMagnitude();return e?t.clone().multiplyByScalar(t.clone().dotProduct(this)/(e*e)):this.set(0,0,0)}onPlane(t){return this.substract(this.clone().onVector(t))}applyMat3(t){if(9!==t.length)throw new Error("Matrix must contain 9 elements");const{x:e,y:n,z:r}=this,[s,i,a,o,h,c,d,l,p]=t;return this.x=e*s+n*o+r*d,this.y=e*i+n*h+r*l,this.z=e*a+n*c+r*p,this}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this}equals(t,e=6){return!!t&&(+this.x.toFixed(e)==+t.x.toFixed(e)&&+this.y.toFixed(e)==+t.y.toFixed(e)&&+this.z.toFixed(e)==+t.z.toFixed(e))}toArray(){return[this.x,this.y,this.z]}toIntArray(){return new Int32Array(this)}toFloatArray(){return new Float32Array(this)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class w{constructor(){this.length=9,this._matrix=new Array(this.length),this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1}get x_x(){return this._matrix[0]}get x_y(){return this._matrix[1]}get x_z(){return this._matrix[2]}get y_x(){return this._matrix[3]}get y_y(){return this._matrix[4]}get y_z(){return this._matrix[5]}get z_x(){return this._matrix[6]}get z_y(){return this._matrix[7]}get z_z(){return this._matrix[8]}static fromMat3(t){return(new w).setFromMat3(t)}static multiply(t,e){const[n,r,s,i,a,o,h,c,d]=t._matrix,[l,p,u,f,g,A,m,y,v]=e._matrix,x=new w;return x.set(n*l+r*f+s*m,n*p+r*g+s*y,n*u+r*A+s*v,i*l+a*f+o*m,i*p+a*g+o*y,i*u+a*A+o*v,h*l+c*f+d*m,h*p+c*g+d*y,h*u+c*A+d*v),x}static multiplyScalar(t,e){const n=new w;for(let r=0;r<this.length;r++)n._matrix[r]=t._matrix[r]*e;return n}static transpose(t){const e=new w;return e.set(t.x_x,t.y_x,t.z_x,t.x_y,t.y_y,t.z_y,t.x_z,t.y_z,t.z_z),e}static invert(t){const e=new w;e.set(t.y_y*t.z_z-t.z_y*t.y_z,t.y_x*t.z_z-t.z_x*t.y_z,t.y_x*t.z_y-t.z_x*t.y_y,t.x_y*t.z_z-t.z_y*t.x_z,t.x_x*t.z_z-t.z_x*t.x_z,t.x_x*t.z_y-t.z_x*t.x_y,t.x_y*t.y_z-t.y_y*t.x_z,t.x_x*t.y_z-t.y_x*t.x_z,t.x_x*t.y_y-t.y_x*t.x_y),e.set(e.x_x,-e.x_y,e.x_z,-e.y_x,e.y_y,-e.y_z,e.z_x,-e.z_y,e.z_z);const n=t.x_x*e.x_x+t.x_y*e.x_y+t.x_z*e.x_z,r=new w;if(n){const t=.1;r.set(t*e.x_x,t*e.y_x,t*e.z_x,t*e.x_y,t*e.y_y,t*e.z_y,t*e.x_z,t*e.y_z,t*e.z_z)}else r.set(0,0,0,0,0,0,0,0,0);return r}static buildScale(t,e){return null!=e||(e=t),(new w).set(t,0,0,0,e,0,0,0,1)}static buildRotation(t){const e=Math.cos(t),n=Math.sin(t);return(new w).set(e,-n,0,n,e,0,0,0,1)}static buildTranslate(t,e){return(new w).set(1,0,0,0,1,0,t,e,1)}static equals(t,e,n=6){return t.equals(e,n)}clone(){return(new w).set(this.x_x,this.x_y,this.x_z,this.y_x,this.y_y,this.y_z,this.z_x,this.z_y,this.z_z)}set(t,e,n,r,s,i,a,o,h){return this._matrix[0]=t,this._matrix[1]=e,this._matrix[2]=n,this._matrix[3]=r,this._matrix[4]=s,this._matrix[5]=i,this._matrix[6]=a,this._matrix[7]=o,this._matrix[8]=h,this}reset(){return this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=1,this._matrix[5]=0,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=1,this}setFromMat3(t){for(let e=0;e<this.length;e++)this._matrix[e]=t._matrix[e];return this}multiply(t){const[e,n,r,s,i,a,o,h,c]=this._matrix,[d,l,p,u,f,g,A,m,w]=t._matrix;return this._matrix[0]=e*d+n*u+r*A,this._matrix[1]=e*l+n*f+r*m,this._matrix[2]=e*p+n*g+r*w,this._matrix[3]=s*d+i*u+a*A,this._matrix[4]=s*l+i*f+a*m,this._matrix[5]=s*p+i*g+a*w,this._matrix[6]=o*d+h*u+c*A,this._matrix[7]=o*l+h*f+c*m,this._matrix[8]=o*p+h*g+c*w,this}multiplyScalar(t){for(let e=0;e<this.length;e++)this._matrix[e]*=t;return this}transpose(){const t=(new w).setFromMat3(this);return this.set(t.x_x,t.y_x,t.z_x,t.x_y,t.y_y,t.z_y,t.x_z,t.y_z,t.z_z),this}invert(){const t=new w;t.set(this.y_y*this.z_z-this.z_y*this.y_z,this.y_x*this.z_z-this.z_x*this.y_z,this.y_x*this.z_y-this.z_x*this.y_y,this.x_y*this.z_z-this.z_y*this.x_z,this.x_x*this.z_z-this.z_x*this.x_z,this.x_x*this.z_y-this.z_x*this.x_y,this.x_y*this.y_z-this.y_y*this.x_z,this.x_x*this.y_z-this.y_x*this.x_z,this.x_x*this.y_y-this.y_x*this.x_y),t.set(t.x_x,-t.x_y,t.x_z,-t.y_x,t.y_y,-t.y_z,t.z_x,-t.z_y,t.z_z);if(this.x_x*t.x_x+this.x_y*t.x_y+this.x_z*t.x_z){const e=.1;this.set(e*t.x_x,e*t.y_x,e*t.z_x,e*t.x_y,e*t.y_y,e*t.z_y,e*t.x_z,e*t.y_z,e*t.z_z)}else this.set(0,0,0,0,0,0,0,0,0);return this}getDeterminant(){const[t,e,n,r,s,i,a,o,h]=this._matrix;return t*s*h-t*i*o+e*i*a-e*r*h+n*r*o-n*s*a}getTRS(){const t=new A(this.z_x,this.z_y),e=Math.sqrt(this.x_x*this.x_x+this.x_y*this.x_y),n=Math.sqrt(this.y_x*this.y_x+this.y_y*this.y_y),r=new A(e,n),s=Math.atan(-this.x_y/this.x_x),i=Math.acos(this.x_x/e);let a;return a=i>Math.PI/2&&s>0||i<Math.PI/2&&s<0?2*Math.PI-i:i,{t:t,r:a,s:r}}equals(t,e=6){for(let n=0;n<this.length;n++)if(+this._matrix[n].toFixed(e)!=+t._matrix[n].toFixed(e))return!1;return!0}applyScaling(t,e){const n=w.buildScale(t,e);return this.multiply(n)}applyTranslation(t,e){const n=w.buildTranslate(t,e);return this.multiply(n)}applyRotation(t){const e=w.buildRotation(t);return this.multiply(e)}toArray(){return this._matrix.slice()}toIntArray(){return new Int32Array(this)}toIntShortArray(){return new Int32Array([this._matrix[0],this._matrix[1],this._matrix[3],this._matrix[4],this._matrix[6],this._matrix[7]])}toFloatArray(){return new Float32Array(this)}toFloatShortArray(){return new Float32Array([this._matrix[0],this._matrix[1],this._matrix[3],this._matrix[4],this._matrix[6],this._matrix[7]])}*[Symbol.iterator](){for(let t=0;t<9;t++)yield this._matrix[t]}}function y(t,e,n,r,s=!1){const i=new w;i.applyTranslation(-t.x,-t.y);const a=A.substract(e,t).getMagnitude(),o=A.substract(r,n).getMagnitude()/a;if(i.applyScaling(o),!s){const s=Math.atan2(e.y-t.y,e.x-t.x),a=Math.atan2(r.y-n.y,r.x-n.x)-s;i.applyRotation(a)}return i.applyTranslation(n.x,n.y),i}function v(...t){return{min:new A(Math.min(...t.map((t=>t.x))),Math.min(...t.map((t=>t.y)))),max:new A(Math.max(...t.map((t=>t.x))),Math.max(...t.map((t=>t.y))))}}const x=0,b=8,_=9,E=10,C=12,S=13,P=32,k=37,I=40,B=41,D=45,M=46,N=47,R=48,T=49,L=50,U=51,O=52,F=53,V=54,z=55,H=56,G=57,q=60,W=62,Q=69,J=70,X=80,j=82,K=83,Y=84,Z=88,$=91,tt=92,et=93,nt=97,rt=98,st=100,it=101,at=102,ot=106,ht=108,ct=109,dt=110,lt=111,pt=112,ut=114,ft=115,gt=116,At=117,mt=120,wt=121,yt={NULL:[dt,At,ht,ht],OBJ:[lt,rt,ot],OBJ_END:[it,dt,st,lt,rt,ot],STREAM_START:[ft,gt,ut,it,nt,ct],STREAM_END:[it,dt,st,ft,gt,ut,it,nt,ct],DICT_START:[q,q],DICT_END:[W,W],ARRAY_START:[$],ARRAY_END:[et],STR_LITERAL_START:[I],STR_LITERAL_END:[B],STR_HEX_START:[q],STR_HEX_END:[W],VERSION:[k,X,68,J,D],PREV:[N,X,ut,it,118],TYPE:[N,Y,wt,pt,it],SUBTYPE:[N,K,At,rt,gt,wt,pt,it],FORM:[N,J,lt,ut,ct],XREF_TABLE:[mt,ut,it,at],XREF_STREAM:[N,Z,j,it,at],XREF_HYBRID:[Z,j,it,at,K,gt,ct],XREF_START:[ft,gt,nt,ut,gt,mt,ut,it,at],TRAILER:[gt,ut,nt,105,ht,it,ut],END_OF_FILE:[k,k,Q,79,J],END_OF_LINE:[S,E],TRUE:[gt,ut,At,it],FALSE:[at,nt,ht,ft,it]},vt=new Set([k,I,B,N,q,W,$,et,123,125]),xt=new Set([x,_,E,C,S,P]),bt=new Set([R,T,L,U,O,F,V,z,H,G]);function _t(t){return!isNaN(t)&&(!vt.has(t)&&!xt.has(t))}const Et=3,Ct=4,St=5,Pt=7,kt=8,It=0,Bt=1,Dt=0,Mt=1,Nt=2,Rt="/DCTDecode",Tt="/FlateDecode",Lt="/JBIG2Decode",Ut="/JPXDecode",Ot=1,Ft=2,Vt=10,zt=11,Ht=12,Gt=13,qt=14,Wt=15,Qt={RC4_40:1,RC4_128:2,AES_128:4,AES_256:5},Jt={RC4_40:2,RC4_128:3,AES_128:4,AES_256:5,AES_256_V2:6},Xt={NONE:"/None",RC4:"/V2",AES_128:"/AESV2",AES_256:"/AESV3"},jt={DOC_OPEN:"/DocOpen",EMBEDDED_OPEN:"/EFOpen"},Kt="/XRef",Yt="/ObjStm",Zt="/XObject",$t="/Catalog",te="/Pages",ee="/Page",ne="/Annot",re="/Border",se="/Measure",ie="/ExtGState",ae="/CryptFilter",oe="/Mask",he="/Group",ce="/Font",de="",le={TRANSPARENCY:"/Transparency"},pe=0,ue=2,fe=3,ge=4,Ae=5,me=6,we=7,ye=8,ve=9,xe=10,be=11,_e="/Stamp",Ee="/Ink",Ce={BUTT:0,ROUND:1,SQUARE:2},Se={MITER:0,ROUND:1,BEVEL:2},Pe={ABSOLUTE:"/AbsoluteColorimetric",RELATIVE:"/RelativeColorimetric",SATURATION:"/Saturation",PERCEPTUAL:"/Perceptual"},ke={NORMAL:"/Normal",COMPATIBLE:"/Compatible",MULTIPLY:"/Multiply",SCREEN:"/Screen",OVERLAY:"/Overlay",DARKEN:"/Darken",LIGHTEN:"/Lighten",COLOR_DODGE:"/ColorDodge",COLOR_BURN:"/ColorBurn",HARD_LIGHT:"/HardLight",SOFT_LIGHT:"/SoftLight",DIFFERENCE:"/Difference",EXCLUSION:"/Exclusion"},Ie="/DeviceGray",Be="/DeviceRGB",De="/DeviceCMYK",Me="/Indexed",Ne={ALPHA:"/Alpha",LUMINOSITY:"/Luminosity"},Re=new Set([Tt,Rt,Lt,Ut]);function Te(t){if(!(null==t?void 0:t.length))return 0;if(1===t.length)return t[0];const e=Array.from(t,(t=>("0"+(255&t).toString(16)).slice(-2))).join("");return parseInt(e,16)}function Le(t){const e=new ArrayBuffer(1);return new DataView(e).setInt8(0,t),new Uint8Array(e)}function Ue(t,e=!1){const n=new ArrayBuffer(2);return new DataView(n).setInt16(0,t,e),new Uint8Array(n)}function Oe(t,e=!1){const n=new ArrayBuffer(4);return new DataView(n).setInt32(0,t,e),new Uint8Array(n)}function Fe(t,e){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t[r]^e;return n}function Ve(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ze(t){const e=new Uint8Array(t.length/2);for(let n=0,r=0;n<t.length;n+=2,r++)e[r]=parseInt(t.substr(n,2),16);return e}function He(t){return i.lib.WordArray.create(t)}function Ge(t){return function(t,e=!1){const n=new ArrayBuffer(4*t.length),r=new DataView(n);for(let n=0;n<t.length;n++)r.setInt32(4*n,t[n],e);return new Uint8Array(n)}(t.words).slice(0,t.sigBytes)}function qe(t){t instanceof Uint8Array&&(t=He(t));return i.MD5(t)}function We(t,e){t instanceof Uint8Array&&(t=He(t)),e instanceof Uint8Array&&(e=He(e));return i.RC4.encrypt(t,e).ciphertext}function Qe(t,e,n=!1){if(t instanceof Uint8Array&&(t=He(t)),e instanceof Uint8Array&&(e=He(e)),n){const n=i.lib.WordArray.create(t.words.slice(0,4));return i.algo.AES.createDecryptor(e,{mode:i.mode.CBC,iv:n,padding:i.pad.Pkcs7}).finalize(t)}{const n=i.lib.WordArray.random(16);return i.algo.AES.createEncryptor(e,{mode:i.mode.CBC,iv:n,padding:i.pad.Pkcs7}).finalize(t)}}const Je=[115,65,108,84];class Xe{constructor(t){if(!t)throw new Error("Empty key");if(16!==t.length)throw new Error(`Invalid key length: ${t.length} (shall be 16)`);this._n=t.length,this._key=t,this._tempKey=new Uint8Array(t.length+9)}encrypt(t,e){return this.run(t,e.id,e.generation)}decrypt(t,e){return this.run(t,e.id,e.generation,!0)}run(t,e,n,r=!1){const s=Oe(e,!0),i=Oe(n,!0);this._tempKey.set(this._key,0),this._tempKey.set(s.subarray(0,3),this._n),this._tempKey.set(i.subarray(0,2),this._n+3),this._tempKey.set(Je,this._n+5);const a=Ge(qe(this._tempKey)),o=Math.min(this._n+5,16),h=Ge(Qe(t,a.slice(0,o),r));return r?h.slice(16):h}}class je{constructor(t){if(!t)throw new Error("Empty key");if(32!==t.length)throw new Error(`Invalid key length: ${t.length} (shall be 16)`);this._n=t.length,this._key=t}encrypt(t,e){return this.run(t,e.id,e.generation)}decrypt(t,e){return this.run(t,e.id,e.generation,!0)}run(t,e,n,r=!1){const s=Ge(Qe(t,this._key,r));return r?s.slice(16):s}}class Ke{constructor(){}encrypt(t,e){return t}decrypt(t,e){return t}}class Ye{constructor(t){if(!t)throw new Error("Empty key");if(t.length<5||t.length>16)throw new Error(`Invalid key length: ${t.length} (shall be a multiple in range from 40 to 128)`);this._n=t.length,this._key=t,this._tempKey=new Uint8Array(t.length+5)}encrypt(t,e){const n=Oe(e.id,!0),r=Oe(e.generation,!0);this._tempKey.set(this._key,0),this._tempKey.set(n.slice(0,3),this._n),this._tempKey.set(r.slice(0,2),this._n+3);const s=Ge(qe(this._tempKey)),i=Math.min(this._n+5,16);return Ge(We(t,s.slice(0,i)))}decrypt(t,e){return this.encrypt(t,e)}}const Ze=[40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122];class $e{constructor(t,e){const{filter:n,version:r,revision:s,permissions:i,encryptMetadata:a,keyLength:o,stringKeyLength:h,streamKeyLength:c,stringMethod:d,streamMethod:l,oPasswordHash:p,uPasswordHash:u,oEncPasswordHash:f,uEncPasswordHash:g,perms:A}=t;if("/Standard"!==n)throw new Error(`Unsupported filter name: ${n}`);if(![1,2,4,5].includes(r))throw new Error(`Unsupported algorithm version: ${r}`);if(![2,3,4,5,6].includes(s))throw new Error(`Unsupported algorithm revision: ${s}`);if(isNaN(i))throw new Error("Permissions not provided");if(!p||!u)throw new Error("Password hash not provided");this._filter=n,this._version=r,this._revision=s,this._permissions=i,this._keyLength=o,this._encryptMetadata=a,this._stringKeyLength=h,this._streamKeyLength=c,this._stringMethod=d,this._streamMethod=l,this._oPasswordHash=p,this._uPasswordHash=u,this._oEncPasswordHash=f,this._uEncPasswordHash=g,this._perms=A,this._fileId=e}authenticate(t){const e=this._version,n=this._stringMethod,r=this._streamMethod;let s=!1;if(this.authOwnerPassword(t))s=!0;else{if(!this.authUserPassword(t))return null}const i=this._lastEncryptionKey;switch(e){case 1:const t=new Ye(i);return{owner:s,stringCryptor:t,streamCryptor:t};case 2:const e=new Ye(i);return{owner:s,stringCryptor:e,streamCryptor:e};case 4:let a,o;if(n&&n!==Xt.NONE)if(n===Xt.RC4)a=new Ye(i);else{if(n!==Xt.AES_128)throw new Error(`Invalid crypt method: ${n}`);a=new Xe(i)}else a=new Ke;if(r&&r!==Xt.NONE)if(r===Xt.RC4)o=new Ye(i);else{if(r!==Xt.AES_128)throw new Error(`Invalid crypt method: ${r}`);o=new Xe(i)}else o=new Ke;return{owner:s,stringCryptor:a,streamCryptor:o};case 5:let h,c;if(n&&n!==Xt.NONE){if(n!==Xt.AES_256)throw new Error(`Invalid crypt method: ${n}`);a=new je(i)}else a=new Ke;if(r&&r!==Xt.NONE){if(r!==Xt.AES_256)throw new Error(`Invalid crypt method: ${r}`);o=new je(i)}else o=new Ke;return{owner:s,stringCryptor:h,streamCryptor:c}}}padPassword32(t){if(!t)return new Uint8Array(Ze);const e=(new TextEncoder).encode(t),n=new Uint8Array(32);return n.set(e.slice(0,32)),e.length<32&&n.set(Ze.slice(0,32-e.length),e.length),n}computeEncryptionKey(t){if([2,3,4].includes(this._revision)){const e=this.padPassword32(t),n=Oe(this._permissions,!0),r=this._revision>=4&&!this._encryptMetadata?new Uint8Array([255,255,255,255]):new Uint8Array(0);let s=Ge(qe(new Uint8Array([...e,...this._oPasswordHash,...n,...this._fileId,...r])));const i=this._keyLength>>3;if(this._revision>=3)for(let t=0;t<50;t++)s=Ge(qe(s.slice(0,i)));const a=s.slice(0,i);return this._lastEncryptionKey=a,a}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}computeOHashEncryptionKey_R2R3R4(t){let e=qe(this.padPassword32(t));if(this._revision>=3)for(let t=0;t<50;t++)e=qe(e);const n=Ge(e),r=this._keyLength>>3;return n.slice(0,r)}computeOHash_R2R3R4(t,e){const n=this.computeOHashEncryptionKey_R2R3R4(t||e);let r=We(this.padPassword32(e),n);if(this._revision>=3)for(let t=1;t<20;t++)r=We(r,Fe(n,t));return Ge(r)}computeUHash_R2(t){const e=this.computeEncryptionKey(t);return Ge(We(new Uint8Array(Ze),e))}computeUHash_R3R4(t){const e=this.computeEncryptionKey(t);let n=qe(new Uint8Array([...Ze,...this._fileId]));n=We(n,e);for(let t=1;t<20;t++)n=We(n,Fe(e,t));return Ge(n)}authOwnerPassword(t){if([2,3,4].includes(this._revision)){const e=this.computeOHashEncryptionKey_R2R3R4(t);let n;if(2===this._revision)n=Ge(We(this._oPasswordHash,e));else{let t=He(this._oPasswordHash);for(let n=19;n>=0;n--)t=We(t,Fe(e,n));n=Ge(t)}const r=function(t,e){if((null==t?void 0:t.length)&&(null==e?void 0:e.length)){let n;t:for(let r=0;r<=t.length;r++){let s=!1;for(n=0;n<e.length;n++){if(!(r+n<t.length)){if(s)return r;break t}if(t[r+n]!==e[n])continue t;s=!0}}}return-1}(n,new Uint8Array(Ze)),s=(new TextDecoder).decode(-1===r?n:n.subarray(0,r));return this.authUserPassword(s)}if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}authUserPassword(t){let e;if(2===this._revision)return e=this.computeUHash_R2(t),Ve(this._uPasswordHash,e);if(3===this._revision||4===this._revision)return e=this.computeUHash_R3R4(t),Ve(this._uPasswordHash.subarray(0,16),e);if(5===this._revision)throw new Error("Not implemented yet");if(6===this._revision)throw new Error("Not implemented yet")}}class tn{constructor(t){if(!(null==t?void 0:t.length))throw new Error("Data is empty");this._data=t,this._maxIndex=t.length-1}get maxIndex(){return this._maxIndex}getPdfVersion(){var t;const e=this.findSubarrayIndex(yt.VERSION);if(!e)throw new Error("PDF not valid. Version not found");const n=null===(t=this.parseNumberAt(e.end+1,!0))||void 0===t?void 0:t.value;if(!n)throw new Error("Error parsing version number");return n.toFixed(1)}getLastXrefIndex(){const t=this.findSubarrayIndex(yt.XREF_START,{maxIndex:this.maxIndex,direction:"reverse"});if(!t)return null;const e=this.parseNumberAt(t.end+1);return e||null}findSubarrayIndex(t,e){var n,r;const s=this._data;if(!(null==t?void 0:t.length))return null;const i=(null==e?void 0:e.direction)||"straight",a=Math.max(Math.min(null!==(n=null==e?void 0:e.minIndex)&&void 0!==n?n:0,this._maxIndex),0),o=Math.max(Math.min(null!==(r=null==e?void 0:e.maxIndex)&&void 0!==r?r:this._maxIndex,this._maxIndex),0),h=!(null==e?void 0:e.closedOnly);let c,d="straight"===i?a:o;if("straight"===i)t:for(;d<=o;d++){for(c=0;c<t.length;c++)if(s[d+c]!==t[c])continue t;if(h||!_t(s[d+c]))return{start:d,end:d+c-1}}else{const e=t.length-1;t:for(;d>=a;d--){for(c=0;c<t.length;c++)if(s[d-c]!==t[e-c])continue t;if(h||!_t(s[d-c]))return{start:d-c+1,end:d}}}return null}findCharIndex(t,e="straight",n){return this.findSingleCharIndex((e=>t===e),e,n)}findNewLineIndex(t="straight",e){let n=this.findSingleCharIndex((t=>t===S||t===E),t,e);return-1===n?-1:"straight"===t?(this._data[n]===S&&this._data[n+1]===E&&n++,Math.min(n+1,this._maxIndex)):(this._data[n]===E&&this._data[n-1]===S&&n--,Math.max(n-1,0))}findSpaceIndex(t="straight",e){return this.findSingleCharIndex((t=>xt.has(t)),t,e)}findNonSpaceIndex(t="straight",e){return this.findSingleCharIndex((t=>!xt.has(t)),t,e)}findDelimiterIndex(t="straight",e){return this.findSingleCharIndex((t=>vt.has(t)),t,e)}findNonDelimiterIndex(t="straight",e){return this.findSingleCharIndex((t=>!vt.has(t)),t,e)}findIrregularIndex(t="straight",e){return this.findSingleCharIndex((t=>!_t(t)),t,e)}findRegularIndex(t="straight",e){return this.findSingleCharIndex((t=>_t(t)),t,e)}getValueTypeAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;const n=this._data,r=t;switch(n[r]){case N:return _t(n[r+1])?me:pe;case $:return we;case I:return ge;case q:return q===n[r+1]?ye:Ae;case k:return be;case R:case T:case L:case U:case O:case F:case V:case z:case H:case G:const t=this.findDelimiterIndex("straight",r+1);if(-1!==t){const e=this.findCharIndex(j,"reverse",t-1);if(-1!==e&&e>r&&!_t(n[e+1]))return xe}return fe;case M:case D:return s=n[r+1],bt.has(s)?fe:pe;case ft:return n[r+1]===gt&&n[r+2]===ut&&n[r+3]===it&&n[r+4]===nt&&n[r+5]===ct?ve:pe;case gt:return n[r+1]===ut&&n[r+2]===At&&n[r+3]===it?ue:pe;case at:return n[r+1]===nt&&n[r+2]===ht&&n[r+3]===ft&&n[r+4]===it?ue:pe;default:return pe}var s}getIndirectObjectBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;const n=this.findSubarrayIndex(yt.OBJ,{minIndex:t,closedOnly:!0});if(!n)return null;let r=this.findNonSpaceIndex("straight",n.end+1);if(-1===r)return null;const s=this.findSubarrayIndex(yt.OBJ_END,{minIndex:r,closedOnly:!0});if(!s)return null;let i=this.findNonSpaceIndex("reverse",s.start-1);return this.getCharCode(r)===q&&this.getCharCode(r+1)===q&&this.getCharCode(i-1)===W&&this.getCharCode(i)===W&&(r+=2,i-=2),{start:n.start,end:s.end,contentStart:r,contentEnd:i}}getXrefTableBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==mt)return null;const n=this.findSubarrayIndex(yt.XREF_TABLE,{minIndex:t});if(!n)return null;const r=this.findNonSpaceIndex("straight",n.end+1);if(-1===r)return null;const s=this.findSubarrayIndex(yt.TRAILER,{minIndex:n.end+1});if(!s)return null;const i=this.findNonSpaceIndex("reverse",s.start-1);return i<r?null:{start:n.start,end:s.end,contentStart:r,contentEnd:i}}getDictBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==q||this._data[t+1]!==q)return null;const n=this.findNonSpaceIndex("straight",t+2);if(-1===n)return null;let r,s,i=1,a=!0,o=0,h=n;for(;i;)s=r,r=this._data[h++],r!==I||o&&s===tt||o++,r===B&&o&&s!==tt&&o--,o||(a?a=!1:r===q&&r===s?(i++,a=!0):r===W&&r===s&&(i--,a=!0));const c=h-1,d=this.findNonSpaceIndex("reverse",c-2);return d<n?{start:t,end:c}:{start:t,end:c,contentStart:n,contentEnd:d}}getArrayBoundsAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==$)return null;let n,r=0,s=t+1;for(;r||n!==et;)n=this._data[s++],n===$?r++:r&&n===et&&r--;const i=s-1;return i-t<1?null:{start:t,end:i}}getHexBounds(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this.getCharCode(t)!==q)return null;const n=this.findCharIndex(W,"straight",t+1);return-1===n?null:{start:t,end:n}}getLiteralBounds(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t)||this.getCharCode(t)!==I)return null;let n,r,s=t+1,i=0;for(;i||r!==B||n===tt;){if(s>this._maxIndex)return null;isNaN(r)||(n=r),r=this.getCharCode(s++),n!==tt&&(r===I?i+=1:i&&r===B&&(i-=1))}return{start:t,end:s-1}}parseNumberAt(t,e=!1,n=!0){if(n&&(t=this.skipEmpty(t)),this.isOutside(t)||!_t(this._data[t]))return null;let r=t,s="",i=this._data[r];for(i===D?(s+="-",i=this._data[++r]):i===M&&(s+="0.",i=this._data[++r]);bt.has(i)||e&&i===M;)s+=String.fromCharCode(i),i=this._data[++r];return s?{value:+s,start:t,end:r-1}:null}parseNameAt(t,e=!0,n=!0){if(n&&(t=this.skipEmpty(t)),this.isOutside(t)||this._data[t]!==N)return null;let r=t+1,s=e?"/":"",i=this._data[r];for(;_t(i);)s+=String.fromCharCode(i),i=this._data[++r];return s.length>1?{value:s,start:t,end:r-1}:null}parseStringAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;let n=t,r="",s=this._data[n];for(;_t(s);)r+=String.fromCharCode(s),s=this._data[++n];return 0!==r.length?{value:r,start:t,end:n-1}:null}parseBoolAt(t,e=!0){if(e&&(t=this.skipEmpty(t)),this.isOutside(t))return null;const n=this.findSubarrayIndex(yt.TRUE,{minIndex:t});if(n)return{value:!0,start:t,end:n.end};const r=this.findSubarrayIndex(yt.FALSE,{minIndex:t});return r?{value:!0,start:t,end:r.end}:null}parseNumberArrayAt(t,e=!0,n=!0){const r=this.getArrayBoundsAt(t,n);if(!r)return null;const s=[];let i,a=r.start+1;for(;a<r.end&&(i=this.parseNumberAt(a,e,!0),i);)s.push(i.value),a=i.end+1;return{value:s,start:r.start,end:r.end}}parseNameArrayAt(t,e=!0,n=!0){const r=this.getArrayBoundsAt(t,n);if(!r)return null;const s=[];let i,a=r.start+1;for(;a<r.end&&(i=this.parseNameAt(a,e,!0),i);)s.push(i.value),a=i.end+1;return{value:s,start:r.start,end:r.end}}parseDictType(t){return this.parseDictNameProperty(yt.TYPE,t)}parseDictSubtype(t){return this.parseDictNameProperty(yt.SUBTYPE,t)}parseDictNameProperty(t,e){const n=this.findSubarrayIndex(t,{minIndex:e.start,maxIndex:e.end});if(!n)return null;const r=this.parseNameAt(n.end+1);return r?r.value:null}skipEmpty(t){let e=this.findNonSpaceIndex("straight",t);if(-1===e)return-1;if(this._data[e]===k){const t=this.findNewLineIndex("straight",e+1);if(-1===t)return-1;e=this.findNonSpaceIndex("straight",t)}return e}skipToNextName(t,e){if(t||(t=0),(e=e?Math.min(e,this._maxIndex):0)<t)return-1;let n=t;for(;n<=e;){const t=this.getValueTypeAt(n,!0);if(t){let e;switch(t){case ye:e=this.getDictBoundsAt(n,!1);break;case we:e=this.getArrayBoundsAt(n,!1);break;case ge:e=this.getLiteralBounds(n,!1);break;case Ae:e=this.getHexBounds(n,!1);break;case fe:const t=this.parseNumberAt(n,!0,!1);t&&(e=t);break;case ue:const r=this.parseBoolAt(n,!1);r&&(e=r);break;case be:break;case me:return n;default:n++;continue}if(e){n=e.end+1,e=null;continue}}n++}return-1}getCharCode(t){return this._data[t]}getChar(t){const e=this._data[t];return isNaN(e)?null:String.fromCharCode(e)}sliceCharCodes(t,e){return this._data.slice(t,(e||t)+1)}sliceChars(t,e){return String.fromCharCode(...this._data.slice(t,(e||t)+1))}subCharCodes(t,e){return this._data.subarray(t,(e||t)+1)}isOutside(t){return t<0||t>this._maxIndex}findSingleCharIndex(t,e="straight",n){const r=this._data;let s=isNaN(n)?"straight"===e?0:this._maxIndex:n;if("straight"===e){for(;s<=this._maxIndex;s++)if(t(r[s]))return s}else for(;s>=0;s--)if(t(r[s]))return s;return-1}}class en{constructor(t,e,n,r,s,i,a){this.type=t,this.id=e,this.generation=n,this.byteOffset=r,this.nextFreeId=s,this.streamId=i,this.streamIndex=a}static*fromTableBytes(t){let e=0,n=0;for(;e<t.length;){const r=[];let s=t[e++];for(;bt.has(s);)r.push(s),s=t[e++];let i=parseInt(r.map((t=>String.fromCharCode(t))).join(""),10);const a=[];let o=t[e++];for(;bt.has(o);)a.push(o),o=t[e++];const h=parseInt(a.map((t=>String.fromCharCode(t))).join(""),10);for(;!bt.has(t[e]);)e++;for(n=0;n<h;n++){const n=parseInt(Array.from(t.subarray(e,e+10)).map((t=>String.fromCharCode(t))).join(""),10);e+=11;const r=parseInt(Array.from(t.subarray(e,e+5)).map((t=>String.fromCharCode(t))).join(""),10);e+=6;const s=t[e];s===at?yield new en(Dt,i++,r,null,n):s===dt&&(yield new en(Mt,i++,r,n)),e+=3}}}static*fromStreamBytes(t,e,n){const[r,s,i]=e,a=r+s+i;if(t.length%a)throw new Error("Incorrect stream length");const o=t.length/a,h=new Array(o);if(null==n?void 0:n.length){let t,e,r=0;for(let s=0;s<n.length;s++)if(s%2)for(e=0;e<n[s];e++)h[r++]=t+e;else t=n[s]}else{let t=0;for(;t<o;)h[t++]=t}let c,d,l,p=0,u=0;for(;p<t.length;)switch(c=r?Te(t.slice(p,p+r)):1,p+=r,d=Te(t.slice(p,p+s)),p+=s,l=i?Te(t.slice(p,p+i)):null,p+=i,c){case Dt:yield new en(Dt,h[u++],null!=l?l:65535,null,d);break;case Mt:yield new en(Mt,h[u++],null!=l?l:0,d);break;case Nt:yield new en(Nt,h[u++],0,null,null,d,l)}}static toTableBytes(t){if(!(null==t?void 0:t.length))return null;const e=new TextEncoder,n=this.groupEntries(t);let r,s,i=new Uint8Array;for(const t of n){s=`${t[0]} ${t[1].length}\r\n`,r=new Uint8Array(i.length+s.length),r.set(i),r.set(e.encode(s),i.length),i=r;for(const n of t[1]){switch(n.type){case Dt:s=`${n.nextFreeId.toString().padStart(10,"0")} ${n.generation.toString().padStart(5,"0")} f\r\n`;break;case Mt:s=`${n.byteOffset.toString().padStart(10,"0")} ${n.generation.toString().padStart(5,"0")} n\r\n`;break;default:continue}r=new Uint8Array(i.length+s.length),r.set(i),r.set(e.encode(s),i.length),i=r}}return i}static toStreamBytes(t,e=[1,4,2]){if(!(null==t?void 0:t.length))return null;if(Math.min(...e)<0)throw new Error("Negative length values are not permitted");let[n,r,s]=e;null!=n||(n=0),null!=r||(r=4),null!=s||(s=0);const i=n+r+s;let a,o,h;switch(n){case 0:a=()=>new Uint8Array;break;case 1:a=Le;break;case 2:a=Ue;break;default:o=t=>new Uint8Array([...new Array(n-2).fill(0),...Ue(t)])}switch(r){case 1:o=Le;break;case 2:o=Ue;break;case 3:o=t=>new Uint8Array([0,...Ue(t)]);break;case 4:o=Oe;break;default:o=t=>new Uint8Array([...new Array(n-4).fill(0),...Oe(t)])}switch(s){case 0:h=()=>new Uint8Array;break;case 1:h=Le;break;case 2:h=Ue;break;default:o=t=>new Uint8Array([...new Array(n-2).fill(0),...Ue(t)])}new TextEncoder;const c=this.groupEntries(t),d=[];let l,p,u,f,g=new Uint8Array;for(const t of c){d.push(t[0],t[1].length);for(const e of t[1]){switch(e.type){case Dt:p=a(0),u=o(e.nextFreeId),f=h(e.generation);break;case Mt:p=a(1),u=o(e.byteOffset),f=h(e.generation);break;case Nt:p=a(2),u=o(e.streamId),f=h(e.streamIndex);break;default:continue}l=new Uint8Array(g.length+i),l.set(g),l.set(p,g.length),l.set(u,g.length+n),l.set(f,g.length+n+r),g=l}}return{bytes:g,index:d}}static groupEntries(t){t.sort(((t,e)=>t.id-e.id));const e=[];let n,r,s;for(const i of t)i.id!==s+1?((null==r?void 0:r.length)&&e.push([n,r]),n=i.id,r=[i]):r.push(i),s=i.id;return(null==r?void 0:r.length)&&e.push([n,r]),e}}class nn{constructor(t){var e;const n=[],r=[],s=[];let i=0;t.forEach((t=>{for(const e of t.getEntries()){switch(e.type){case Dt:n.push(e);break;case Mt:r.push(e);break;case Nt:s.push(e);break;default:continue}e.id>i&&(i=e.id)}})),this.size=i+1;const a={id:0,generation:65535,nextFreeId:0},o=new f(a),h=new Map,c=new Map;let d=!1;for(const t of n){if(!d&&0===t.id){d=!0,a.nextFreeId=t.nextFreeId;continue}const e=c.get(t.id);(!e||e.generation<t.generation)&&c.set(t.id,{id:t.id,generation:t.generation,nextFreeId:t.nextFreeId})}let l,p=a.nextFreeId;for(;p;)l=c.get(p),c.delete(p),o.push(l),p=l.nextFreeId;[...c].forEach((t=>{const e=t[1];65535===e.generation&&0===e.nextFreeId&&h.set(e.id,e)})),this.freeLinkedList=o,this.freeOutsideListMap=h;const u=new Map;for(const t of r){if(this.isFreed(t))continue;const e=u.get(t.id);e&&e.generation>=t.generation||u.set(t.id,{id:t.id,generation:t.generation,byteOffset:t.byteOffset})}for(const t of s){if(this.isFreed(t))continue;if(u.get(t.id))continue;const n=null===(e=u.get(t.streamId))||void 0===e?void 0:e.byteOffset;n&&u.set(t.id,{id:t.id,generation:t.generation,byteOffset:n,compressed:!0,streamId:t.streamId,streamIndex:t.streamIndex})}this.usedMap=u}getOffset(t){var e;return null===(e=this.usedMap.get(t))||void 0===e?void 0:e.byteOffset}getGeneration(t){var e;return null===(e=this.usedMap.get(t))||void 0===e?void 0:e.generation}isFreed(t){return this.freeOutsideListMap.has(t.id)||this.freeLinkedList.has(t,((t,e)=>t.id===e.id&&t.generation<e.generation))}isUsed(t){return this.usedMap.has(t)}}class rn{constructor(t){this._refData=t,this._size=t.size;const e=new f;for(const n of t.freeLinkedList)e.push(Object.assign({},n));this._freeLinkedList=e,this._usedMap=new Map}get size(){return this._size}takeFreeRef(t,e=!1){let n;if(!e&&this._freeLinkedList.length>1){const e=this._freeLinkedList.pop();this._freeLinkedList.tail.nextFreeId=0,n={id:e.id,generation:e.generation,byteOffset:t}}else n={id:this._size++,generation:0,byteOffset:t};return this._usedMap.set(n.id,n),n}setRefFree(t){if(this._usedMap.has(t)&&(this._usedMap.delete(t),this._size>this._refData.size&&this._size===t+1&&this._size--),this._refData.isUsed(t)){const e={id:t,generation:this._refData.getGeneration(t)+1,nextFreeId:0};if(-1!==this._freeLinkedList.findIndex(e,((t,e)=>t.id===e.id&&t.generation<=e.generation)))return;this._freeLinkedList.tail.nextFreeId=t,this._freeLinkedList.push(e)}}updateUsedRef(t){if(t.compressed&&t.generation)throw new Error(`Compressed ref generation can't be greater than zero: '${t.id} ${t.generation} R'`);if(this.isFreed(t))throw new Error(`The reference is freed: '${t.id} ${t.generation} R'`);const e=this._usedMap.get(t.id);if(e)throw new Error(`Same reference has been issued twice: '${e.id} ${e.generation} R'`);if(this._refData.isUsed(t.id)){const n=this._refData.getGeneration(t.id);if(t.generation>=n)return this._usedMap.set(t.id,t),!0;throw new Error(`The reference has an old generation: '${e.id} ${e.generation} R'`)}throw new Error(`The reference is not used: '${e.id} ${e.generation} R'`)}exportEntries(){const t=[];for(const e of this._freeLinkedList)t.push(new en(Dt,e.id,e.generation,null,e.nextFreeId));return this._usedMap.forEach((e=>{e.compressed?t.push(new en(Nt,e.id,0,null,null,e.streamId,e.streamIndex)):t.push(new en(Mt,e.id,e.generation,e.byteOffset))})),t}isFreed(t){return this._freeLinkedList.has(t,((t,e)=>t.id===e.id&&t.generation<e.generation))}isUsedInSource(t){return this._refData.isUsed(t)}}class sn{constructor(t){if(!(null==t?void 0:t.length))throw new Error("Data is empty");this._data=[...t],this._pointer=t.length,this._encoder=new TextEncoder,this.fixEof()}get offset(){return this._pointer}getCurrentData(){return new Uint8Array(this._data)}writeBytes(t){(null==t?void 0:t.length)&&(this._data.push(...t),this._pointer+=t.length)}writeIndirectObject(t,e){if(!(null==t?void 0:t.ref)||!e)return;const n=[...this._encoder.encode(`${t.ref.id} ${t.ref.generation} `),...yt.OBJ,...yt.END_OF_LINE,...e.toArray(t),...yt.END_OF_LINE,...yt.OBJ_END,...yt.END_OF_LINE];this.writeBytes(n)}writeIndirectArray(t,e){if(!(null==t?void 0:t.ref)||!e)return;const n=[...this._encoder.encode(`${t.ref.id} ${t.ref.generation} `),...yt.OBJ,...yt.END_OF_LINE,$];for(const r of e)n.push(P,...r.toArray(t));n.push(et,...yt.END_OF_LINE,...yt.OBJ_END,...yt.END_OF_LINE),this.writeBytes(n)}writeEof(t){const e=[...yt.XREF_START,...yt.END_OF_LINE,...this._encoder.encode(t+""),...yt.END_OF_LINE,...yt.END_OF_FILE,...yt.END_OF_LINE];this.writeBytes(e)}fixEof(){this._data[this._pointer-1]!==E&&(this._data[this._pointer-2]!==S?(this._data.push(S,E),this._pointer+=2):(this._data.push(E),this._pointer+=1))}}class an{constructor(t,e){this.id=null!=t?t:0,this.generation=null!=e?e:0}static parse(t,e,n=!0){if(n&&(e=t.findRegularIndex("straight",e)),e<0||e>t.maxIndex)return null;const r=t.parseNumberAt(e,!1,!1);if(!r||isNaN(r.value))return null;const s=t.parseNumberAt(r.end+2,!1,!1);return!s||isNaN(s.value)?null:{value:new an(r.value,s.value),start:e,end:s.end}}static parseRef(t,e,n=!0){const r=an.parse(t,e,n);if(!r)return null;const s=r.end+2,i=t.findSubarrayIndex([j],{minIndex:s,closedOnly:!0});return i&&i.start===s?{value:r.value,start:r.start,end:i.end}:null}static parseRefArray(t,e,n=!0){const r=t.getArrayBoundsAt(e,n);if(!r)return null;const s=[];let i,a=r.start+1;for(;a<r.end&&(i=an.parseRef(t,a,!0),i);)s.push(i.value),a=i.end+1;return{value:s,start:r.start,end:r.end}}static fromRef(t){return new an(t.id,t.generation)}equals(t){return this.id===t.id&&this.generation===t.generation}toArray(t){return(new TextEncoder).encode(`${this.id} ${this.generation} R`)}toString(){return this.id+"|"+this.generation}}class on{constructor(t,e){this._source=t,this._date=new Date(e)}get source(){return this._source}get date(){return new Date(this._date)}static parse(t,e,n=null,r=!0){if(r&&(e=t.skipEmpty(e)),t.isOutside(e)||t.getCharCode(e)!==I)return null;const s=t.findCharIndex(B,"straight",e);if(-1===s)return null;let i=t.subCharCodes(e+1,s-1);(null==n?void 0:n.ref)&&n.stringCryptor&&(i=n.stringCryptor.decrypt(i,n.ref));try{return{value:on.fromArray(i),start:e,end:s}}catch(t){return null}}static fromDate(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return new on(`D:${e}${n}${r}${s}${i}${a}`,t)}static fromString(t){const e=/D:(?<Y>\d{4})(?<M>\d{2})(?<D>\d{2})(?<h>\d{2})(?<m>\d{2})(?<s>\d{2})/.exec(t),n=new Date(+e.groups.Y,+e.groups.M-1,+e.groups.D,+e.groups.h,+e.groups.m,+e.groups.s);return new on(t,n)}static fromArray(t){const e=(new TextDecoder).decode(t);return on.fromString(e)}toArray(t){let e=(new TextEncoder).encode(this._source);return(null==t?void 0:t.ref)&&t.stringCryptor&&(e=t.stringCryptor.encrypt(e,t.ref)),new Uint8Array([...yt.STR_LITERAL_START,...e,...yt.STR_LITERAL_END])}}class hn{constructor(t,e){this._literal=t,this._bytes=e}get literal(){return this._literal}get bytes(){return this._bytes.slice()}static parse(t,e,n=null,r=!0){const s=t.getLiteralBounds(e,r);if(!s)return;let i=hn.unescape(t.subCharCodes(s.start+1,s.end-1));(null==n?void 0:n.ref)&&n.stringCryptor&&(i=n.stringCryptor.decrypt(i,n.ref));return{value:hn.fromBytes(i),start:s.start,end:s.end}}static fromBytes(t){const e=(254===t[0]&&255===t[1]?new TextDecoder("utf-16be"):new TextDecoder).decode(t);return new hn(e,t)}static fromString(t){const e=[];e.push(254,255);for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e.push((65280&r)>>>8),e.push(255&r)}return new hn(t,new Uint8Array(e))}static escape(t){const e=[];for(let n=0;n<t.length;n++)switch(t[n]){case E:e.push(tt),e.push(dt);break;case S:e.push(tt),e.push(ut);break;case _:e.push(tt),e.push(gt);break;case b:e.push(tt),e.push(rt);break;case C:e.push(tt),e.push(at);break;case I:e.push(tt),e.push(I);break;case B:e.push(tt),e.push(B);break;case tt:e.push(tt),e.push(tt);break;default:e.push(t[n])}return new Uint8Array(e)}static unescape(t){const e=[];let n=!1;for(let r=0;r<t.length;r++)if(n){switch(t[r]){case dt:e.push(E);break;case ut:e.push(S);break;case gt:e.push(_);break;case rt:e.push(b);break;case at:e.push(C);break;case I:e.push(I);break;case B:e.push(B);break;case tt:e.push(tt);break;default:e.push(t[r])}n=!1}else t[r]!==tt?e.push(t[r]):n=!0;return new Uint8Array(e)}toArray(t){const e=(null==t?void 0:t.ref)&&t.stringCryptor?t.stringCryptor.encrypt(this._bytes,t.ref):this._bytes;return new Uint8Array([...yt.STR_LITERAL_START,...hn.escape(e),...yt.STR_LITERAL_END])}}class cn{constructor(){this._added=!1,this._edited=!1,this._deleted=!1,this.onChange={set:(t,e,n)=>("_"!==e[0]&&"$"!==e[0]&&(this._edited||(this._edited=!0),this.$onEditedAction&&this.$onEditedAction()),t[e]=n,!0)}}get ref(){return this._ref}set ref(t){this._ref=t}get id(){var t;return null===(t=this._ref)||void 0===t?void 0:t.id}get generation(){var t;return null===(t=this._ref)||void 0===t?void 0:t.generation}get added(){return this._added}get edited(){return this._edited}get deleted(){return this._deleted}markAsDeleted(t=!0){this._deleted=t}parseRefProp(t,e,n){const r=an.parseRef(e,n);return this.setParsedProp(t,r)}parseRefArrayProp(t,e,n){const r=an.parseRefArray(e,n);return this.setParsedProp(t,r)}parseBoolProp(t,e,n){const r=e.parseBoolAt(n);return this.setParsedProp(t,r)}parseNameProp(t,e,n,r=!0){const s=e.parseNameAt(n,r);return this.setParsedProp(t,s)}parseNameArrayProp(t,e,n,r=!0){const s=e.parseNameArrayAt(n,r);return this.setParsedProp(t,s)}parseNumberProp(t,e,n,r=!0){const s=e.parseNumberAt(n,r);return this.setParsedProp(t,s)}parseNumberArrayProp(t,e,n,r=!0){const s=e.parseNumberArrayAt(n,r);return this.setParsedProp(t,s)}parseDateProp(t,e,n,r){const s=on.parse(e,n,r);return this.setParsedProp(t,s)}parseLiteralProp(t,e,n,r){const s=hn.parse(e,n,r);return this.setParsedProp(t,s)}setParsedProp(t,e){if(!e)throw new Error(`Can't parse ${t} property value`);return this[t.slice(1)]=e.value,e.end+1}}class dn extends cn{constructor(t){super(),this.Type=t}get streamId(){return this._streamId}toArray(t){const e=new TextEncoder,n=[...yt.DICT_START];return this.Type&&n.push(...yt.TYPE,...e.encode(this.Type)),n.push(...yt.DICT_END),new Uint8Array(n)}parseProps(t){var e;if(!t)throw new Error("Parse info is empty");this._ref=null===(e=t.cryptInfo)||void 0===e?void 0:e.ref,this._streamId=t.streamId;const{parser:n,bounds:r}=t,s=r.contentStart||r.start,i=r.contentEnd||r.end;let a,o,h=n.skipToNextName(s,i-1);if(-1===h)throw new Error("Dict is empty (has no properties)");for(;o=n.parseNameAt(h),o;)switch(h=o.end+1,a=o.value,a){case"/Type":const t=n.parseNameAt(h);if(t){if(this.Type&&this.Type!==t.value)throw new Error(`Ivalid dict type: '${t.value}' instead of '${this.Type}'`);return}throw new Error("Can't parse /Type property value");default:h=n.skipToNextName(h,i-1)}}}class ln extends dn{constructor(){super(de),this._intPropMap=new Map,this._boolPropMap=new Map,this._namePropMap=new Map,this._refPropMap=new Map}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new ln;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}static parseArray(t,e,n=null,r=!0){const s=t.getArrayBoundsAt(e,r);if(!s)return null;const i=[];let a,o=s.start+1;for(;o<s.end;){const e=t.getDictBoundsAt(o);if(a=ln.parse({parser:t,bounds:e,cryptInfo:n}),!a)break;i.push(a.value),o=a.end+1}return{value:i,start:s.start,end:s.end}}getIntProp(t){return this._intPropMap.get(t)}getBoolProp(t){return this._boolPropMap.get(t)}getNameProp(t){return this._namePropMap.get(t)}getRefProp(t){return this._refPropMap.get(t)}setIntProp(t,e){return this._intPropMap.set(t,e)}setBoolProp(t,e){return this._boolPropMap.set(t,e)}setNameProp(t,e){return this._namePropMap.set(t,e)}setRefProp(t,e){return this._refPropMap.set(t,e)}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this._intPropMap.forEach(((t,e)=>r.push(...n.encode(e),...n.encode(" "+t)))),this._boolPropMap.forEach(((t,e)=>r.push(...n.encode(e),...n.encode(" "+t)))),this._namePropMap.forEach(((t,e)=>r.push(...n.encode(e),...n.encode(t)))),this._refPropMap.forEach(((e,s)=>r.push(...n.encode(s),...e.toArray(t))));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;){o=a.end+1,i=a.value;switch(e.getValueTypeAt(o)){case fe:const t=e.parseNumberAt(o,!1);if(t){this._intPropMap.set(i,t.value),o=t.end+1;continue}break;case ue:const n=e.parseBoolAt(o);if(n){this._boolPropMap.set(i,n.value),o=n.end+1;continue}break;case me:const r=e.parseNameAt(o);if(r){this._namePropMap.set(i,r.value),o=r.end+1;continue}break;case xe:const s=an.parseRef(e,o);if(s){this._refPropMap.set(i,s.value),o=s.end+1;continue}}o=e.skipToNextName(o,s-1)}}}class pn extends class{constructor(t){this._minBufferLength=512,this._bufferLength=0,this._current=0,this._ended=!1,this._sourceStream=t}get length(){return this._buffer.length}ensureBuffer(t){const e=this._buffer;if(e&&t<=e.byteLength)return e;let n=this._minBufferLength;for(;n<t;)n*=2;const r=new Uint8Array(n);return e&&r.set(e),this._buffer=r}takeByte(){const t=this._current;for(;this._bufferLength<=t;){if(this._ended)return-1;this._readBlock()}return this._buffer[this._current++]}takeBytes(t){let e;const n=this._current;if(t){for(this.ensureBuffer(n+t),e=n+t;!this._ended&&this._bufferLength<e;)this._readBlock();e>this._bufferLength&&(e=this._bufferLength)}else{for(;!this._ended;)this._readBlock();e=this._bufferLength}this._current=e;return this._buffer.subarray(n,e)}takeUint16(){const t=this.takeByte(),e=this.takeByte();return-1===t||-1===e?-1:(t<<8)+e}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const t=this.takeByte();return-1!==t&&this._current--,t}peekBytes(t){const e=this.takeBytes(t);return this._current-=e.length,e}skip(t){this._current+=t||1}reset(){this._current=0}}{constructor(t){super(t),this._codeSize=0,this._codeBuf=0;const e=t.takeByte(),n=t.takeByte();if(-1===e||-1===n)throw new Error(`Invalid header in flate stream: ${e}, ${n}`);if(8!=(15&e))throw new Error(`Unknown compression method in flate stream: ${e}, ${n}`);if(((e<<8)+n)%31!=0)throw new Error(`Bad FCHECK in flate stream: ${e}, ${n}`);if(32&n)throw new Error(`FDICT bit set in flate stream: ${e}, ${n}`);this._codeSize=0,this._codeBuf=0}_readBlock(){let t,e;const n=this._sourceStream;let r,s,i=this.getBits(3);if(1&i&&(this._ended=!0),i>>=1,0===i){let e;if(-1===(e=n.takeByte()))throw new Error("Bad block header in flate stream");let r=e;if(-1===(e=n.takeByte()))throw new Error("Bad block header in flate stream");if(r|=e<<8,-1===(e=n.takeByte()))throw new Error("Bad block header in flate stream");let s=e;if(-1===(e=n.takeByte()))throw new Error("Bad block header in flate stream");if(s|=e<<8,s!==(65535&~r)&&(0!==r||0!==s))throw new Error("Bad uncompressed block length in flate stream");this._codeBuf=0,this._codeSize=0;const i=this._bufferLength,a=i+r;if(t=this.ensureBuffer(a),this._bufferLength=a,0===r)-1===n.peekByte()&&(this._ended=!0);else{const e=n.takeBytes(r);t.set(e,i),e.length<r&&(this._ended=!0)}return}if(1===i)r=pn.fixedLitCodeTab,s=pn.fixedDistCodeTab;else{if(2!==i)throw new Error("Unknown block type in flate stream");{const t=this.getBits(5)+257,n=this.getBits(5)+1,i=this.getBits(4)+4,a=new Uint8Array(pn.codeLenCodeMap.length);let o;for(o=0;o<i;o++)a[pn.codeLenCodeMap[o]]=this.getBits(3);const h=this.generateHuffmanTable(a);e=0,o=0;const c=t+n,d=new Uint8Array(c);let l,p,u;for(;o<c;){const t=this.getCode(h);if(16===t)l=2,p=3,u=e;else if(17===t)l=3,p=3,u=e=0;else{if(18!==t){d[o++]=e=t;continue}l=7,p=11,u=e=0}let n=this.getBits(l)+p;for(;n-- >0;)d[o++]=u}r=this.generateHuffmanTable(d.subarray(0,t)),s=this.generateHuffmanTable(d.subarray(t,c))}}t=this._buffer;let a=t?t.length:0,o=this._bufferLength;for(;;){let n=this.getCode(r);if(n<256){o+1>=a&&(t=this.ensureBuffer(o+1),a=t.length),t[o++]=n;continue}if(256===n)return void(this._bufferLength=o);n-=257,n=pn.lengthDecode[n];let i=n>>16;i>0&&(i=this.getBits(i)),e=(65535&n)+i,n=this.getCode(s),n=pn.distDecode[n],i=n>>16,i>0&&(i=this.getBits(i));const h=(65535&n)+i;o+e>=a&&(t=this.ensureBuffer(o+e),a=t.length);for(let n=0;n<e;++n,++o)t[o]=t[o-h]}}getBits(t){const e=this._sourceStream;let n,r=this._codeSize,s=this._codeBuf;for(;r<t;){if(-1===(n=e.takeByte()))throw new Error("Bad encoding in flate stream");s|=n<<r,r+=8}return n=s&(1<<t)-1,this._codeBuf=s>>t,this._codeSize=r-=t,n}getCode(t){const e=this._sourceStream,[n,r]=t;let s,i=this._codeSize,a=this._codeBuf;for(;i<r&&-1!==(s=e.takeByte());)a|=s<<i,i+=8;const o=n[a&(1<<r)-1],h=o>>16,c=65535&o;if(h<1||i<h)throw new Error("Bad encoding in flate stream");return this._codeBuf=a>>h,this._codeSize=i-h,c}generateHuffmanTable(t){const e=t.length;let n,r=0;for(n=0;n<e;n++)t[n]>r&&(r=t[n]);const s=1<<r,i=new Int32Array(s);for(let a=1,o=0,h=2;a<=r;a++,o<<=1,h<<=1)for(let r=0;r<e;r++)if(t[r]===a){let t=0,e=o;for(n=0;n<a;n++)t=t<<1|1&e,e>>=1;for(n=t;n<s;n+=h)i[n]=a<<16|r;o++}return[i,r]}}pn.codeLenCodeMap=new Int32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pn.lengthDecode=new Int32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),pn.distDecode=new Int32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),pn.fixedLitCodeTab=[new Int32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],pn.fixedDistCodeTab=[new Int32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];class un{constructor(t,e=0,n){if(n&&n<0)throw new Error("Stream length can't be negative");this._bytes=t instanceof Uint8Array?t:new Uint8Array(t),this._start=e,this._current=e,this._end=e+n||t.length}get length(){return this._end-this._start}takeByte(){return this._current>=this._end?-1:this._bytes[this._current++]}takeBytes(t){const e=this._bytes,n=this._current,r=this._end;if(t){let s=n+t;s>r&&(s=r),this._current=s;return e.subarray(n,s)}return e.subarray(n,r)}takeUint16(){const t=this.takeByte(),e=this.takeByte();return-1===t||-1===e?-1:(t<<8)+e}takeInt32(){return(this.takeByte()<<24)+(this.takeByte()<<16)+(this.takeByte()<<8)+this.takeByte()}peekByte(){const t=this.takeByte();return-1!==t&&this._current--,t}peekBytes(t){const e=this.takeBytes(t);return this._current-=e.length,e}getByte(t){return this._bytes[t]}getByteRange(t,e){return this._bytes.subarray(Math.max(t,0),Math.min(e,this._end))}skip(t){this._current+=t||1}reset(){this._current=this._start}}class fn{static Decode(t,e=Ot,n=1,r=1,s=8){const i=new un(t,0,t.length),a=new pn(i).takeBytes(null);switch(e){case Ot:return a;case Vt:case zt:case Ht:case Gt:case qt:case Wt:return fn.removePngFilter(a,n,r,s);case Ft:throw new Error("Unsupported filter predictor")}}static Encode(t,e=Ht,n=5,r=1,s=8){let i;switch(e){case Ot:i=t;break;case Vt:case zt:case Ht:case Gt:case qt:case Wt:i=fn.applyPngFilter(t,e,n,r,s);break;case Ft:throw new Error("Unsupported filter predictor")}return a.deflate(i)}static removePngFilter(t,e,n,r){const s=Math.ceil(n*r/8),i=e*s,a=i+1;if(t.length%a)throw new Error("Data length doesn't match filter columns");const o=new Uint8Array(t.length/a*i),h=new Array(i).fill(0),c=new Array(i).fill(0),d=t=>t-s<0?0:c[t-s],l=t=>h[t];let p=0,u=0,f=0,g=0,A=0,m=0;for(let e=0;e<t.length;e++)if(e%a==0){if(A=t[e],p=0,e)for(f=0;f<i;f++)h[f]=o[g+f];g=u}else{switch(c[p]=t[e],A){case 0:m=c[p];break;case 1:m=(c[p]+d(p))%256;break;case 2:m=(c[p]+l(p))%256;break;case 3:m=(c[p]+Math.floor((l(p)+d(p))/2))%256;break;case 4:m=(c[p]+this.paethPredictor(d(p),l(p),(w=p)-s<0?0:h[w-s]))%256}o[u++]=m,p++}var w;return o}static applyPngFilter(t,e=12,n=5,r=1,s=8){let i;switch(e){case Vt:i=0;break;case zt:i=1;break;case Ht:i=2;break;case Gt:i=3;break;case qt:i=4;break;default:throw new Error("Invalid PNG filter type")}const a=Math.ceil(r*s/8),o=n*a,h=o+1,c=Math.ceil(t.length/o)*h,d=new Uint8Array(c),l=new Array(o).fill(0),p=new Array(o).fill(0),u=t=>t-a<0?0:p[t-a],f=t=>l[t];let g=0,A=0,m=0,w=0,y=0;for(let e=0;e<c;e++)if(e%h==0){if(g=0,e)for(m=0;m<o;m++)l[m]=t[w+m];w=A,d[e]=i}else{switch(p[g]=t[A++]||0,i){case 0:y=p[g];break;case 1:y=(p[g]-u(g))%256;break;case 2:y=(p[g]-f(g))%256;break;case 3:y=(p[g]-Math.floor((f(g)+u(g))/2))%256;break;case 4:y=(p[g]-this.paethPredictor(u(g),f(g),(v=g)-a<0?0:l[v-a]))%256}d[e]=y,g++}var v;return d}static paethPredictor(t,e,n){const r=t+e-n,s=Math.abs(r-t),i=Math.abs(r-e),a=Math.abs(r-n);return s<=i&&s<=a?t:i<=a?e:n}}class gn extends cn{constructor(t){super(),this.Type=t}get streamData(){return this._streamData}set streamData(t){this.setStreamData(t),this._edited=!0}get decodedStreamData(){return this._decodedStreamData||this.decodeStreamData(),this._decodedStreamData}get decodedStreamDataChars(){return(new TextDecoder).decode(this._decodedStreamData)}toArray(t){const e=(null==t?void 0:t.ref)&&t.streamCryptor?t.streamCryptor.encrypt(this.streamData,t.ref):this.streamData,n=new TextEncoder,r=[...yt.DICT_START];return r.push(...n.encode("/Length "),...n.encode(" "+e.length)),this.Type&&r.push(...yt.TYPE,...n.encode(this.Type)),this.Filter&&r.push(...n.encode("/Filter "),...n.encode(this.Filter)),this.DecodeParms&&r.push(...n.encode("/DecodeParms "),...this.DecodeParms.toArray(t)),r.push(...yt.DICT_END,...yt.END_OF_LINE,...yt.STREAM_START,...yt.END_OF_LINE,...e,...yt.END_OF_LINE,...yt.STREAM_END),new Uint8Array(r)}setTextStreamData(t){const e=(new TextEncoder).encode(t);this.streamData=e}parseProps(t){var e,n;if(!t)throw new Error("Parse info is empty");this._ref=null===(e=t.cryptInfo)||void 0===e?void 0:e.ref;const{parser:r,bounds:s}=t,i=s.contentStart||s.start,a=s.contentEnd||s.end,o=r.findSubarrayIndex(yt.STREAM_END,{direction:"reverse",minIndex:i,maxIndex:a,closedOnly:!0});if(!o)throw new Error("Object is not a stream");const h=r.findSubarrayIndex(yt.STREAM_START,{direction:"reverse",minIndex:i,maxIndex:o.start-1,closedOnly:!0});if(!h)throw new Error("Stream start is out of the data bounds");const c=r.getDictBoundsAt(i);let d,l,p=r.skipToNextName(c.contentStart,c.contentEnd);if(-1===p)throw new Error("Dict is empty (has no properties)");for(;l=r.parseNameAt(p),l;)switch(p=l.end+1,d=l.value,d){case"/Type":const e=r.parseNameAt(p);if(!e)throw new Error("Can't parse /Type property value");if(this.Type&&this.Type!==e.value)throw new Error(`Ivalid dict type: '${e.value}' instead of '${this.Type}'`);p=e.end+1;break;case"/Length":case"/DL":p=this.parseNumberProp(d,r,p,!1);break;case"/Filter":const n=r.getValueTypeAt(p);if(n===me){const t=r.parseNameAt(p);if(t&&Re.has(t.value)){this.Filter=t.value,p=t.end+1;break}throw new Error(`Unsupported /Filter property value: ${t.value}`)}if(n===we){const t=r.parseNameArrayAt(p);if(t){const e=t.value;if(1===e.length&&Re.has(e[0])){this.Filter=e[0],p=t.end+1;break}throw new Error(`Unsupported /Filter property value: ${e.toString()}`)}}throw new Error(`Unsupported /Filter property value type: ${n}`);case"/DecodeParms":const s=r.getValueTypeAt(p);if(s===ye){const e=r.getDictBoundsAt(p);if(e){const n=ln.parse({parser:r,bounds:e,cryptInfo:t.cryptInfo});if(n){this.DecodeParms=n.value,p=e.end+1;break}}throw new Error("Can't parse /DecodeParms property value")}if(s===we){const e=ln.parseArray(r,p,t.cryptInfo);if(e){const t=e.value;if(1===t.length){this.DecodeParms=t[0],p=e.end+1;break}}throw new Error("Can't parse /DecodeParms property value")}throw new Error(`Unsupported /DecodeParms property value type: ${s}`);default:p=r.skipToNextName(p,c.contentEnd)}const u=r.findNewLineIndex("straight",h.end+1),f=r.findNewLineIndex("reverse",o.start-1),g=r.sliceCharCodes(u,f),A=(null===(n=t.cryptInfo)||void 0===n?void 0:n.ref)&&t.cryptInfo.streamCryptor?t.cryptInfo.streamCryptor.decrypt(g,t.cryptInfo.ref):g;this._streamData=A}setStreamData(t){if(!(null==t?void 0:t.length))throw new Error("Can't set emprty stream data");let e;if(this.DecodeParms)e=this.DecodeParms;else{let n,r=10;for(;;){if(t.length%r==0){n=r;break}r--}e=new ln,e.setIntProp("/Predictor",Ht),e.setIntProp("/Columns",n),this.DecodeParms=e}const n=fn.Encode(t,(null==e?void 0:e.getIntProp("/Predictor"))||Ot,(null==e?void 0:e.getIntProp("/Columns"))||1,(null==e?void 0:e.getIntProp("/Colors"))||1,(null==e?void 0:e.getIntProp("/BitsPerComponent"))||8);this._streamData=n,this.Length=n.length,this.DL=t.length,this._decodedStreamData=t}decodeStreamData(){let t;switch(this.Filter){case Tt:if(this.DecodeParms){const e=this.DecodeParms;t=fn.Decode(this._streamData,e.getIntProp("/Predictor")||Ot,e.getIntProp("/Columns")||1,e.getIntProp("/Colors")||1,e.getIntProp("/BitsPerComponent")||8)}else t=fn.Decode(this._streamData);break;default:t=new Uint8Array(this._streamData)}this._decodedStreamData=t}}class An extends gn{constructor(t=null){super(t)}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new An;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}getText(){return null}toArray(t){return super.toArray(t)}parseProps(t){super.parseProps(t)}}class mn{constructor(t,e,n){this._literal=t,this._hex=e,this._bytes=n}get literal(){return this._literal}get hex(){return this._hex.slice()}get bytes(){return this._bytes.slice()}static parse(t,e,n=null,r=!0){const s=t.getHexBounds(e,r);if(!s)return null;let i=t.sliceCharCodes(s.start+1,s.end-1);(null==n?void 0:n.ref)&&n.stringCryptor&&(i=n.stringCryptor.decrypt(i,n.ref));return{value:mn.fromBytes(i),start:s.start,end:s.end}}static parseArray(t,e,n=null,r=!0){const s=t.getArrayBoundsAt(e,r);if(!s)return null;const i=[];let a,o=s.start+1;for(;o<s.end&&(a=mn.parse(t,o,n,r),a);)i.push(a.value),o=a.end+1;return{value:i,start:s.start,end:s.end}}static fromBytes(t){const e=(new TextDecoder).decode(t),n=ze(e);return new mn(e,n,t)}static fromHexBytes(t){let e="";t.forEach((t=>e+=t.toString(16).padStart(2,"0")));const n=(new TextEncoder).encode(e);return new mn(e,t,n)}static fromLiteralString(t){const e=ze(t),n=(new TextEncoder).encode(t);return new mn(t,e,n)}toArray(t){return new Uint8Array([...yt.STR_HEX_START,...this._bytes,...yt.STR_HEX_END])}}class wn{constructor(t,e,n){switch(t){case Ie:this.componentsNumber=1;break;case Be:this.componentsNumber=3;break;case De:this.componentsNumber=4;break;default:throw new Error(`Unsupported base color space for indexed color space: ${t}`)}if(this.baseColorSpace=t,n.length!==this.componentsNumber*(e+1))throw new Error(`Invalid lookup array length: ${n.length}`);this.highestValue=e,this.lookupArray=n}static parse(t,e=!0){const{parser:n,bounds:r,cryptInfo:s}=t;let i;e&&(i=n.findNonSpaceIndex("straight",r.start));const a=i;if(i<0||i>n.maxIndex||n.getCharCode(i)!==$)return console.log("Color space array start not found"),null;i++;const o=n.parseNameAt(i);if(!o||"/Indexed"!==o.value)return console.log("Array is not representing an indexed color space"),null;i=o.end+1;const h=n.parseNameAt(i);if(!h)return console.log("Can't parse base color space name of the indexed color space"),null;i=h.end+2;const c=n.parseNumberAt(i);if(!c||isNaN(c.value))return console.log("Can't parse the highest value of the indexed color space"),null;let d;i=c.end+1;const l=n.getValueTypeAt(i);if(l===xe)try{const e=an.parseRef(n,i),r=t.parseInfoGetter(e.value.id);d=An.parse(r).value.decodedStreamData,i=e.end+1}catch(t){throw new Error(`Can't parse indexed color array lookup ref: ${t.message}`)}else if(l===Ae){const t=mn.parse(n,i,s);if(!t)throw new Error("Can't parse indexed color array lookup hex string");d=t.value.hex,i=t.end+1}try{return{value:new wn(h.value,c.value,d),start:a,end:i-1}}catch(t){return console.log(t.message),null}}toArray(t){const e=new TextEncoder,n=[];return n.push($,...e.encode("/Indexed "),...e.encode(this.baseColorSpace+" "),...e.encode(this.highestValue+" "),...mn.fromHexBytes(this.lookupArray).toArray(t),et),new Uint8Array(n)}getColor(t){switch(this.baseColorSpace){case Ie:const e=this.lookupArray[t];return[e,e,e];case Be:return[this.lookupArray[3*t],this.lookupArray[3*t+1],this.lookupArray[3*t+2]];case De:const n=this.lookupArray[4*t]/255,r=this.lookupArray[4*t+1]/255,s=this.lookupArray[4*t+2]/255,i=this.lookupArray[4*t+3]/255;return[255*(1-n)*(1-i),255*(1-r)*(1-i),255*(1-s)*(1-i)]}}}var yn=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class vn extends gn{constructor(){super(Zt),this.Subtype="/Image",this.ImageMask=!1,this.Interpolate=!1,this.SMaskInData=0}get sMask(){return this._sMask}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new vn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Subtype&&r.push(...n.encode("/Subtype "),...n.encode(this.Subtype)),this.Width&&r.push(...n.encode("/Width "),...n.encode(" "+this.Width)),this.Height&&r.push(...n.encode("/Width "),...n.encode(" "+this.Height)),this.ColorSpace&&(this._indexedColorSpace?r.push(...n.encode("/ColorSpace "),...this._indexedColorSpace.toArray(t)):r.push(...n.encode("/ColorSpace "),...n.encode(this.ColorSpace))),this.BitsPerComponent&&r.push(...n.encode("/BitsPerComponent "),...n.encode(" "+this.BitsPerComponent)),r.push(...n.encode("/ImageMask "),...n.encode(" "+!!this.ImageMask)),this.Mask&&(r.push(...n.encode("/Mask "),$),this.Mask.forEach((t=>r.push(P,...n.encode(" "+t)))),r.push(et)),this.Decode&&(r.push(...n.encode("/Decode "),$),this.Decode.forEach((t=>r.push(P,...n.encode(" "+t)))),r.push(et)),r.push(...n.encode("/Interpolate "),...n.encode(" "+!!this.Interpolate)),this.SMask&&r.push(...n.encode("/SMask "),...this.SMask.toArray(t)),this.SMaskInData&&r.push(...n.encode("/SMaskInData "),...n.encode(" "+this.SMaskInData)),this.Matte&&(r.push(...n.encode("/Matte "),$),this.Matte.forEach((t=>r.push(P,...n.encode(" "+t)))),r.push(et)),this.StructParent&&r.push(...n.encode("/StructParent "),...n.encode(" "+this.StructParent)),this.Metadata&&r.push(...n.encode("/Metadata "),P,...this.Metadata.toArray(t));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}getImageUrlAsync(){return yn(this,void 0,void 0,(function*(){if(this._imageUrl&&URL.revokeObjectURL(this._imageUrl),this.Filter===Rt||this.Filter===Lt||this.Filter===Ut){const t=new Blob([this.decodedStreamData],{type:"application/octet-binary"}),e=URL.createObjectURL(t);return this._imageUrl=e,e}if(this.Filter===Tt){const t=this.Width*this.Height;let e;if(this.sMask){if(e=this.sMask.decodedStreamData,e.length!==t)throw new Error(`Invalid alpha mask data length: ${e.length} (must be ${t})`)}else e=new Uint8Array(t).fill(255);const n=new Uint8ClampedArray(4*t);for(let r=0;r<t;r++){const[t,s,i]=this.getColor(r);n[4*r]=t,n[4*r+1]=s,n[4*r+2]=i,n[4*r+3]=e[r]}const r=new ImageData(n,this.Width,this.Height),s=new Promise(((t,e)=>{const n=document.createElement("canvas");n.width=this.Width,n.height=this.Height,n.getContext("2d").putImageData(r,0,0),n.toBlob((e=>{const n=URL.createObjectURL(e);t(n)}))})),i=yield s;return this._imageUrl=i,i}throw new Error(`Unsupported image filter type: ${this.Filter}`)}))}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=e.getDictBoundsAt(r);let i,a,o=e.skipToNextName(s.contentStart,s.contentEnd);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Subtype":const n=e.parseNameAt(o);if(!n)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==n.value)throw new Error(`Ivalid dict subtype: '${n.value}' instead of '${this.Subtype}'`);o=n.end+1;break;case"/Width":case"/Height":case"/BitsPerComponent":case"/SMaskInData":case"/StructParent":o=this.parseNumberProp(i,e,o,!1);break;case"/Decode":o=this.parseNumberArrayProp(i,e,o,!1);break;case"/Matte":o=this.parseNumberArrayProp(i,e,o,!0);break;case"/Interpolate":o=this.parseBoolProp(i,e,o);break;case"/SMask":case"/Metadata":o=this.parseRefProp(i,e,o);break;case"/ColorSpace":const r=e.getValueTypeAt(o);if(r===me){const t=e.parseNameAt(o);if(t){this.ColorSpace=t.value,o=t.end+1;break}throw new Error("Can't parse /ColorSpace name")}if(r===we){const n=e.getArrayBoundsAt(o);if(n){const r=wn.parse({parser:e,bounds:n,cryptInfo:t.cryptInfo,parseInfoGetter:t.parseInfoGetter});if(r){this.ColorSpace=Me,this._indexedColorSpace=r.value,o=n.end+1;break}throw new Error("Can't parse /ColorSpace object:"+e.sliceChars(n.start,n.end))}throw new Error("Can't parse /ColorSpace value array")}if(r===xe){const n=an.parseRef(e,o);if(n){const e=t.parseInfoGetter(n.value.id);if(e){const t=wn.parse(e);if(t){this.ColorSpace=Me,this._indexedColorSpace=t.value,o=n.end+1;break}throw new Error("Can't parse /ColorSpace object:"+e.parser.sliceChars(e.bounds.start,e.bounds.end))}}throw new Error("Can't parse /ColorSpace ref")}throw new Error(`Unsupported /ColorSpace property value type: ${r}`);case"/ImageMask":const a=e.parseBoolAt(o,!1);if(!a)throw new Error("Can't parse /ImageMask property value");this.ImageMask=a.value,o=a.end+1,this.ImageMask&&(this.BitsPerComponent=1);break;case"/Mask":const h=e.getValueTypeAt(o);if(h===xe){const n=an.parseRef(e,o);if(!n)throw new Error("Can't parse /Mask value reference: failed to parse ref");const r=t.parseInfoGetter(n.value.id);if(!r)throw new Error("Can't parse /Mask value reference: failed to get image parse info");const s=vn.parse(r);if(!s)throw new Error("Can't parse /Mask value reference: failed to parse image stream");const i=new tn(new Uint8Array([$,...s.value.decodedStreamData,et]));if(!i)throw new Error("Can't parse /Mask value reference: failed to get decoded image data");const a=i.parseNumberArrayAt(0,!1);if(!a)throw new Error("Can't parse /Mask value reference: failed to parse decoded image data");this.Mask=a.value,o=n.end+1;break}if(h===we){const t=e.parseNumberArrayAt(o,!1);if(t){this.Mask=t.value,o=t.end+1;break}throw new Error("Can't parse /Mask property value")}throw new Error(`Unsupported /Mask property value type: ${h}`);case"/OC":case"/Intent":case"/Alternates":case"/ID":case"/OPI":default:o=e.skipToNextName(o,s.contentEnd)}if(!this.Width&&!this.Height)throw new Error("Not all required properties parsed");if(this.ImageMask&&(1!==this.BitsPerComponent||this.ColorSpace))throw new Error("Mutually exclusive properties found");if(!this.Decode&&(this.Filter!==Ut||this.ImageMask))switch(this.ColorSpace){case Ie:this.Decode=[0,1];break;case Be:this.Decode=[0,1,0,1,0,1];break;case De:this.Decode=[0,1,0,1,0,1,0,1];break;case Me:this.Decode=[0,Math.pow(2,this.BitsPerComponent||1)-1];break;default:this.Decode=[0,1]}if(this.DecodeParms||(this.DecodeParms=new ln),this.DecodeParms.getIntProp("/BitsPerComponent")||this.DecodeParms.setIntProp("/BitsPerComponent",this.BitsPerComponent),this.DecodeParms.getIntProp("/Columns")||this.DecodeParms.setIntProp("/Columns",this.Width),!this.DecodeParms.getIntProp("/Colors"))switch(this.ColorSpace){case Ie:case Me:this.DecodeParms.setIntProp("/Colors",1);break;case Be:this.DecodeParms.setIntProp("/Colors",3);break;case De:this.DecodeParms.setIntProp("/Colors",4);break;default:this.DecodeParms.setIntProp("/Colors",1)}if(this.SMask){const e=t.parseInfoGetter(this.SMask.id);if(!e)throw new Error(`Can't get parse info for ref: ${this.SMask.id} ${this.sMask.generation} R`);const n=vn.parse(e);if(!n)throw new Error(`Can't parse SMask: ${this.SMask.id} ${this.sMask.generation} R`);this._sMask=n.value}}getColor(t){var e;const n=this.decodedStreamData;switch(this.ColorSpace){case Ie:const r=n[t];return[r,r,r];case Be:return[n[3*t],n[3*t+1],n[3*t+2]];case De:const s=n[4*t]/255,i=n[4*t+1]/255,a=n[4*t+2]/255,o=n[4*t+3]/255;return[255*(1-s)*(1-o),255*(1-i)*(1-o),255*(1-a)*(1-o)];case Me:return(null===(e=this._indexedColorSpace)||void 0===e?void 0:e.getColor(t))||[0,0,0]}}}const xn={SOLID:"/S",DASHED:"/D",BEVELED:"/B",INSET:"/I",UNDERLINE:"/U"};class bn extends dn{constructor(){super(re),this.W=1,this.S=xn.SOLID,this.D=[3,0]}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new bn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.W&&r.push(...n.encode("/W "),...n.encode(" "+this.W)),this.S&&r.push(...n.encode("/S "),...n.encode(this.S)),this.D&&r.push(...n.encode("/D "),$,...n.encode(this.D[0]+""),P,...n.encode(this.D[1]+""),et);const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){var e,n;super.parseProps(t);const{parser:r,bounds:s}=t,i=s.contentStart||s.start,a=s.contentEnd||s.end;let o,h,c=r.skipToNextName(i,a-1);for(;h=r.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/W":c=this.parseNumberProp(o,r,c,!0);break;case"/S":const t=r.parseNameAt(c,!0);if(!t||!Object.values(xn).includes(t.value))throw new Error("Can't parse /S property value");this.S=t.value,c=t.end+1;break;case"/D":const s=r.parseNumberArrayAt(c,!0);if(!s)throw new Error("Can't parse /D property value");this.D=[null!==(e=s.value[0])&&void 0!==e?e:3,null!==(n=s.value[1])&&void 0!==n?n:0],c=s.end+1;break;default:c=r.skipToNextName(c,a-1)}}}class _n extends dn{constructor(){super(null),this._objectIdMap=new Map,this._dictParserMap=new Map}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new _n;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}getObjectId(t){return this._objectIdMap.get(t)}*getObjectIds(){for(const t of this._objectIdMap)yield t}getDictParser(t){return this._dictParserMap.get(t)}*getDictParsers(){for(const t of this._dictParserMap)yield t}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this._objectIdMap.forEach(((e,s)=>{r.push(...n.encode(s),P,...e.toArray(t))}));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){default:const n=e.getValueTypeAt(o);if(n===xe){const t=an.parseRef(e,o);if(t){this._objectIdMap.set(i,t.value),o=t.end+1;break}}else if(n===ye){const n=e.getDictBoundsAt(o);if(n){const r={parser:new tn(e.sliceCharCodes(n.start,n.end)),bounds:{start:0,end:n.end-n.start,contentStart:n.contentStart-n.start,contentEnd:n.contentEnd-n.start},cryptInfo:t.cryptInfo};this._dictParserMap.set(i,r),o=n.end+1;break}}o=e.skipToNextName(o,s-1)}}}class En extends dn{constructor(){super(ce)}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new En;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Subtype&&r.push(...n.encode("/Subtype "),...n.encode(" "+this.Subtype)),this.BaseFont&&r.push(...n.encode("/BaseFont "),...n.encode(" "+this.BaseFont)),this.Encoding&&r.push(...n.encode("/Encoding "),...n.encode(" "+this.Encoding)),this.ToUnicode&&r.push(...n.encode("/G "),P,...this.ToUnicode.toArray(t));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Subtype":const t=e.parseNameAt(o,!0);if(t){if("/Type1"===t.value||"/TrueType"===t.value){this.Subtype=t.value,o=t.end+1;break}throw new Error(`Font type is not supported: ${t.value}`)}throw new Error("Can't parse /Subtype property value");case"/BaseFont":case"/Encoding":o=this.parseNameProp(i,e,o);break;case"/ToUnicode":o=this.parseRefProp(i,e,o);break;default:o=e.skipToNextName(o,s-1)}}}class Cn extends dn{constructor(){super(oe),this.TR="/Identity"}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Cn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.S&&r.push(...n.encode("/S "),...n.encode(this.S)),this.G&&r.push(...n.encode("/G "),P,...this.G.toArray(t)),this.BC&&(r.push(...n.encode("/BC "),$),this.BC.forEach((t=>r.push(P,...n.encode(" "+t)))),r.push(et)),this.TR&&r.push(...n.encode("/TR "),...n.encode(" "+this.TR));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/S":const t=e.parseNameAt(o,!0);if(!t||!Object.values(Ne).includes(t.value))throw new Error("Can't parse /S property value");this.S=t.value,o=t.end+1;break;case"/G":o=this.parseRefProp(i,e,o);break;case"/BC":o=this.parseNumberArrayProp(i,e,o);break;case"/TR":default:o=e.skipToNextName(o,s-1)}}}class Sn extends dn{constructor(){super(ie)}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Sn;e.parseProps(t);const n=new Proxy(e,e.onChange);return e._proxy=n,{value:n,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.LW&&r.push(...n.encode("/LW "),...n.encode(" "+this.LW)),this.LC&&r.push(...n.encode("/LC "),...n.encode(" "+this.LC)),this.LJ&&r.push(...n.encode("/LJ "),...n.encode(" "+this.LJ)),this.ML&&r.push(...n.encode("/ML "),...n.encode(" "+this.ML)),this.D&&r.push(...n.encode("/D "),$,$,...n.encode(""+this.D[0][0]),...n.encode(" "+this.D[0][1]),et,...n.encode(" "+this.D[1]),et),this.RI&&r.push(...n.encode("/RI "),...n.encode(this.RI)),this.OP&&r.push(...n.encode("/OP "),...n.encode(" "+this.OP)),this.op&&r.push(...n.encode("/op "),...n.encode(" "+this.op)),this.OPM&&r.push(...n.encode("/OPM "),...n.encode(" "+this.OPM)),this.Font&&r.push(...n.encode("/Font "),$,...this.Font[0].toArray(t),...n.encode(" "+this.Font[1]),et),this.FL&&r.push(...n.encode("/FL "),...n.encode(" "+this.FL)),this.SM&&r.push(...n.encode("/SM "),...n.encode(" "+this.SM)),this.SA&&r.push(...n.encode("/SA "),...n.encode(" "+this.SA)),this.BM&&r.push(...n.encode("/BM "),...n.encode(this.BM)),this.SMask&&(this.SMask instanceof Cn?r.push(...n.encode("/SMask "),...this.SMask.toArray(t)):r.push(...n.encode("/SMask "),...n.encode(this.SMask))),this.CA&&r.push(...n.encode("/CA "),...n.encode(" "+this.CA)),this.ca&&r.push(...n.encode("/ca "),...n.encode(" "+this.ca)),this.AIS&&r.push(...n.encode("/AIS "),...n.encode(" "+this.AIS)),this.TK&&r.push(...n.encode("/AIS "),...n.encode(" "+this.TK));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}toParams(){const t={};if(isNaN(this.LW)||(t.strokeWidth=this.LW),!isNaN(this.LC))switch(this.LC){case Ce.BUTT:t.strokeLineCap="butt";break;case Ce.ROUND:t.strokeLineCap="round";break;case Ce.SQUARE:t.strokeLineCap="square"}if(!isNaN(this.LJ))switch(this.LJ){case Se.BEVEL:t.strokeLineJoin="bevel";break;case Se.ROUND:t.strokeLineJoin="round";break;case Se.MITER:t.strokeLineJoin="miter"}return this.ML&&(t.strokeMiterLimit=this.ML),this.D&&(t.strokeDashArray=`${this.D[0][0]} ${this.D[0][1]}`,t.strokeDashOffset=this.D[1]),this.Font,this.BM&&(t.mixBlendMode="normal"),this.SMask,this.CA&&(t.strokeAlpha=this.CA),this.ca&&(t.fillAlpha=this.ca),this.AIS,t}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/LC":const t=e.parseNumberAt(o,!0);if(!t||!Object.values(Ce).includes(t.value))throw new Error("Can't parse /LC property value");this.LC=t.value,o=t.end+1;break;case"/OPM":const n=e.parseNumberAt(o,!0);if(!n||![0,1].includes(n.value))throw new Error("Can't parse /OPM property value");this.OPM=n.value,o=n.end+1;break;case"/LJ":const r=e.parseNumberAt(o,!0);if(!r||!Object.values(Se).includes(r.value))throw new Error("Can't parse /LJ property value");this.LJ=r.value,o=r.end+1;break;case"/RI":const a=e.parseNameAt(o,!0);if(!a||!Object.values(Pe).includes(a.value))throw new Error("Can't parse /RI property value");this.RI=a.value,o=a.end+1;break;case"/BM":const h=e.parseNameAt(o,!0);if(!h||!Object.values(ke).includes(h.value))throw new Error("Can't parse /BM property value");this.BM=h.value,o=h.end+1;break;case"/SMask":const c=e.getValueTypeAt(o);if(c===me){const t=e.parseNameAt(o);if(t){this.SMask=t.value,o=t.end+1;break}throw new Error("Can't parse /SMask property name")}if(c===ye){const t=e.getDictBoundsAt(o);if(t){const n=Cn.parse({parser:e,bounds:t});if(n){this.SMask=n.value,o=n.end+1;break}}throw new Error("Can't parse /SMask value dictionary")}throw new Error(`Unsupported /SMask property value type: ${c}`);case"/Font":const d=e.getValueTypeAt(o);if(d!==we)throw new Error(`Unsupported /Font property value type: ${d}`);{const t=e.getArrayBoundsAt(o);if(t){const n=an.parse(e,t.start+1);if(n){const r=e.parseNumberAt(n.end+1);if(r){this.Font=[n.value,r.value],o=t.end+1;break}}}}throw new Error("Can't parse /Font property value");case"/D":const l=e.getValueTypeAt(o);if(l!==we)throw new Error(`Unsupported /D property value type: ${l}`);{const t=e.getArrayBoundsAt(o);if(t){const n=e.parseNumberArrayAt(t.start+1);if(n){const r=e.parseNumberAt(n.end+1);if(r){this.D=[[n.value[0],n.value[1]],r.value],o=t.end+1;break}}}}throw new Error("Can't parse /D property value");case"/OP":case"/op":case"/SA":case"/AIS":case"/TK":o=this.parseBoolProp(i,e,o);break;case"/LW":case"/ML":case"/FL":case"/SM":case"/CA":case"/ca":o=this.parseNumberProp(i,e,o);break;default:o=e.skipToNextName(o,s-1)}}}class Pn extends dn{constructor(){super(null),this._gsMap=new Map,this._fontsMap=new Map,this._xObjectsMap=new Map}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Pn;e.parseProps(t);const n=new Proxy(e,e.onChange);return e._proxy=n,{value:n,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];if(this._gsMap.size){r.push(...n.encode("/ExtGState ")),r.push(...yt.DICT_START);for(const[e,s]of this._gsMap)r.push(...n.encode(e.slice(10)),P),s.ref?r.push(...an.fromRef(s.ref).toArray(t)):r.push(...s.toArray(t));r.push(...yt.DICT_END)}if(this._xObjectsMap.size){r.push(...n.encode("/XObject "),...yt.DICT_START);for(const[e,s]of this._xObjectsMap){const i=s.ref;if(!i)throw new Error("XObject has no reference");r.push(...n.encode(e.slice(8)),P),r.push(...an.fromRef(i).toArray(t))}r.push(...yt.DICT_END)}this.ColorSpace&&r.push(...n.encode("/ColorSpace "),...this.ColorSpace.toArray(t)),this.Pattern&&r.push(...n.encode("/Pattern "),...this.Pattern.toArray(t)),this.Shading&&r.push(...n.encode("/Shading "),...this.Shading.toArray(t)),this.Font&&r.push(...n.encode("/Font "),...this.Font.toArray(t)),this.Properties&&r.push(...n.encode("/Properties "),...this.Properties.toArray(t)),this.ProcSet&&(r.push(...n.encode("/ProcSet "),$),this.ProcSet.forEach((t=>r.push(P,...n.encode(t)))),r.push(et));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}getGraphicsState(t){return this._gsMap.get(t)}*getGraphicsStates(){for(const t of this._gsMap)yield t}setGraphicsState(t,e){this._gsMap.set(`/ExtGState${t}`,e),this._edited=!0}getFont(t){return this._fontsMap.get(t)}*getFonts(){for(const t of this._fontsMap)yield t}getXObject(t){return this._xObjectsMap.get(t)}*getXObjects(){for(const t of this._xObjectsMap)yield t}setXObject(t,e){this._xObjectsMap.set(`/XObject${t}`,e),this._edited=!0}fillMaps(t,e){if(this._gsMap.clear(),this._fontsMap.clear(),this._xObjectsMap.clear(),this.ExtGState){for(const[e,n]of this.ExtGState.getObjectIds()){const r=t(n.id);if(!r)continue;const s=Sn.parse(r);s&&this._gsMap.set(`/ExtGState${e}`,s.value)}for(const[t,e]of this.ExtGState.getDictParsers()){const n=Sn.parse(e);n&&this._gsMap.set(`/ExtGState${t}`,n.value)}}if(this.XObject)for(const[e,n]of this.XObject.getObjectIds()){const r=t(n.id);if(!r)continue;const s=r.parser.findSubarrayIndex(yt.FORM,{direction:"straight",minIndex:r.bounds.start,maxIndex:r.bounds.end})?Dn.parse(r):vn.parse(r);s&&this._xObjectsMap.set(`/XObject${e}`,s.value)}if(this.Font)for(const[e,n]of this.Font.getObjectIds()){const r=t(n.id);if(!r)continue;const s=En.parse(r);s&&this._fontsMap.set(`/Font${e}`,s.value)}}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/ExtGState":case"/ColorSpace":case"/Pattern":case"/Shading":case"/XObject":case"/Font":case"/Properties":const t=e.getDictBoundsAt(o);if(t){const n=_n.parse({parser:e,bounds:t});if(n){this[i.slice(1)]=n.value,o=t.end+1;break}}throw new Error(`Can't parse ${i} property value`);case"/ProcSet":o=this.parseNameArrayProp(i,e,o);break;default:o=e.skipToNextName(o,s-1)}t.parseInfoGetter&&this.fillMaps(t.parseInfoGetter,t.cryptInfo)}}class kn extends dn{constructor(){super(se),this.Subtype="/RL"}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new kn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Subtype&&r.push(...n.encode("/Subtype "),...n.encode(this.Subtype));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Subtype":const t=e.parseNameAt(o);if(!t)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==t.value)throw new Error(`Ivalid dict subtype: '${t.value}' instead of '${this.Subtype}'`);o=t.end+1;break;default:o=e.skipToNextName(o,s-1)}}}class In extends dn{constructor(){super(he),this.S="/Transparency"}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.S&&r.push(...n.encode("/S "),...n.encode(this.S));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/S":const t=e.parseNameAt(o,!0);if(!t)throw new Error("Can't parse /S property value");if(!Object.values(le).includes(t.value))throw new Error(`Ivalid dict subtype: '${t.value}'`);this.S=t.value,o=t.end+1;break;default:o=e.skipToNextName(o,s-1)}}}class Bn extends In{constructor(){super(),this.I=!1,this.K=!1}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Bn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.CS&&r.push(...n.encode("/CS "),...n.encode(this.CS)),this.I&&r.push(...n.encode("/I "),...n.encode(" "+this.I)),this.K&&r.push(...n.encode("/K "),...n.encode(" "+this.K));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){if(super.parseProps(t),"/Transparency"!==this.S)throw new Error("Not a transparency dict");const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/CS":const t=e.getValueTypeAt(o);if(t===me){const t=e.parseNameAt(o);if(t){this.CS=t.value,o=t.end+1;break}throw new Error("Can't parse /CS property name")}if(t===we){const t=e.getArrayBoundsAt(o);if(t){o=t.end+1;break}throw new Error("Can't parse /CS value dictionary")}throw new Error(`Unsupported /CS property value type: ${t}`);case"/I":case"/K":o=this.parseBoolProp(i,e,o);break;default:o=e.skipToNextName(o,s-1)}}}class Dn extends gn{constructor(){super(Zt),this.Subtype="/Form",this.FormType=1,this.Matrix=[1,0,0,1,0,0]}get matrix(){const t=new w;if(this.Matrix){const[e,n,r,s,i,a]=this.Matrix;t.set(e,n,0,r,s,0,i,a,1)}return t}set matrix(t){t&&(this.Matrix=[...t.toFloatShortArray()])}get bBox(){return{ll:new A(this.BBox[0],this.BBox[1]),lr:new A(this.BBox[2],this.BBox[1]),ur:new A(this.BBox[2],this.BBox[3]),ul:new A(this.BBox[0],this.BBox[3])}}get transformedBBox(){const t=new w;if(this.Matrix){const[e,n,r,s,i,a]=this.Matrix;t.set(e,n,0,r,s,0,i,a,1)}const e=new A(this.BBox[0],this.BBox[1]),n=new A(this.BBox[2],this.BBox[1]),r=new A(this.BBox[2],this.BBox[3]),s=new A(this.BBox[0],this.BBox[3]);return{ll:A.applyMat3(e,t),lr:A.applyMat3(n,t),ur:A.applyMat3(r,t),ul:A.applyMat3(s,t)}}get edited(){return this._edited||this.Resources.edited}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Dn;e.parseProps(t);const n=new Proxy(e,e.onChange);return e._proxy=n,{value:n,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Subtype&&r.push(...n.encode("/Subtype "),...n.encode(this.Subtype)),this.FormType&&r.push(...n.encode("/FormType "),...n.encode(" "+this.FormType)),this.BBox&&r.push(...n.encode("/BBox "),$,...n.encode(this.BBox[0]+""),P,...n.encode(this.BBox[1]+""),P,...n.encode(this.BBox[2]+""),P,...n.encode(this.BBox[3]+""),et),this.Matrix&&r.push(...n.encode("/Matrix "),$,...n.encode(this.Matrix[0]+""),P,...n.encode(this.Matrix[1]+""),P,...n.encode(this.Matrix[2]+""),P,...n.encode(this.Matrix[3]+""),P,...n.encode(this.Matrix[4]+""),P,...n.encode(this.Matrix[5]+""),et),this.Resources&&r.push(...n.encode("/Resources "),...this.Resources.toArray(t)),this.Metadata&&r.push(...n.encode("/Metadata "),P,...this.Metadata.toArray(t)),this.LastModified&&r.push(...n.encode("/LastModified "),...this.LastModified.toArray(t)),this.StructParent&&r.push(...n.encode("/StructParent "),...n.encode(" "+this.StructParent)),this.StructParents&&r.push(...n.encode("/StructParents "),...n.encode(" "+this.StructParents)),this.Measure&&r.push(...n.encode("/Measure "),...this.Measure.toArray(t)),this.Group&&r.push(...n.encode("/Group "),...this.Group.toArray(t));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=e.getDictBoundsAt(r);let i,a,o=e.skipToNextName(s.contentStart,s.contentEnd);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Subtype":const n=e.parseNameAt(o);if(!n)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==n.value)throw new Error(`Ivalid dict subtype: '${n.value}' instead of '${this.Subtype}'`);o=n.end+1;break;case"/FormType":const r=e.parseNumberAt(o,!1);if(!r)throw new Error("Can't parse /FormType property value");if(1!==r.value)throw new Error(`Ivalid form type: '${r.value}' instead of '1'`);o=r.end+1;break;case"/BBox":case"/Matrix":o=this.parseNumberArrayProp(i,e,o,!0);break;case"/LastModified":o=this.parseDateProp(i,e,o,t.cryptInfo);break;case"/Metadata":o=this.parseRefProp(i,e,o);break;case"/StructParent":case"/StructParents":o=this.parseNumberProp(i,e,o,!1);break;case"/Resources":const a=e.getValueTypeAt(o);if(a===xe){const n=an.parseRef(e,o);if(n&&t.parseInfoGetter){const e=t.parseInfoGetter(n.value.id);if(e){const t=Pn.parse(e);if(t){this.Resources=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Resources value reference")}if(a===ye){const n=e.getDictBoundsAt(o);if(n){if(n.contentStart){const r=Pn.parse({parser:e,bounds:n,parseInfoGetter:t.parseInfoGetter});if(!r)throw new Error("Can't parse /Resources value dictionary");this.Resources=r.value}o=n.end+1;break}throw new Error("Can't parse /Resources dictionary bounds")}throw new Error(`Unsupported /Resources property value type: ${a}`);case"/Measure":const h=e.getValueTypeAt(o);if(h===xe){const n=an.parseRef(e,o);if(n&&t.parseInfoGetter){const e=t.parseInfoGetter(n.value.id);if(e){const t=kn.parse(e);if(t){this.Measure=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Measure value reference")}if(h===ye){const n=e.getDictBoundsAt(o);if(n){const r=kn.parse({parser:e,bounds:n,cryptInfo:t.cryptInfo});if(r){this.Measure=r.value,o=r.end+1;break}}throw new Error("Can't parse /Measure value dictionary")}throw new Error(`Unsupported /Measure property value type: ${h}`);case"/Group":const c=e.getValueTypeAt(o);if(c===xe){const n=an.parseRef(e,o);if(n&&t.parseInfoGetter){const e=t.parseInfoGetter(n.value.id);if(e){const t=Bn.parse(e);if(t){this.Group=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Group value reference")}if(c===ye){const n=e.getDictBoundsAt(o);if(n){const r=Bn.parse({parser:e,bounds:n,cryptInfo:t.cryptInfo});if(r){this.Group=r.value,o=r.end+1;break}}throw new Error("Can't parse /Group value dictionary")}throw new Error(`Unsupported /Group property value type: ${c}`);case"/OC":case"/OPI":default:o=e.skipToNextName(o,s.contentEnd)}if(!this.BBox)throw new Error("Not all required properties parsed")}}class Mn extends dn{constructor(){super(null),this._streamsMap=new Map}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Mn;e.parseProps(t);const n=new Proxy(e,e.onChange);return e._proxy=n,{value:n,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}getStream(t){return this._streamsMap.get(t)}*getStreams(){for(const t of this._streamsMap)yield t[1]}setStream(t,e){this._streamsMap.set(t,e),this._edited=!0}clearStreams(){this._streamsMap.clear(),this._edited=!0}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[],s=this._streamsMap.get("/N");s?(r.push(...n.encode("/N ")),r.push(...an.fromRef(s.ref).toArray(t))):this.N&&(r.push(...n.encode("/N ")),this.N,r.push(...this.N.toArray(t)));const i=this._streamsMap.get("/R");i?(r.push(...n.encode("/R ")),r.push(...an.fromRef(i.ref).toArray(t))):this.R&&(r.push(...n.encode("/R ")),this.R,r.push(...this.R.toArray(t)));const a=this._streamsMap.get("/D");a?(r.push(...n.encode("/D ")),r.push(...an.fromRef(a.ref).toArray(t))):this.D&&(r.push(...n.encode("/D ")),this.D,r.push(...this.D.toArray(t)));const o=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(o)}fillStreamsMap(t){this._streamsMap.clear();for(const e of["N","R","D"])if(this[e])if(this[e]instanceof an){const n=t(this[e].id);if(!n)continue;const r=Dn.parse(n);if(!r)continue;r&&this._streamsMap.set(`/${e}`,r.value)}else for(const[n,r]of this[e].getProps()){const s=t(r.id);if(!s)continue;const i=Dn.parse(s);i&&this._streamsMap.set(`/${e}${n}`,i.value)}}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/N":const t=e.getValueTypeAt(o);if(t===xe){const t=an.parseRef(e,o);if(t){this.N=t.value,o=t.end+1;break}}else{if(t!==ye)throw new Error(`Unsupported /N property value type: ${t}`);{const t=e.getDictBoundsAt(o);if(t){const n=_n.parse({parser:e,bounds:t});if(n){this.N=n.value,o=n.end+1;break}}}}throw new Error("Can't parse /N property value");case"/R":const n=e.getValueTypeAt(o);if(n===xe){const t=an.parseRef(e,o);if(t){this.R=t.value,o=t.end+1;break}}else{if(n!==ye)throw new Error(`Unsupported /R property value type: ${n}`);{const t=e.getDictBoundsAt(o);if(t){const n=_n.parse({parser:e,bounds:t});if(n){this.R=n.value,o=n.end+1;break}}}}throw new Error("Can't parse /R property value");case"/D":const r=e.getValueTypeAt(o);if(r===xe){const t=an.parseRef(e,o);if(t){this.D=t.value,o=t.end+1;break}}else{if(r!==ye)throw new Error(`Unsupported /D property value type: ${r}`);{const t=e.getDictBoundsAt(o);if(t){const n=_n.parse({parser:e,bounds:t});if(n){this.D=n.value,o=n.end+1;break}}}}throw new Error("Can't parse /D property value");default:o=e.skipToNextName(o,s-1)}if(!this.N)throw new Error("Not all required properties parsed");t.parseInfoGetter&&this.fillStreamsMap(t.parseInfoGetter)}}const Nn={NONE:"/S",CLOUDY:"/C"};class Rn extends dn{constructor(){super(null),this.S=Nn.NONE,this.L=0}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Rn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.S&&r.push(...n.encode("/S "),...n.encode(this.S)),this.L&&r.push(...n.encode("/L "),...n.encode(" "+this.L));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/S":const t=e.parseNameAt(o,!0);if(!t||!Object.values(Nn).includes(t.value))throw new Error("Can't parse /S property value");this.S=t.value,o=t.end+1;break;case"/L":o=this.parseNumberProp(i,e,o,!0);break;default:o=e.skipToNextName(o,s-1)}}}class Tn{constructor(t,e,n,r,s){this.hCornerR=null!=t?t:0,this.vCornerR=null!=e?e:0,this.width=null!=n?n:1,this.dash=null!=r?r:3,this.gap=null!=s?s:0}static parse(t,e,n=!0){if(n&&(e=t.findNonSpaceIndex("straight",e)),e<0||e>t.maxIndex||t.getCharCode(e)!==$)return null;const r=t.parseNumberAt(e+1);if(!r||isNaN(r.value))return null;const s=t.parseNumberAt(r.end+2);if(!s||isNaN(s.value))return null;const i=t.parseNumberAt(s.end+2);if(!i||isNaN(i.value))return null;const a=t.findNonSpaceIndex("straight",i.end+1);if(!a)return null;if(t.getCharCode(a)===et)return{value:new Tn(r.value,s.value,i.value),start:e,end:a};if(t.getCharCode(a)===$){const n=t.parseNumberAt(a+1);if(!n||isNaN(n.value))return null;const o=t.parseNumberAt(n.end+2);if(!o||isNaN(o.value))return null;const h=t.findNonSpaceIndex("straight",o.end+1);if(!h||t.getCharCode(h)!==et)return null;const c=t.findNonSpaceIndex("straight",h+1);return c&&t.getCharCode(c)===et?{value:new Tn(r.value,s.value,i.value,n.value,o.value),start:e,end:c}:null}return null}toArray(t){const e=this.dash&&this.gap?`[${this.hCornerR} ${this.vCornerR} ${this.width}]`:`[${this.hCornerR} ${this.vCornerR} ${this.width} [${this.dash} ${this.gap}]]`;return(new TextEncoder).encode(e)}}class Ln{constructor(t){Object.assign(this,Ln.defaultParams,t)}clone(t){const e=new Ln(this);return t?Object.assign(e,t):e}}Ln.defaultParams={fontFamily:"helvetica, sans-serif",fontSize:"12px",lineHeight:"1",letterSpacing:"normal",wordSpacing:"normal",textHorScale:1,textRenderMode:0,textVertAlign:"0",textKnockOut:!0};class Un{constructor(t){var e,n,r,s;Object.assign(this,Un.defaultParams,t),this.matrix=null===(e=this.matrix)||void 0===e?void 0:e.clone(),this.textState=null===(n=this.textState)||void 0===n?void 0:n.clone(),this.strokeColor=null===(r=this.strokeColor)||void 0===r?void 0:r.clone(),this.fillColor=null===(s=this.fillColor)||void 0===s?void 0:s.clone()}get stroke(){const{x:t,y:e,z:n}=this.strokeColor;return`rgba(${t},${e},${n},${this.strokeAlpha})`}get fill(){const{x:t,y:e,z:n}=this.fillColor;return`rgba(${t},${e},${n},${this.fillAlpha})`}clone(t){const e=new Un(this);return t?Object.assign(e,t):e}setColor(t,...e){let n,r,s;switch(e.length){case 1:n=r=s=255*e[0];break;case 3:n=255*e[0],r=255*e[1],s=255*e[2];break;case 4:const[t,i,a,o]=e;n=255*(1-t)*(1-o),r=255*(1-i)*(1-o),s=255*(1-a)*(1-o)}"stroke"===t?this.strokeColor.set(n,r,s):this.fillColor.set(n,r,s)}}Un.defaultParams={matrix:new w,textState:new Ln,strokeColorSpace:"rgb",strokeAlpha:1,strokeColor:new m,fillColorSpace:"rgb",fillAlpha:1,fillColor:new m,strokeWidth:1,strokeMiterLimit:10,strokeLineCap:"square",strokeLineJoin:"miter"};var On=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class Fn{constructor(t,e,n){if(this._clipPaths=[],this._graphicsStates=[],!t)throw new Error("Stream is not defined");this._stream=t,this._parser=new tn(t.decodedStreamData),this._rect=e,this._objectName=n;const r=Fn.calcBBoxToRectMatrix(t,e),s=document.createElementNS("http://www.w3.org/2000/svg","clipPath");s.id=`clip0_${n}`,s.innerHTML=`<rect x="${e[0]}" y="${e[1]}" width="${e[2]-e[0]}" height="${e[3]-e[1]}" />`,this._clipPaths.push(s),this._graphicsStates.push(new Un({matrix:r}))}get state(){return this._graphicsStates[this._graphicsStates.length-1]}static calcBBoxToRectMatrix(t,e){const n=t.matrix,{ll:r,lr:s,ur:i,ul:a}=t.bBox,{min:o,max:h}=v(A.applyMat3(r,n),A.applyMat3(s,n),A.applyMat3(i,n),A.applyMat3(a,n)),c=y(o,h,new A(e[0],e[1]),new A(e[2],e[3]));return w.fromMat3(n).multiply(c)}static parseNextCommand(t,e){const n=[];let r;t:for(;!r;){const s=t.getValueTypeAt(e,!0);switch(s){case fe:const i=t.parseNumberAt(e,!0);n.push(i.value),e=i.end+1;break;case me:const a=t.parseNameAt(e,!0);n.push(a.value),e=a.end+1;break;case we:const o=t.getArrayBoundsAt(e),h=t.parseNumberArrayAt(e,!0);if(!h)throw new Error(`Invalid appearance stream array: \n            ${t.sliceChars(o.start,o.end)}`);{const t=h.value;2===t.length?n.push(...t):1===t.length?n.push(t[0],0):n.push(3,0)}e=o.end+1;break;case ge:const c=hn.parse(t,e);n.push(c.value.literal),e=c.end+1;break;case Ae:const d=mn.parse(t,e);n.push(d.value.hex),e=d.end+1;break;case pe:const l=t.parseStringAt(e);r=l.value,e=l.end+1;break t;default:throw new Error(`Invalid appearance stream value type: ${s}`)}}return{endIndex:e,parameters:n,operator:r}}renderAsync(){return On(this,void 0,void 0,(function*(){return{svg:yield this.drawGroupAsync(this._parser),clipPaths:this._clipPaths}}))}pushState(t){const e=this._graphicsStates[this._graphicsStates.length-1].clone(t);this._graphicsStates.push(e)}popState(){return 1===this._graphicsStates.length?null:this._graphicsStates.pop()}drawPath(t,e,n,r=!1,s=!1){r&&"Z"!==t[t.length-1]&&(t+=" Z");const i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("transform",`matrix(${this.state.matrix.toFloatShortArray().join(" ")})`),i.setAttribute("clipPath",`url(#${this._clipPaths[this._clipPaths.length-1].id})`),i.setAttribute("d",t),this.state.mixBlendMode&&i.setAttribute("mix-blend-mode",this.state.mixBlendMode),n?(i.setAttribute("fill",this.state.fill),i.setAttribute("fill-rule",s?"evenodd":"nonzero")):i.setAttribute("fill","none"),e?(i.setAttribute("stroke",this.state.stroke),i.setAttribute("stroke-width",this.state.strokeWidth+""),i.setAttribute("stroke-miterlimit",this.state.strokeMiterLimit+""),i.setAttribute("stroke-linecap",this.state.strokeLineCap),i.setAttribute("stroke-linejoin",this.state.strokeLineJoin),this.state.strokeDashArray&&i.setAttribute("stroke-dasharray",this.state.strokeDashArray),this.state.strokeDashOffset&&i.setAttribute("stroke-dashoffset",this.state.strokeDashOffset+"")):i.setAttribute("stroke","none"),i}drawText(t){throw new Error("Method is not implemented")}drawTextGroup(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g");let n=0;for(;-1!==n;){const{endIndex:e,parameters:r,operator:s}=Fn.parseNextCommand(t,n);n=t.skipEmpty(e+1)}return e}drawGroupAsync(t){return On(this,void 0,void 0,(function*(){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),n=new A;let r,s="";const i=t=>{e.append(t),s=""};let a=0;for(;-1!==a;){const{endIndex:o,parameters:h,operator:c}=Fn.parseNextCommand(t,a);switch(a=t.skipEmpty(o+1),c){case"q":this.pushState();break;case"Q":this.popState();break;case"gs":const o=this._stream.Resources.getGraphicsState(`/ExtGState${h[0]}`);if(!o)throw new Error("External state specified in appearance stream not found");const d=o.toParams();Object.assign(this.state,d);break;case"cm":const[l,p,u,f,g,m]=h,y=(new w).set(l,p,0,u,f,0,g,m,1);this.state.matrix=y.multiply(this.state.matrix);break;case"w":this.state.strokeWidth=+h[0]||1;break;case"J":switch(h[0]){case Ce.ROUND:this.state.strokeLineCap="round";break;case Ce.SQUARE:this.state.strokeLineCap="square";break;case Ce.BUTT:default:this.state.strokeLineCap="butt"}break;case"j":switch(h[0]){case Se.BEVEL:this.state.strokeLineJoin="bevel";break;case Se.ROUND:this.state.strokeLineJoin="round";break;case Se.MITER:default:this.state.strokeLineJoin="miter"}break;case"M":this.state.strokeMiterLimit=+h[0]||10;break;case"d":this.state.strokeDashArray=`${h[0]} ${h[1]}`,this.state.strokeDashOffset=+h[2];break;case"CS":switch(h[0]){case Ie:this.state.strokeColorSpace="grayscale";break;case Be:this.state.strokeColorSpace="rgb";break;case De:this.state.strokeColorSpace="cmyk";break;default:throw new Error("Unsupported color space in appearance stream")}break;case"cs":switch(h[0]){case Ie:this.state.fillColorSpace="grayscale";break;case Be:this.state.fillColorSpace="rgb";break;case De:this.state.fillColorSpace="cmyk";break;default:throw new Error("Unsupported color space in appearance stream")}break;case"G":this.state.strokeColorSpace="grayscale",this.state.setColor("stroke",...h);break;case"g":this.state.fillColorSpace="grayscale",this.state.setColor("fill",...h);break;case"RG":this.state.strokeColorSpace="rgb",this.state.setColor("stroke",...h);break;case"rg":this.state.fillColorSpace="rgb",this.state.setColor("fill",...h);break;case"K":this.state.strokeColorSpace="cmyk",this.state.setColor("stroke",...h);break;case"k":this.state.fillColorSpace="cmyk",this.state.setColor("fill",...h);break;case"SC":this.state.setColor("stroke",...h);break;case"cs":this.state.setColor("fill",...h);break;case"ri":case"i":break;case"m":const v=new A(+h[0],+h[1]);s+=` M ${v.x} ${v.y}`,n.setFromVec2(v);break;case"l":const x=new A(+h[0],+h[1]);s+=` L ${x.x} ${x.y}`,n.setFromVec2(x);break;case"re":const b=new A(+h[0],+h[1]),_=new A(+h[2],+h[3]).add(b);s+=` M ${b.x} ${b.y} L ${_.x} ${b.y} L ${_.x} ${_.y} L ${b.x} ${_.y} L ${b.x} ${b.y}`,n.setFromVec2(b);break;case"c":const E=new A(+h[0],+h[1]),C=new A(+h[2],+h[3]),S=new A(+h[4],+h[5]);s+=` C ${E.x} ${E.y}, ${C.x} ${C.y}, ${S.x} ${S.y}`,n.setFromVec2(S);break;case"v":const P=new A(+h[0],+h[1]),k=new A(+h[2],+h[3]);s+=` C ${n.x} ${n.y}, ${P.x} ${P.y}, ${k.x} ${k.y}`,n.setFromVec2(k);break;case"y":const I=new A(+h[0],+h[1]),B=new A(+h[2],+h[3]);s+=` C ${I.x} ${I.y}, ${B.x} ${B.y}, ${B.x} ${B.y}`,n.setFromVec2(B);break;case"h":s+=" Z";break;case"S":i(this.drawPath(s,!0,!1));break;case"s":i(this.drawPath(s,!0,!1,!0));break;case"F":case"f":i(this.drawPath(s,!1,!0,!0));break;case"F*":case"f*":i(this.drawPath(s,!1,!0,!0,!0));break;case"B":i(this.drawPath(s,!0,!0,!1,!1));break;case"B*":i(this.drawPath(s,!0,!0,!1,!0));break;case"b":i(this.drawPath(s,!0,!0,!0,!1));break;case"b*":i(this.drawPath(s,!0,!0,!0,!0));break;case"n":if("W"===r||"W*"===r){"Z"!==s[s.length-1]&&(s+=" Z");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",s);const e=this._clipPaths.length-1,n=document.createElementNS("http://www.w3.org/2000/svg","clipPath");n.setAttribute("clip-rule","W"===r?"nonzero":"evenodd"),n.setAttribute("clip-path",`url(#${this._clipPaths[e]})`),n.id=`clip${e+1}_${this._objectName}`,n.append(t),this._clipPaths.push(n),this.state.clipPath=n}s="";break;case"W":case"W*":break;case"BT":const D=t.findSubarrayIndex([Q,Y],{closedOnly:!0,minIndex:a});if(D){const n=this.drawTextGroup(new tn(t.sliceCharCodes(a,D.start-1)));e.append(n),a=t.skipEmpty(D.end+1);break}throw new Error("Can't find the appearance stream text object end");case"Do":const M=this._stream.Resources.getXObject(`/XObject${h[0]}`);if(!M)throw new Error(`External object not found in the appearance stream resources: ${h[0]}`);if(M instanceof Dn){const t=yield this.drawGroupAsync(new tn(M.decodedStreamData));e.append(t)}else{if(!(M instanceof vn))throw new Error(`Unsupported appearance stream external object: ${h[0]}`);{const t=yield M.getImageUrlAsync();if(!t)throw new Error("Can't get image url from external image stream");const n=document.createElementNS("http://www.w3.org/2000/svg","image");n.onerror=t=>{console.log(`Loading external image stream failed: ${t}`)},n.setAttribute("href",t),n.setAttribute("width",M.Width+""),n.setAttribute("height",M.Height+"");const r=(new w).applyTranslation(-M.Width/2,-M.Height/2).applyScaling(1,-1).applyTranslation(M.Width/2,M.Height/2).applyScaling(1/M.Width,1/M.Height).multiply(this.state.matrix);n.setAttribute("transform",`matrix(${r.toFloatShortArray().join(" ")})`),n.setAttribute("clipPath",`url(#${this._clipPaths[this._clipPaths.length-1].id})`),e.append(n)}}break;default:throw new Error(`Unsupported appearance stream operator: ${c}`)}r=c}return e}))}}var Vn=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class zn extends dn{constructor(t){super(ne),this.F=4,this.Border=new Tn(0,0,1),this._transformationMatrix=new w,this._transformationPoint=new A,this._currentAngle=0,this._boxX=new A,this._boxY=new A,this._svgId=l(),this.onRectPointerDown=t=>{this.$translationEnabled&&t.isPrimary&&(document.addEventListener("pointerup",this.onRectPointerUp),document.addEventListener("pointerout",this.onRectPointerUp),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),this._transformationPoint.setFromVec2(this.convertClientCoordsToPage(t.clientX,t.clientY)),document.addEventListener("pointermove",this.onRectPointerMove)}),200))},this.onRectPointerMove=t=>{if(!t.isPrimary)return;const e=this.convertClientCoordsToPage(t.clientX,t.clientY);this._transformationMatrix.reset().applyTranslation(e.x-this._transformationPoint.x,e.y-this._transformationPoint.y),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onRectPointerUp=t=>{if(t.isPrimary){if(document.removeEventListener("pointermove",this.onRectPointerMove),document.removeEventListener("pointerup",this.onRectPointerUp),document.removeEventListener("pointerout",this.onRectPointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyCommonTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()}},this.onRotationHandlePointerDown=t=>{t.isPrimary&&(document.addEventListener("pointerup",this.onRotationHandlePointerUp),document.addEventListener("pointerout",this.onRotationHandlePointerUp),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),document.addEventListener("pointermove",this.onRotationHandlePointerMove)}),200),t.stopPropagation())},this.onRotationHandlePointerMove=t=>{if(!t.isPrimary)return;const e=(this.Rect[0]+this.Rect[2])/2,n=(this.Rect[1]+this.Rect[3])/2,r=this.convertPageCoordsToClient(e,n),s=this.getCurrentRotation(),i=Math.atan2(t.clientY-r.y,t.clientX-r.x)+Math.PI/2-s;this._currentAngle=i,this._transformationMatrix.reset().applyTranslation(-e,-n).applyRotation(i).applyTranslation(e,n),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onRotationHandlePointerUp=t=>{if(t.isPrimary){if(document.removeEventListener("pointermove",this.onRotationHandlePointerMove),document.removeEventListener("pointerup",this.onRotationHandlePointerUp),document.removeEventListener("pointerout",this.onRotationHandlePointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyCommonTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()}},this.onScaleHandlePointerDown=t=>{if(!t.isPrimary)return;document.addEventListener("pointerup",this.onScaleHandlePointerUp),document.addEventListener("pointerout",this.onScaleHandlePointerUp);const e=t.target,{ll:n,lr:r,ur:s,ul:i}=this.getLocalBB(),a=e.dataset.handleName;switch(a){case"ll":this._transformationPoint.setFromVec2(s),this._boxX.setFromVec2(i).substract(s),this._boxY.setFromVec2(r).substract(s);break;case"lr":this._transformationPoint.setFromVec2(i),this._boxX.setFromVec2(s).substract(i),this._boxY.setFromVec2(n).substract(i);break;case"ur":this._transformationPoint.setFromVec2(n),this._boxX.setFromVec2(r).substract(n),this._boxY.setFromVec2(i).substract(n);break;case"ul":this._transformationPoint.setFromVec2(r),this._boxX.setFromVec2(n).substract(r),this._boxY.setFromVec2(s).substract(r);break;default:throw new Error(`Invalid handle name: ${a}`)}this._boxXLength=this._boxX.getMagnitude(),this._boxYLength=this._boxY.getMagnitude(),this._transformationTimer=setTimeout((()=>{this._transformationTimer=null,this._svg.after(this._svgContentCopy),document.addEventListener("pointermove",this.onScaleHandlePointerMove)}),200),t.stopPropagation()},this.onScaleHandlePointerMove=t=>{if(!t.isPrimary)return;const e=this.convertClientCoordsToPage(t.clientX,t.clientY).substract(this._transformationPoint),n=e.getMagnitude(),r=Math.abs(e.dotProduct(this._boxX))/n/this._boxXLength*n,s=Math.sqrt(n*n-r*r),i=r/this._boxXLength,a=s/this._boxYLength,o=(this.Rect[0]+this.Rect[2])/2,h=(this.Rect[1]+this.Rect[3])/2,c=this.getCurrentRotation();this._transformationMatrix.reset().applyTranslation(-o,-h).applyRotation(-c).applyScaling(i,a).applyRotation(c).applyTranslation(o,h);const d=this._transformationPoint.clone().substract(this._transformationPoint.clone().applyMat3(this._transformationMatrix));this._transformationMatrix.applyTranslation(d.x,d.y),this._svgContentCopyUse.setAttribute("transform",`matrix(${this._transformationMatrix.toFloatShortArray().join(" ")})`)},this.onScaleHandlePointerUp=t=>{if(t.isPrimary){if(document.removeEventListener("pointermove",this.onScaleHandlePointerMove),document.removeEventListener("pointerup",this.onScaleHandlePointerUp),document.removeEventListener("pointerout",this.onScaleHandlePointerUp),this._transformationTimer)return clearTimeout(this._transformationTimer),void(this._transformationTimer=null);this._svgContentCopy.remove(),this._svgContentCopyUse.setAttribute("transform","matrix(1 0 0 1 0 0)"),this.applyCommonTransform(this._transformationMatrix),this._transformationMatrix.reset(),this.updateRenderAsync()}},this.Subtype=t}get apStream(){var t;return this._apStream||(this._apStream=[...null===(t=this.AP)||void 0===t?void 0:t.getStreams()][0]),this._apStream}set apStream(t){this._apStream=t,this._edited=!0}get lastRenderResult(){return this._lastRenderResult}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];if(this.Subtype&&r.push(...n.encode("/Subtype "),...n.encode(this.Subtype)),this.Rect&&r.push(...n.encode("/Rect "),$,...n.encode(this.Rect[0]+""),P,...n.encode(this.Rect[1]+""),P,...n.encode(this.Rect[2]+""),P,...n.encode(this.Rect[3]+""),et),this.Contents&&r.push(...n.encode("/Contents "),...this.Contents.toArray(t)),this.P&&r.push(...n.encode("/P "),P,...this.P.toArray(t)),this.NM&&r.push(...n.encode("/NM "),...this.NM.toArray(t)),this.M&&r.push(...n.encode("/M "),...this.M.toArray(t)),this.F&&r.push(...n.encode("/F "),...n.encode(" "+this.F)),this.AS&&r.push(...n.encode("/AS "),...n.encode(this.AS)),this.Border&&r.push(...n.encode("/Border "),...this.Border.toArray(t)),this.BS&&r.push(...n.encode("/BS "),...this.BS.toArray(t)),this.BE&&r.push(...n.encode("/BE "),...this.BE.toArray(t)),this.C&&(r.push(...n.encode("/C "),$),this.C.forEach((t=>r.push(...n.encode(" "+t)))),r.push(et)),this.StructParent&&r.push(...n.encode("/StructParent "),...n.encode(" "+this.StructParent)),this.apStream){this.AP||(this.AP=new Mn);const e=this.apStream.ref;if(!e)throw new Error("Appearance stream has no reference");this.AP.N=an.fromRef(e),this.AP.R=null,this.AP.D=null,this.AP.clearStreams(),this.AP.setStream("/N",this.apStream),r.push(...n.encode("/AP "),...this.AP.toArray(t))}const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}renderAsync(){return Vn(this,void 0,void 0,(function*(){this._svg||(this._svg=this.renderMainElement()),yield this.updateRenderAsync();const t={svg:this._svg,clipPaths:this._svgClipPaths,tempCopy:this._svgContentCopy,tempCopyUse:this._svgContentCopyUse};return this._lastRenderResult=t,t}))}applyCommonTransform(t){this.applyRectTransform(t);const e=this._proxy||this,n=e.apStream;if(n){const r=n.matrix.multiply(t);e.apStream.matrix=r}e.M=on.fromDate(new Date)}moveTo(t,e){const n=t-(this.Rect[2]-this.Rect[0])/2,r=e-(this.Rect[3]-this.Rect[1])/2,s=w.buildTranslate(n,r);this.applyCommonTransform(s)}toDto(){var t,e;return{annotationType:"/Ink",uuid:this.$name,pageId:this.$pageId,dateCreated:this.CreationDate.date.toISOString()||(new Date).toISOString(),dateModified:this.M?this.M instanceof hn?this.M.literal:this.M.date.toISOString():(new Date).toISOString(),author:null===(t=this.T)||void 0===t?void 0:t.literal,rect:this.Rect,matrix:null===(e=this.apStream)||void 0===e?void 0:e.Matrix}}parseProps(t){var e;super.parseProps(t);const{parser:n,bounds:r}=t,s=r.contentStart||r.start,i=r.contentEnd||r.end;let a,o,h=n.skipToNextName(s,i-1);for(;o=n.parseNameAt(h),o;)switch(h=o.end+1,a=o.value,a){case"/Subtype":const e=n.parseNameAt(h);if(!e)throw new Error("Can't parse /Subtype property value");if(this.Subtype&&this.Subtype!==e.value)throw new Error(`Ivalid dict subtype: '${e.value}' instead of '${this.Subtype}'`);h=e.end+1;break;case"/Rect":h=this.parseNumberArrayProp(a,n,h,!0);break;case"/P":h=this.parseRefProp(a,n,h);break;case"/Contents":case"/NM":h=this.parseLiteralProp(a,n,h,t.cryptInfo);break;case"/M":const r=on.parse(n,h,t.cryptInfo);if(r){this.M=r.value,h=r.end+1;break}{const e=hn.parse(n,h,t.cryptInfo);if(e){this.M=e.value,h=e.end+1;break}}throw new Error("Can't parse /M property value");case"/C":h=this.parseNumberArrayProp(a,n,h,!0);break;case"/F":case"/StructParent":h=this.parseNumberProp(a,n,h,!1);break;case"/Border":const s=Tn.parse(n,h);if(!s)throw new Error("Can't parse /Border property value");this.Border=s.value,h=s.end+1;break;case"/BS":const o=n.getValueTypeAt(h);if(o===xe){const e=an.parseRef(n,h);if(e&&t.parseInfoGetter){const n=t.parseInfoGetter(e.value.id);if(n){const t=bn.parse(n);if(t){this.BS=t.value,h=t.end+1;break}}}throw new Error("Can't parse /BS value reference")}if(o===ye){const t=n.getDictBoundsAt(h);if(t){const e=bn.parse({parser:n,bounds:t});if(e){this.BS=e.value,h=e.end+1;break}}throw new Error("Can't parse /BS value dictionary")}throw new Error(`Unsupported /BS property value type: ${o}`);case"/BE":const c=n.getValueTypeAt(h);if(c===xe){const e=an.parseRef(n,h);if(e&&t.parseInfoGetter){const n=t.parseInfoGetter(e.value.id);if(n){const t=Rn.parse(n);if(t){this.BE=t.value,h=t.end+1;break}}}throw new Error("Can't parse /BE value reference")}if(c===ye){const t=n.getDictBoundsAt(h);if(t){const e=Rn.parse({parser:n,bounds:t});if(e){this.BE=e.value,h=e.end+1;break}}throw new Error("Can't parse /BE value dictionary")}throw new Error(`Unsupported /BE property value type: ${c}`);case"/AP":const d=n.getValueTypeAt(h);if(d===xe){const e=an.parseRef(n,h);if(e&&t.parseInfoGetter){const n=t.parseInfoGetter(e.value.id);if(n){const t=Mn.parse(n);if(t){this.AP=t.value,h=t.end+1;break}}}throw new Error("Can't parse /AP value reference")}if(d===ye){const e=n.getDictBoundsAt(h);if(e){const r=Mn.parse({parser:n,bounds:e,parseInfoGetter:t.parseInfoGetter});if(r){this.AP=r.value,h=r.end+1;break}}throw new Error("Can't parse /AP value dictionary")}throw new Error(`Unsupported /AP property value type: ${d}`);case"/AS":h=this.parseNameProp(a,n,h);break;case"/OC":default:h=n.skipToNextName(h,i-1)}if(!this.Subtype||!this.Rect)throw new Error("Not all required properties parsed");this.$name=(null===(e=this.NM)||void 0===e?void 0:e.literal)||l(),this.$pageRect=t.rect}getCurrentRotation(){var t;const e=null===(t=this.apStream)||void 0===t?void 0:t.matrix;if(!e)return 0;const{r:n}=e.getTRS();return n}getLocalBB(){let t,e,n,r;if(this._bBox)t=this._bBox.ll,e=this._bBox.lr,n=this._bBox.ur,r=this._bBox.ul;else if(this.apStream){const{ll:s,lr:i,ur:a,ul:o}=this.apStream.transformedBBox,{min:h,max:c}=v(s,i,a,o),d=y(h,c,new A(this.Rect[0],this.Rect[1]),new A(this.Rect[2],this.Rect[3]),!0);t=s.applyMat3(d),e=i.applyMat3(d),n=a.applyMat3(d),r=o.applyMat3(d)}else t=new A(this.Rect[0],this.Rect[1]),e=new A(this.Rect[2],this.Rect[1]),n=new A(this.Rect[2],this.Rect[3]),r=new A(this.Rect[0],this.Rect[3]);return this._bBox={ll:t,lr:e,ur:n,ul:r},this._bBox}applyRectTransform(t){const e=this._proxy||this,n=e.getLocalBB();n.ll.applyMat3(t),n.lr.applyMat3(t),n.ur.applyMat3(t),n.ul.applyMat3(t);const{min:r,max:s}=v(n.ll,n.lr,n.ur,n.ul);e.Rect=[r.x,r.y,s.x,s.y]}convertClientCoordsToPage(t,e){const{x:n,y:r,width:s,height:i}=this._svgBox.getBoundingClientRect(),a=new A(n,r),o=(new A(n+s,r+i).x-a.x)/(this.Rect[2]-this.Rect[0]),h=new A(n-this.Rect[0]*o,r+i+this.Rect[1]*o);return new A((t-h.x)/o,(h.y-e)/o)}convertPageCoordsToClient(t,e){const{x:n,y:r,width:s,height:i}=this._svgBox.getBoundingClientRect(),a=new A(n,r),o=(new A(n+s,r+i).x-a.x)/(this.Rect[2]-this.Rect[0]),h=new A(n-this.Rect[0]*o,r+i+this.Rect[1]*o);return new A(h.x+t*o,h.y-e*o)}renderRect(){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.classList.add("svg-annot-rect"),t.setAttribute("data-annotation-name",this.$name),t.setAttribute("x",this.Rect[0]+""),t.setAttribute("y",this.Rect[1]+""),t.setAttribute("width",this.Rect[2]-this.Rect[0]+""),t.setAttribute("height",this.Rect[3]-this.Rect[1]+""),t}renderBox(){const{ll:t,lr:e,ur:n,ul:r}=this.getLocalBB(),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.classList.add("svg-annot-box"),s.setAttribute("data-annotation-name",this.$name),s.setAttribute("d",`M ${t.x} ${t.y} L ${e.x} ${e.y} L ${n.x} ${n.y} L ${r.x} ${r.y} Z`),s}renderMainElement(){const t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.classList.add("svg-annotation"),t.setAttribute("data-annotation-name",this.$name),t.addEventListener("pointerdown",this.onRectPointerDown),t}renderApAsync(){return Vn(this,void 0,void 0,(function*(){const t=this.apStream;if(t)try{const e=new Fn(t,this.Rect,this.$name);return yield e.renderAsync()}catch(t){console.log(`Annotation stream render error: ${t.message}`)}return null}))}renderContent(){return null}renderContentCopy(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","defs"),n=document.createElementNS("http://www.w3.org/2000/svg","symbol");n.id=this._svgId+"_symbol";const r=document.createElementNS("http://www.w3.org/2000/svg","use");r.setAttribute("href",`#${this._svgId}`),this.$pageRect&&r.setAttribute("viewBox",`${this.$pageRect[0]} ${this.$pageRect[1]} ${this.$pageRect[2]} ${this.$pageRect[3]}`),n.append(r),e.append(n);const s=document.createElementNS("http://www.w3.org/2000/svg","use");return s.setAttribute("href",`#${this._svgId}_symbol`),s.setAttribute("opacity","0.2"),t.append(e,s),{copy:t,use:s}}renderScaleHandles(){const t=this.getLocalBB(),e=[];return["ll","lr","ur","ul"].forEach((n=>{const r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.classList.add("svg-annot-handle-scale"),r.setAttribute("data-handle-name",n),r.setAttribute("cx",t[n].x+""),r.setAttribute("cy",t[n].y+""),r.addEventListener("pointerdown",this.onScaleHandlePointerDown),e.push(r)})),e}renderRotationHandle(){const t=(this.Rect[0]+this.Rect[2])/2,e=(this.Rect[1]+this.Rect[3])/2,n=this.getCurrentRotation(),r=document.createElementNS("http://www.w3.org/2000/svg","g");r.classList.add("svg-annot-rotation"),r.setAttribute("data-handle-name","center");const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.classList.add("circle","dashed"),s.setAttribute("cx",t+""),s.setAttribute("cy",e+"");const i=(new w).applyTranslation(-t,35-e).applyRotation(n).applyTranslation(t,e),a=new A(t,e).applyMat3(i),o=document.createElementNS("http://www.w3.org/2000/svg","line");o.classList.add("dashed"),o.setAttribute("x1",t+""),o.setAttribute("y1",e+""),o.setAttribute("x2",a.x+""),o.setAttribute("y2",a.y+"");const h=document.createElementNS("http://www.w3.org/2000/svg","circle");return h.classList.add("svg-annot-handle-rotation"),h.setAttribute("data-handle-name","center"),h.setAttribute("cx",a.x+""),h.setAttribute("cy",a.y+""),h.addEventListener("pointerdown",this.onRotationHandlePointerDown),r.append(s,o,h),r}renderHandles(){return[...this.renderScaleHandles(),this.renderRotationHandle()]}updateRenderAsync(){return Vn(this,void 0,void 0,(function*(){this._svg.innerHTML="";const t=this.renderContent()||(yield this.renderApAsync());if(!t)return this._svgBox=null,this._svgContent=null,this._svgContentCopy=null,this._svgContentCopyUse=null,void(this._svgClipPaths=null);const e=t.svg;e.id=this._svgId,e.classList.add("svg-annotation-content"),e.setAttribute("data-annotation-name",this.$name);const{copy:n,use:r}=this.renderContentCopy(),s=this.renderRect(),i=this.renderBox(),a=this.renderHandles();this._svg.append(s,i,t.svg,...a),this._svgBox=i,this._svgContent=e,this._svgContentCopy=n,this._svgContentCopyUse=r,this._svgClipPaths=t.clipPaths}))}}const Hn={REPLY:"/R",GROUP:"/Group"};class Gn extends zn{constructor(t){super(t),this.RT=Hn.REPLY}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.T&&r.push(...n.encode("/T "),...this.T.toArray(t)),this.Popup&&r.push(...n.encode("/Popup "),P,...this.Popup.toArray(t)),this.RC&&r.push(...n.encode("/RC "),...this.RC.toArray(t)),this.CA&&r.push(...n.encode("/CA "),...n.encode(" "+this.CA)),this.CreationDate&&r.push(...n.encode("/CreationDate "),...this.CreationDate.toArray(t)),this.Subj&&r.push(...n.encode("/Subj "),...this.Subj.toArray(t)),this.IRT&&r.push(...n.encode("/IRT "),P,...this.IRT.toArray(t)),this.RT&&r.push(...n.encode("/RT "),...n.encode(this.RT));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/T":case"/Subj":o=this.parseLiteralProp(i,e,o,t.cryptInfo);break;case"/Popup":case"/IRT":o=this.parseRefProp(i,e,o);break;case"/RC":const n=e.getValueTypeAt(o);if(n===xe){const n=an.parseRef(e,o);if(n&&t.parseInfoGetter){const e=t.parseInfoGetter(n.value.id);if(e){const t=e.type||e.parser.getValueTypeAt(e.bounds.contentStart);if(t===ge){const t=hn.parse(e.parser,e.bounds.contentStart);if(t){this.RC=t.value,o=n.end+1;break}}else{if(t!==ye)throw new Error(`Unsupported /RC property value type: ${t}`);{const t=An.parse(e);if(t){const e=t.value.getText();this.RC=hn.fromString(e),o=n.end+1;break}}}}}throw new Error("Can't parse /RC value reference")}if(n===ge){const n=hn.parse(e,o,t.cryptInfo);if(n){this.RC=n.value,o=n.end+1;break}throw new Error("Can't parse /RC property value")}throw new Error(`Unsupported /RC property value type: ${n}`);case"/CA":o=this.parseNumberProp(i,e,o,!0);break;case"/CreationDate":o=this.parseDateProp(i,e,o,t.cryptInfo);break;case"/RT":const r=e.parseNameAt(o,!0);if(!r||!Object.values(Hn).includes(r.value))throw new Error("Can't parse /RT property value");this.RT=r.value,o=r.end+1;break;case"/ExData":break;default:o=e.skipToNextName(o,s-1)}if(!this.Subtype||!this.Rect)throw new Error("Not all required properties parsed")}getColorRect(){let t=0,e=0,n=0,r=1;if(this.C)if(1===this.C.length){t=e=n=this.C[0]}else if(3===this.C.length)[t,e,n]=this.C;else if(4===this.C.length){const[r,s,i,a]=this.C;t=(1-r)*(1-a),e=(1-s)*(1-a),n=(1-i)*(1-a)}isNaN(this.CA)||(r=this.CA);return[t,e,n,r]}}class qn{constructor(t,e,n,r){this.writeImageXObject=t=>{const e=t.sMask;if(this.isNew(e)){const n=this.writeIndirectObject(e);t.SMask=an.fromRef(n)}else e.edited&&this.writeUpdatedIndirectObject(e);return this.isNew(t)?this.writeIndirectObject(t):t.edited?this.writeUpdatedIndirectObject(t):{id:t.id,generation:t.generation,byteOffset:this._refData.getOffset(t.id)}},this._lastXref=e,this._refData=n,this._changeData=new rn(n),this._writer=new sn(t),this._stringCryptor=null==r?void 0:r.stringCryptor,this._streamCryptor=null==r?void 0:r.streamCryptor}getDataWithUpdatedAnnotations(t){for(const{page:e,supportedAnnotations:n,allAnnotationIds:r}of t)if(null==n?void 0:n.length){for(const t of n)if(t.deleted){if(!t.ref)continue;const e=r.findIndex((e=>e.id===t.id));r.splice(e,1),this._changeData.setRefFree(t.id),t instanceof Gn&&t.Popup&&this._changeData.setRefFree(t.Popup.id)}else if(!t.ref||t.edited){const e=t.apStream;if(e&&this.writeFormXObject(e),this.isNew(t)){const e=this.writeIndirectObject(t);r.push(an.fromRef(e))}else this.writeUpdatedIndirectObject(t)}if(e.Annots instanceof an&&this._changeData.isUsedInSource(e.Annots.id)){const t={id:e.Annots.id,generation:e.Annots.generation,byteOffset:this._writer.offset},n={ref:t,streamCryptor:this._streamCryptor,stringCryptor:this._stringCryptor};this._changeData.updateUsedRef(t),this._writer.writeIndirectArray(n,r)}else{const t=this._changeData.takeFreeRef(this._writer.offset,!0),n={ref:t,streamCryptor:this._streamCryptor,stringCryptor:this._stringCryptor};this._writer.writeIndirectArray(n,r),e.Annots=an.fromRef(t)}this.writeUpdatedIndirectObject(e)}this.writeXref();return this._writer.getCurrentData()}isNew(t){return!t.ref||!this._changeData.isUsedInSource(t.id)}writeIndirectObject(t){const e=this._changeData.takeFreeRef(this._writer.offset,!0),n={ref:e,streamCryptor:this._streamCryptor,stringCryptor:this._stringCryptor};return this._writer.writeIndirectObject(n,t),t.ref=e,e}writeUpdatedIndirectObject(t){const e={id:t.id,generation:t.generation,byteOffset:this._writer.offset},n={ref:e,streamCryptor:this._streamCryptor,stringCryptor:this._stringCryptor};return this._changeData.updateUsedRef(e),this._writer.writeIndirectObject(n,t),e}writeFormXObject(t){const e=t.Resources;return e&&e.edited&&[...e.getXObjects()].forEach((([t,e])=>{e instanceof vn?this.writeImageXObject(e):this.writeFormXObject(e)})),this.isNew(t)?this.writeIndirectObject(t):t.edited?this.writeUpdatedIndirectObject(t):{id:t.id,generation:t.generation,byteOffset:this._refData.getOffset(t.id)}}writeXref(){const t=this._writer.offset,e=this._changeData.takeFreeRef(t,!0),n=this._changeData.exportEntries(),r=this._lastXref.createUpdate(n,t);return this._writer.writeIndirectObject({ref:e},r),this._writer.writeEof(t),t}}class Wn extends gn{constructor(){super(Kt)}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Wn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Size&&r.push(...n.encode("/Size "),...n.encode(" "+this.Size)),this.Prev&&r.push(...n.encode("/Prev "),...n.encode(" "+this.Prev)),this.Root&&r.push(...n.encode("/Root "),P,...this.Root.toArray(t)),this.Encrypt&&r.push(...n.encode("/Encrypt "),P,...this.Encrypt.toArray(t)),this.Info&&r.push(...n.encode("/Info "),P,...this.Info.toArray(t)),this.ID&&r.push(...n.encode("/ID "),$,...this.ID[0].toArray(t),...this.ID[1].toArray(t),et),this.Index&&(r.push(...n.encode("/Index "),$),this.Index.forEach((t=>r.push(...n.encode(" "+t)))),r.push(et)),this.W&&r.push(...n.encode("/W "),$,...n.encode(this.W[0]+""),P,...n.encode(this.W[1]+""),P,...n.encode(this.W[2]+""),et);const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){var e;super.parseProps(t);const{parser:n,bounds:r}=t,s=r.contentStart||r.start,i=n.getDictBoundsAt(s);let a,o,h=n.skipToNextName(i.contentStart,i.contentEnd);for(;o=n.parseNameAt(h),o;)switch(h=o.end+1,a=o.value,a){case"/Size":case"/Prev":h=this.parseNumberProp(a,n,h,!1);break;case"/Root":case"/Info":h=this.parseRefProp(a,n,h);break;case"/Encrypt":const t=n.getValueTypeAt(h);if(t===xe){const t=an.parseRef(n,h);if(t){this.Encrypt=t.value,h=t.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${t}`);case"/ID":const e=mn.parseArray(n,h);if(!e)throw new Error("Can't parse /ID property value");this.ID=[e.value[0],e.value[1]],h=e.end+1;break;case"/Index":case"/W":h=this.parseNumberArrayProp(a,n,h,!1);break;default:h=n.skipToNextName(h,i.contentEnd)}if(!this.W||!this.Size||!this.Root||this.Encrypt&&!this.ID)throw new Error("Not all required properties parsed");(null===(e=this.Index)||void 0===e?void 0:e.length)||(this.Index=[0,this.Size])}}class Qn{constructor(t){this._type=t}get type(){return this._type}get offset(){return this._offset}}class Jn extends Qn{constructor(t,e){super(Bt),this._trailerStream=t,this._offset=e}get prev(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Prev}get size(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Size}get root(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Root}get info(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Root}get encrypt(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.Encrypt}get id(){var t;return null===(t=this._trailerStream)||void 0===t?void 0:t.ID}static createFrom(t,e,n){if(!(null==e?void 0:e.length)||!t)return null;const r=Math.max(...e.map((t=>t.id)))+1,s=Math.max(r,t.size);return Jn.create(e,s,n,t.root,t.offset,t.info,t.encrypt,t.id)}static create(t,e,n,r,s,i,a,o){if(!((null==t?void 0:t.length)&&e&&n&&r))return null;const h=new Wn;h.Size=e,h.Root=r,h.Prev=s,h.Info=i,h.Encrypt=a,h.ID=o;const c=[1,4,2],d=c[0]+c[1]+c[2],l=new ln;l.setIntProp("/Predictor",Ht),l.setIntProp("/Columns",d),l.setIntProp("/Colors",1),l.setIntProp("/BitsPerComponent",8);const p=en.toStreamBytes(t,c),u=new Jn(h,n);return u._trailerStream.Filter=Tt,u._trailerStream.DecodeParms=l,u._trailerStream.W=c,u._trailerStream.Index=p.index,u._trailerStream.streamData=p.bytes,u}static parse(t,e){if(!t)return null;const n=Wn.parse(t);if(!n)return null;return{value:new Jn(n.value,e),start:null,end:null}}createUpdate(t,e){return Jn.createFrom(this,t,e)}getEntries(){if(!this._trailerStream)return[];return en.fromStreamBytes(this._trailerStream.decodedStreamData,this._trailerStream.W,this._trailerStream.Index)}toArray(t){return this._trailerStream.toArray(t)}}class Xn extends dn{constructor(){super(de)}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Xn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Size&&r.push(...n.encode("/Size "),...n.encode(" "+this.Size)),this.Prev&&r.push(...n.encode("/Prev "),...n.encode(" "+this.Prev)),this.Root&&r.push(...n.encode("/Root "),P,...this.Root.toArray(t)),this.Encrypt&&r.push(...n.encode("/Encrypt "),P,...this.Encrypt.toArray(t)),this.Info&&r.push(...n.encode("/Info "),P,...this.Info.toArray(t)),this.ID&&r.push(...n.encode("/ID "),$,...this.ID[0].toArray(t),...this.ID[1].toArray(t),et);const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Size":case"/Prev":o=this.parseNumberProp(i,e,o,!1);break;case"/Root":case"/Info":o=this.parseRefProp(i,e,o);break;case"/Encrypt":const t=e.getValueTypeAt(o);if(t===xe){const t=an.parseRef(e,o);if(t){this.Encrypt=t.value,o=t.end+1;break}throw new Error("Can't parse /Encrypt property value")}throw new Error(`Unsupported /Encrypt property value type: ${t}`);case"/ID":const n=mn.parseArray(e,o);if(!n)throw new Error("Can't parse /ID property value");this.ID=[n.value[0],n.value[1]],o=n.end+1;break;default:o=e.skipToNextName(o,s-1)}if(!this.Size||!this.Root||this.Encrypt&&!this.ID)throw new Error("Not all required properties parsed")}}class jn extends Qn{constructor(t,e,n){super(It),this._table=t,this._trailerDict=e,this._offset=n}get prev(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Prev}get size(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Size}get root(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Root}get info(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Root}get encrypt(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.Encrypt}get id(){var t;return null===(t=this._trailerDict)||void 0===t?void 0:t.ID}static createFrom(t,e,n){if(!(null==e?void 0:e.length)||!t)return null;const r=Math.max(...e.map((t=>t.id)))+1,s=Math.max(r,t.size);return jn.create(e,s,n,t.root,t.offset,t.info,t.encrypt,t.id)}static create(t,e,n,r,s,i,a,o){if(!((null==t?void 0:t.length)&&e&&n&&r))return null;const h=new Xn;h.Size=e,h.Prev=s,h.Root=r,h.Info=i,h.Encrypt=a,h.ID=o;const c=en.toTableBytes(t);return new jn(c,h,n)}static parse(t,e,n){if(!t||isNaN(e))return null;const r=t.getXrefTableBoundsAt(e);if(!r)return null;const s=t.getDictBoundsAt(r.end+1);if(!s)return null;const i=t.sliceCharCodes(r.contentStart,r.contentEnd),a=Xn.parse({parser:t,bounds:s});if(!a)return null;return{value:new jn(i,a.value,n),start:null,end:null}}createUpdate(t,e){return jn.createFrom(this,t,e)}getEntries(){if(!this._table.length)return[];return en.fromTableBytes(this._table)}toArray(t){const e=this._trailerDict.toArray(t),n=[...yt.XREF_TABLE,...yt.END_OF_LINE,...this._table,...yt.TRAILER,...yt.END_OF_LINE,...e,...yt.END_OF_LINE];return new Uint8Array(n)}}class Kn extends dn{constructor(){super($t)}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Kn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Version&&r.push(...n.encode("/Version "),...n.encode(this.Version)),this.Pages&&r.push(...n.encode("/Pages "),P,...this.Pages.toArray(t)),this.Lang&&r.push(...n.encode("/Lang "),...this.Lang.toArray(t));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Version":o=this.parseNameProp(i,e,o);break;case"/Pages":o=this.parseRefProp(i,e,o);break;case"/Lang":o=this.parseLiteralProp(i,e,o,t.cryptInfo);break;default:o=e.skipToNextName(o,s-1)}if(!this.Pages)throw new Error("Not all required properties parsed")}}class Yn extends dn{constructor(){super(ee),this.Rotate=0}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Yn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Parent&&r.push(...n.encode("/Parent "),P,...this.Parent.toArray(t)),this.LastModified&&r.push(...n.encode("/LastModified "),...this.LastModified.toArray(t)),this.Resources&&r.push(...n.encode("/Resources "),...this.Resources.toArray(t)),this.MediaBox&&r.push(...n.encode("/MediaBox "),$,...n.encode(this.MediaBox[0]+""),P,...n.encode(this.MediaBox[1]+""),P,...n.encode(this.MediaBox[2]+""),P,...n.encode(this.MediaBox[3]+""),et),this.CropBox&&r.push(...n.encode("/CropBox "),$,...n.encode(this.CropBox[0]+""),P,...n.encode(this.CropBox[1]+""),P,...n.encode(this.CropBox[2]+""),P,...n.encode(this.CropBox[3]+""),et),this.BleedBox&&r.push(...n.encode("/BleedBox "),$,...n.encode(this.BleedBox[0]+""),P,...n.encode(this.BleedBox[1]+""),P,...n.encode(this.BleedBox[2]+""),P,...n.encode(this.BleedBox[3]+""),et),this.TrimBox&&r.push(...n.encode("/TrimBox "),$,...n.encode(this.TrimBox[0]+""),P,...n.encode(this.TrimBox[1]+""),P,...n.encode(this.TrimBox[2]+""),P,...n.encode(this.TrimBox[3]+""),et),this.ArtBox&&r.push(...n.encode("/ArtBox "),$,...n.encode(this.ArtBox[0]+""),P,...n.encode(this.ArtBox[1]+""),P,...n.encode(this.ArtBox[2]+""),P,...n.encode(this.ArtBox[3]+""),et),this.Contents&&(this.Contents instanceof an?r.push(...n.encode("/Contents "),P,...this.Contents.toArray(t)):(r.push(...n.encode("/Contents "),$),this.Contents.forEach((e=>r.push(P,...e.toArray(t)))),r.push(et))),this.Rotate&&r.push(...n.encode("/Rotate "),...n.encode(" "+this.Rotate)),this.Thumb&&r.push(...n.encode("/Thumb "),P,...this.Thumb.toArray(t)),this.B&&(this.B instanceof an?r.push(...n.encode("/B "),P,...this.B.toArray(t)):(r.push(...n.encode("/B "),$),this.B.forEach((e=>r.push(P,...e.toArray(t)))),r.push(et))),this.Dur&&r.push(...n.encode("/Dur "),...n.encode(" "+this.Dur)),this.Annots&&(this.Annots instanceof an?r.push(...n.encode("/Annots "),P,...this.Annots.toArray(t)):(r.push(...n.encode("/Annots "),$),this.Annots.forEach((e=>r.push(P,...e.toArray(t)))),r.push(et))),this.Metadata&&r.push(...n.encode("/Metadata "),P,...this.Metadata.toArray(t)),this.StructParent&&r.push(...n.encode("/StructParent "),...n.encode(" "+this.StructParent)),this.ID&&r.push(...n.encode("/ID "),P,...this.ID.toArray(t)),this.PZ&&r.push(...n.encode("/PZ "),...n.encode(" "+this.PZ)),this.Tabs&&r.push(...n.encode("/Tabs "),...n.encode(this.Tabs)),this.TemplateInstantiated&&r.push(...n.encode("/TemplateInstantiated "),...n.encode(this.TemplateInstantiated)),this.UserUnit&&r.push(...n.encode("/UserUnit "),...n.encode(" "+this.UserUnit));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Parent":case"/Thumb":case"/Metadata":o=this.parseRefProp(i,e,o);break;case"/LastModified":o=this.parseDateProp(i,e,o,t.cryptInfo);break;case"/Resources":const n=e.getValueTypeAt(o);if(n===xe){const n=an.parseRef(e,o);if(n&&t.parseInfoGetter){const e=t.parseInfoGetter(n.value.id);if(e){const t=Pn.parse(e);if(t){this.Resources=t.value,o=t.end+1;break}}}throw new Error("Can't parse /Resources value reference")}if(n===ye){const n=e.getDictBoundsAt(o);if(n){if(n.contentStart){const r=Pn.parse({parser:e,bounds:n,parseInfoGetter:t.parseInfoGetter});if(!r)throw new Error("Can't parse /Resources value dictionary");this.Resources=r.value}o=n.end+1;break}throw new Error("Can't parse /Resources dictionary bounds")}throw new Error(`Unsupported /Resources property value type: ${n}`);case"/MediaBox":case"/CropBox":case"/BleedBox":case"/TrimBox":case"/ArtBox":o=this.parseNumberArrayProp(i,e,o,!0);break;case"/Contents":case"/B":case"/Annots":const r=e.getValueTypeAt(o);if(r===xe){const t=an.parseRef(e,o);if(t){this[i.slice(1)]=t.value,o=t.end+1;break}}else if(r===we){const t=an.parseRefArray(e,o);if(t){this[i.slice(1)]=t.value,o=t.end+1;break}}throw new Error(`Unsupported ${i} property value type: ${r}`);case"/Rotate":case"/Dur":case"/StructParent":case"/PZ":case"/UserUnit":o=this.parseNumberProp(i,e,o,!1);break;case"/ID":const a=e.getValueTypeAt(o);if(a===xe){const n=an.parseRef(e,o);if(n&&n&&t.parseInfoGetter){const e=t.parseInfoGetter(n.value.id);if(e){const t=mn.parse(e.parser,e.bounds.start,e.cryptInfo);if(t){this.ID=t.value,o=n.end+1;break}}}throw new Error("Can't parse /ID property value")}if(a===Ae){const n=mn.parse(e,o,t.cryptInfo);if(n){this.ID=n.value,o=n.end+1;break}}throw new Error(`Unsupported /ID property value type: ${a}`);case"/Tabs":case"/TemplateInstantiated":o=this.parseNameProp(i,e,o);break;default:o=e.skipToNextName(o,s-1)}if(!this.Parent)throw new Error("Not all required properties parsed")}}class Zn extends dn{constructor(){super(te),this.Rotate=0}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new Zn;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Parent&&r.push(...n.encode("/Parent "),P,...this.Parent.toArray(t)),this.Kids&&(r.push(...n.encode("/Kids "),$),this.Kids.forEach((e=>r.push(P,...e.toArray(t)))),r.push(et)),this.Count&&r.push(...n.encode("/Count "),...n.encode(" "+this.Count)),this.MediaBox&&r.push(...n.encode("/MediaBox "),$,...n.encode(this.MediaBox[0]+""),P,...n.encode(this.MediaBox[1]+""),P,...n.encode(this.MediaBox[2]+""),P,...n.encode(this.MediaBox[3]+""),et),this.Rotate&&r.push(...n.encode("/Rotate "),...n.encode(" "+this.Rotate));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Parent":o=this.parseRefProp(i,e,o);break;case"/Kids":o=this.parseRefArrayProp(i,e,o);break;case"/Count":case"/Rotate":o=this.parseNumberProp(i,e,o,!1);break;case"/MediaBox":o=this.parseNumberArrayProp(i,e,o,!0);break;default:o=e.skipToNextName(o,s-1)}if(!this.Kids||isNaN(this.Count))throw new Error("Not all required properties parsed")}}class $n extends dn{constructor(){super(ae),this.CFM=Xt.NONE,this.AuthEvent=jt.DOC_OPEN,this.Length=40,this.EncryptMetadata=!0}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new $n;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.CFM&&r.push(...n.encode("/CFM "),...n.encode(this.CFM)),this.AuthEvent&&r.push(...n.encode("/AuthEvent "),...n.encode(this.AuthEvent)),this.Length&&r.push(...n.encode("/Length "),...n.encode(" "+this.Length)),this.EncryptMetadata&&r.push(...n.encode("/EncryptMetadata "),...n.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof mn?r.push(...n.encode("/Recipients "),...this.Recipients.toArray(t)):(r.push($),this.Recipients.forEach((e=>r.push(...e.toArray(t)))),r.push(et)));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/CFM":const n=e.parseNameAt(o,!0);if(!n||!Object.values(Xt).includes(n.value))throw new Error("Can't parse /CFM property value");this.CFM=n.value,o=n.end+1;break;case"/AuthEvent":const r=e.parseNameAt(o,!0);if(!r||!Object.values(jt).includes(r.value))throw new Error("Can't parse /AuthEvent property value");this.AuthEvent=r.value,o=r.end+1;break;case"/Length":o=this.parseNumberProp(i,e,o,!1);break;case"/EncryptMetadata":o=this.parseBoolProp(i,e,o);break;case"/Recipients":const a=e.getValueTypeAt(o);if(a===Ae){const n=mn.parse(e,o,t.cryptInfo);if(n){this.Recipients=n.value,o=n.end+1;break}throw new Error("Can't parse /Recipients property value")}if(a===we){const t=mn.parseArray(e,o);if(t){this.Recipients=t.value,o=t.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${a}`);default:o=e.skipToNextName(o,s-1)}}}class tr extends dn{constructor(){super(null),this._filtersMap=new Map}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new tr;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}getProp(t){return this._filtersMap.get(t)}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this._filtersMap.size&&this._filtersMap.forEach(((e,s)=>r.push(...n.encode(s),...e.toArray(t))));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){default:if(e.getValueTypeAt(o)===ye){const t=e.getDictBoundsAt(o);if(t){const n=$n.parse({parser:e,bounds:t});if(n){this._filtersMap.set(i,n.value),o=n.end+1;break}}}o=e.skipToNextName(o,s-1)}}}class er extends dn{constructor(){super(de),this.Filter="/Standard",this.Length=40,this.StmF="/Identity",this.StrF="/Identity",this.EncryptMetadata=!0}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new er;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Filter&&r.push(...n.encode("/Filter "),...n.encode(this.Filter)),this.SubFilter&&r.push(...n.encode("/SubFilter "),...n.encode(this.SubFilter)),this.V&&r.push(...n.encode("/V "),...n.encode(" "+this.V)),this.Length&&r.push(...n.encode("/Length "),...n.encode(" "+this.Length)),this.CF&&r.push(...n.encode("/CF "),...this.CF.toArray(t)),this.StmF&&r.push(...n.encode("/StmF "),...n.encode(this.StmF)),this.StrF&&r.push(...n.encode("/StrF "),...n.encode(this.StrF)),this.EFF&&r.push(...n.encode("/EFF "),...n.encode(this.EFF)),this.R&&r.push(...n.encode("/R "),...n.encode(" "+this.R)),this.O&&r.push(...n.encode("/O "),...this.O.toArray(t)),this.U&&r.push(...n.encode("/U "),...this.U.toArray(t)),this.OE&&r.push(...n.encode("/OE "),...this.OE.toArray(t)),this.UE&&r.push(...n.encode("/UE "),...this.UE.toArray(t)),this.P&&r.push(...n.encode("/P "),...n.encode(" "+this.P)),this.Perms&&r.push(...n.encode("/Perms "),...this.Perms.toArray(t)),this.U&&r.push(...n.encode("/U "),...this.U.toArray(t)),this.EncryptMetadata&&r.push(...n.encode("/EncryptMetadata "),...n.encode(" "+this.EncryptMetadata)),this.Recipients&&(this.Recipients instanceof mn?r.push(...n.encode("/Recipients "),...this.Recipients.toArray(t)):(r.push($),this.Recipients.forEach((e=>r.push(...e.toArray(t)))),r.push(et)));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}toCryptOptions(){var t,e,n,r,s,i,a,o,h;return this.V?{filter:this.Filter,version:this.V,revision:this.R,permissions:this.P,keyLength:this.Length,encryptMetadata:this.EncryptMetadata,stringKeyLength:null===(t=this.stringFilter)||void 0===t?void 0:t.Length,streamKeyLength:null===(e=this.streamFilter)||void 0===e?void 0:e.Length,stringMethod:null===(n=this.stringFilter)||void 0===n?void 0:n.CFM,streamMethod:null===(r=this.streamFilter)||void 0===r?void 0:r.CFM,oPasswordHash:null===(s=this.O)||void 0===s?void 0:s.bytes,uPasswordHash:null===(i=this.U)||void 0===i?void 0:i.bytes,oEncPasswordHash:null===(a=this.OE)||void 0===a?void 0:a.bytes,uEncPasswordHash:null===(o=this.UE)||void 0===o?void 0:o.bytes,perms:null===(h=this.Perms)||void 0===h?void 0:h.bytes}:null}parseProps(t){var e,n;super.parseProps(t);const{parser:r,bounds:s}=t,i=s.contentStart||s.start,a=s.contentEnd||s.end;let o,h,c=r.skipToNextName(i,a-1);for(;h=r.parseNameAt(c),h;)switch(c=h.end+1,o=h.value,o){case"/Filter":case"/SubFilter":case"/StmF":case"/StrF":case"/EFF":c=this.parseNameProp(o,r,c);break;case"/V":const e=r.parseNumberAt(c,!1);if(!e||!Object.values(Qt).includes(e.value))throw new Error("Can't parse /V property value");this.V=e.value,c=e.end+1;break;case"/R":const n=r.parseNumberAt(c,!1);if(!n||!Object.values(Jt).includes(n.value))throw new Error("Can't parse /R property value");this.R=n.value,c=n.end+1;break;case"/Length":case"/P":c=this.parseNumberProp(o,r,c,!1);break;case"/O":case"/U":case"/OE":case"/UE":case"/Perms":c=this.parseLiteralProp(o,r,c,t.cryptInfo);break;case"/EncryptMetadata":c=this.parseBoolProp(o,r,c);break;case"/CF":const i=r.getDictBoundsAt(c);if(!s)throw new Error("Can't parse /CF property value");{const t=tr.parse({parser:r,bounds:i});t&&(this.CF=t.value,c=t.end+1)}break;case"/Recipients":const h=r.getValueTypeAt(c);if(h===Ae){const e=mn.parse(r,c,t.cryptInfo);if(e){this.Recipients=e.value,c=e.end+1;break}throw new Error("Can't parse /Recipients property value")}if(h===we){const t=mn.parseArray(r,c);if(t){this.Recipients=t.value,c=t.end+1;break}throw new Error("Can't parse /Recipients property value")}throw new Error(`Unsupported /Filter property value type: ${h}`);default:c=r.skipToNextName(c,a-1)}if(!this.Filter)throw new Error("Not all required properties parsed");if("/Standard"===this.Filter&&(!this.R||!this.O||!this.U||isNaN(this.P)||5===this.V&&(this.R<5||!this.OE||!this.UE||!this.Perms)))throw new Error("Not all required properties parsed");if(("adbe.pkcs7.s3"===this.SubFilter||"adbe.pkcs7.s4"===this.SubFilter)&&!this.Recipients)throw new Error("Not all required properties parsed");"/Identity"!==this.StrF&&(this.stringFilter=null===(e=this.CF)||void 0===e?void 0:e.getProp(this.StrF)),"/Identity"!==this.StmF&&(this.streamFilter=null===(n=this.CF)||void 0===n?void 0:n.getProp(this.StmF))}}class nr extends gn{constructor(){super(Yt)}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new nr;return e.parseProps(t),{value:e,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}getObjectData(t){if(!this._streamData||!this.N||!this.First)return null;const e=new tn(this.decodedStreamData),n=new Map;let r,s,i,a=0;for(let t=0;t<this.N;t++)r=e.parseNumberAt(a,!1,!1),s=r.value,a=r.end+2,r=e.parseNumberAt(a,!1,!1),i=r.value,a=r.end+2,n.set(s,i);if(!n.has(t))return null;const o=this.First+n.get(t),h=e.getValueTypeAt(o);if(null===h)return;let c,d;switch(h){case kt:c=e.getDictBoundsAt(o,!1);break;case Pt:c=e.getArrayBoundsAt(o,!1);break;case Ct:const t=hn.parse(e,o);t&&(c={start:t.start,end:t.end},d=t);break;case St:const n=mn.parse(e,o);n&&(c={start:n.start,end:n.end},d=n);break;case Et:const r=e.parseNumberAt(o);r&&(c={start:r.start,end:r.end},d=r)}if(!c)return null;const l=e.sliceCharCodes(c.start,c.end);if(!l.length)throw new Error("Object byte array is empty");return{parser:new tn(l),bounds:{start:0,end:l.length-1,contentStart:c.contentStart?c.contentStart-c.start:void 0,contentEnd:c.contentEnd?l.length-1-(c.end-c.contentEnd):void 0},type:h,value:d,cryptInfo:{ref:{id:t,generation:0}},streamId:this.id}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.N&&r.push(...n.encode("/N "),...n.encode(" "+this.N)),this.First&&r.push(...n.encode("/First "),...n.encode(" "+this.First)),this.Extends&&r.push(...n.encode("/Extends "),P,...this.Extends.toArray(t));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=e.getDictBoundsAt(r);let i,a,o=e.skipToNextName(s.contentStart,s.contentEnd);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/N":case"/First":o=this.parseNumberProp(i,e,o,!1);break;case"/Extends":o=this.parseRefProp(i,e,o);break;default:o=e.skipToNextName(o,s.contentEnd)}}}const rr={DRAFT:"/Draft",NOT_APPROVED:"/NotApproved",APPROVED:"/Approved",AS_IS:"/AsIs",FOR_COMMENT:"/ForComment",EXPERIMENTAL:"/Experimental",FINAL:"/Final",SOLD:"/Sold",EXPIRED:"/Expired",PUBLIC:"/ForPublicRelease",NOT_PUBLIC:"/NotForPublicRelease",DEPARTMENTAL:"/Departmental",CONFIDENTIAL:"/Confidential",SECRET:"/TopSecret"},sr=[0,0,440,120],ir=[0,0,220,60],ar=[.804,0,0],or=[0,.804,0],hr=[0,0,.804];class cr extends Gn{constructor(){super(_e),this.Name=rr.DRAFT,this.IT="/Stamp"}static createStandard(t,e){const n=(new Date).toISOString(),r={uuid:l(),annotationType:"/Stamp",pageId:null,dateCreated:n,dateModified:n,author:e||"unknown",rect:ir,matrix:[1,0,0,1,0,0],stampType:t,stampImageData:null};return this.createFromDto(r)}static createFromDto(t){if("/Stamp"!==t.annotationType)throw new Error("Invalid annotation type");const e=on.fromDate(new Date(t.dateCreated)),n=on.fromDate(new Date(t.dateModified)),r=new Dn;let s,i;switch(r.LastModified=n,r.BBox=sr,r.Filter="/FlateDecode",t.stampType){case"/Draft":r.setTextStreamData("33.5 13.4 m\n404.5 6.92 l\n419.6 6.657 431.9 18.52 432.1 33.62 c\n432.89 78.92 l\n433.153 94.02 421.29 106.32 406.19 106.52 c\n35.19 113 l\n20.09 113.263 7.79 101.4 7.59 86.3 c\n6.8 41 l\n6.537 25.9 18.4 13.6 33.5 13.4 c\ns\n150 61 m\n150.047 65.947 149.114 70.413 147.2 74.4 c\n145.287 78.333 142.853 81.373 139.9 83.52 c\n137.68 85.127 135.24 86.263 132.58 86.93 c\n129.92 87.593 126.763 87.957 123.11 88.02 c\n106.91 88.29 l\n106.401 35.19 l\n123.001 34.912 l\n126.734 34.85 129.961 35.165 132.681 35.857 c\n135.394 36.524 137.681 37.507 139.541 38.807 c\n142.721 40.994 145.234 43.974 147.081 47.747 c\n148.941 51.5 149.898 55.934 149.951 61.047 c\nh\n137.8 61.097 m\n137.767 57.597 137.183 54.621 136.05 52.167 c\n134.937 49.687 133.183 47.764 130.79 46.397 c\n129.57 45.731 128.323 45.287 127.05 45.067 c\n125.797 44.827 123.897 44.728 121.35 44.77 c\n118.36 44.82 l\n118.678 78.12 l\n121.668 78.07 l\n124.481 78.023 126.541 77.846 127.848 77.538 c\n129.161 77.207 130.438 76.637 131.678 75.828 c\n133.818 74.362 135.381 72.432 136.368 70.038 c\n137.348 67.618 137.821 64.648 137.788 61.128 c\nf\n185 50 m\n184.987 48.667 184.74 47.53 184.259 46.59 c\n183.778 45.643 182.961 44.907 181.809 44.38 c\n181.002 44.013 180.066 43.802 178.999 43.749 c\n177.932 43.672 176.689 43.645 175.269 43.669 c\n170.989 43.74 l\n171.126 58.04 l\n174.756 57.979 l\n176.643 57.948 178.223 57.814 179.496 57.579 c\n180.769 57.344 181.833 56.837 182.686 56.059 c\n183.499 55.306 184.086 54.486 184.446 53.599 c\n184.827 52.686 185.011 51.483 184.996 49.989 c\nh\n203.8 86.6 m\n189.4 86.841 l\n176.7 67.541 l\n171.25 67.632 l\n171.437 87.132 l\n159.637 87.329 l\n159.128 34.229 l\n178.928 33.897 l\n181.635 33.852 183.965 33.991 185.918 34.315 c\n187.871 34.639 189.705 35.382 191.418 36.545 c\n193.151 37.705 194.531 39.228 195.558 41.115 c\n196.605 42.975 197.141 45.335 197.168 48.195 c\n197.206 52.122 196.446 55.335 194.888 57.835 c\n193.355 60.335 191.138 62.432 188.238 64.125 c\nf\n251 85.8 m\n238.8 86.004 l\n235.53 75.304 l\n218.53 75.588 l\n215.46 86.388 l\n203.56 86.587 l\n219.96 33.187 l\n233.56 32.959 l\nh\n232.6 65.6 m\n226.78 46.6 l\n221.33 65.8 l\nf\n290 42.3 m\n268.9 42.653 l\n268.995 52.543 l\n288.495 52.216 l\n288.593 62.516 l\n269.093 62.843 l\n269.31 85.543 l\n257.51 85.74 l\n257.001 32.64 l\n289.801 32.091 l\nf\n334 41.5 m\n319.7 41.739 l\n320.11 84.639 l\n308.31 84.837 l\n307.9 41.937 l\n293.6 42.176 l\n293.502 31.876 l\n333.902 31.199 l\nf\n"),s=ar,i="Draft";break;case"/Approved":r.setTextStreamData("33.5 13.4 m\n404.5 6.92 l\n419.6 6.657 431.9 18.52 432.1 33.62 c\n432.89 78.92 l\n433.153 94.02 421.29 106.32 406.19 106.52 c\n35.19 113 l\n20.09 113.263 7.79 101.4 7.59 86.3 c\n6.8 41 l\n6.537 25.9 18.4 13.6 33.5 13.4 c\ns\n88.9 86.4 m\n78 86.585 l\n75.08 76.895 l\n59.88 77.153 l\n57.14 86.933 l\n46.54 87.114 l\n61.24 38.714 l\n73.34 38.508 l\nh\n72.4 68.1 m\n67.21 50.9 l\n62.35 68.3 l\nf\n128 52.8 m\n128.02 54.953 127.72 57.073 127.098 59.16 c\n126.477 61.22 125.577 62.96 124.398 64.38 c\n122.785 66.307 120.975 67.77 118.968 68.77 c\n116.981 69.777 114.495 70.303 111.508 70.35 c\n104.938 70.462 l\n105.086 86.162 l\n94.586 86.341 l\n94.132 38.141 l\n111.532 37.846 l\n114.132 37.802 116.322 38.034 118.102 38.543 c\n119.902 39.03 121.492 39.79 122.872 40.823 c\n124.532 42.07 125.802 43.676 126.682 45.643 c\n127.582 47.61 128.045 49.986 128.072 52.773 c\nh\n117.1 53.276 m\n117.087 51.916 116.765 50.756 116.133 49.796 c\n115.501 48.816 114.771 48.139 113.943 47.766 c\n112.836 47.267 111.763 47.005 110.723 46.98 c\n109.676 46.933 108.283 46.924 106.543 46.954 c\n104.733 46.985 l\n104.869 61.385 l\n107.889 61.333 l\n109.682 61.303 111.156 61.149 112.309 60.87 c\n113.476 60.592 114.449 60.058 115.229 59.27 c\n115.902 58.57 116.379 57.744 116.659 56.79 c\n116.961 55.817 117.106 54.64 117.093 53.26 c\nf\n170 52.1 m\n170.02 54.253 169.72 56.373 169.098 58.46 c\n168.477 60.52 167.577 62.26 166.398 63.68 c\n164.785 65.607 162.975 67.07 160.968 68.07 c\n158.981 69.077 156.495 69.603 153.508 69.65 c\n146.938 69.762 l\n147.086 85.462 l\n136.586 85.641 l\n136.132 37.441 l\n153.532 37.146 l\n156.132 37.102 158.322 37.334 160.102 37.843 c\n161.902 38.33 163.492 39.09 164.872 40.123 c\n166.532 41.37 167.802 42.976 168.682 44.943 c\n169.582 46.91 170.045 49.286 170.072 52.073 c\nh\n159.1 52.576 m\n159.087 51.216 158.765 50.056 158.133 49.096 c\n157.501 48.116 156.771 47.439 155.943 47.066 c\n154.836 46.567 153.763 46.305 152.723 46.28 c\n151.676 46.233 150.283 46.224 148.543 46.254 c\n146.733 46.285 l\n146.869 60.685 l\n149.889 60.633 l\n151.682 60.603 153.156 60.449 154.309 60.17 c\n155.476 59.892 156.449 59.358 157.229 58.57 c\n157.902 57.87 158.379 57.044 158.659 56.09 c\n158.961 55.117 159.106 53.94 159.093 52.56 c\nf\n200 51.1 m\n199.989 49.893 199.768 48.863 199.339 48.01 c\n198.91 47.157 198.18 46.49 197.149 46.01 c\n196.429 45.677 195.592 45.487 194.639 45.438 c\n193.686 45.368 192.576 45.344 191.309 45.365 c\n187.489 45.43 l\n187.611 58.43 l\n190.851 58.375 l\n192.538 58.346 193.948 58.225 195.081 58.012 c\n196.214 57.799 197.161 57.342 197.921 56.642 c\n198.648 55.962 199.171 55.219 199.491 54.412 c\n199.831 53.585 199.995 52.492 199.982 51.132 c\nh\n216.8 84.2 m\n203.9 84.419 l\n192.6 66.919 l\n187.74 67.002 l\n187.906 84.702 l\n177.406 84.88 l\n176.952 36.68 l\n194.652 36.379 l\n197.072 36.338 199.152 36.464 200.892 36.758 c\n202.632 37.052 204.269 37.725 205.802 38.778 c\n207.349 39.831 208.579 41.211 209.492 42.918 c\n210.425 44.604 210.902 46.741 210.922 49.328 c\n210.956 52.888 210.279 55.801 208.892 58.068 c\n207.519 60.334 205.539 62.234 202.952 63.768 c\nf\n261 59.4 m\n261.073 67.067 259.263 73.2 255.57 77.8 c\n251.877 82.373 246.743 84.713 240.17 84.82 c\n233.597 84.932 228.43 82.765 224.67 78.32 c\n220.89 73.853 218.963 67.787 218.89 60.12 c\n218.817 52.387 220.627 46.253 224.32 41.72 c\n228.013 37.147 233.147 34.807 239.72 34.7 c\n246.273 34.589 251.44 36.755 255.22 41.2 c\n259.013 45.62 260.947 51.687 261.02 59.4 c\nh\n247.1 71.8 m\n248.113 70.313 248.857 68.577 249.33 66.59 c\n249.805 64.577 250.03 62.223 250.005 59.53 c\n249.978 56.643 249.671 54.19 249.084 52.17 c\n248.497 50.15 247.741 48.523 246.814 47.29 c\n245.867 46.01 244.777 45.09 243.544 44.53 c\n242.331 43.968 241.064 43.698 239.744 43.721 c\n238.404 43.744 237.144 44.045 235.964 44.626 c\n234.797 45.207 233.724 46.153 232.744 47.466 c\n231.837 48.686 231.101 50.369 230.534 52.516 c\n229.986 54.636 229.725 57.099 229.752 59.906 c\n229.779 62.773 230.077 65.216 230.645 67.236 c\n231.232 69.229 231.988 70.856 232.915 72.116 c\n233.842 73.376 234.922 74.296 236.155 74.876 c\n237.388 75.459 238.682 75.739 240.035 75.716 c\n241.388 75.693 242.675 75.369 243.895 74.745 c\n245.115 74.099 246.178 73.122 247.085 71.815 c\nf\n306 34.6 m\n291.5 83 l\n279.7 83.201 l\n264.3 35.301 l\n275.4 35.113 l\n285.6 68.813 l\n295.17 34.813 l\nf\n342 82.1 m\n312.4 82.603 l\n311.946 34.403 l\n341.546 33.9 l\n341.634 43.22 l\n322.534 43.544 l\n322.612 51.854 l\n340.312 51.553 l\n340.4 60.873 l\n322.7 61.174 l\n322.812 73.074 l\n341.912 72.75 l\nf\n389 57.3 m\n389.042 61.787 388.209 65.82 386.5 69.4 c\n384.793 72.967 382.62 75.72 379.98 77.66 c\n378 79.12 375.82 80.15 373.44 80.75 c\n371.067 81.351 368.25 81.68 364.99 81.735 c\n350.59 81.98 l\n350.136 33.78 l\n364.936 33.528 l\n368.269 33.471 371.146 33.757 373.566 34.384 c\n375.993 34.99 378.033 35.883 379.686 37.064 c\n382.526 39.044 384.769 41.744 386.416 45.164 c\n388.076 48.564 388.929 52.597 388.976 57.264 c\nh\n378.1 57.388 m\n378.07 54.222 377.55 51.525 376.54 49.298 c\n375.547 47.052 373.983 45.308 371.85 44.068 c\n370.763 43.461 369.65 43.058 368.51 42.858 c\n367.39 42.64 365.693 42.551 363.42 42.589 c\n360.76 42.634 l\n361.044 72.734 l\n363.704 72.689 l\n366.211 72.647 368.051 72.486 369.224 72.207 c\n370.391 71.907 371.531 71.391 372.644 70.657 c\n374.557 69.331 375.951 67.581 376.824 65.407 c\n377.704 63.214 378.127 60.521 378.094 57.327 c\nf\n"),s=or,i="Approved";break;case"/NotApproved":r.setTextStreamData("33.5 13.4 m\n404.5 6.92 l\n419.6 6.657 431.9 18.52 432.1 33.62 c\n432.89 78.92 l\n433.153 94.02 421.29 106.32 406.19 106.52 c\n35.19 113 l\n20.09 113.263 7.79 101.4 7.59 86.3 c\n6.8 41 l\n6.537 25.9 18.4 13.6 33.5 13.4 c\ns\n57.1 85.5 m\n49.12 85.636 l\n35.32 55.036 l\n35.469 85.936 l\n27.879 86.066 l\n27.662 41.066 l\n37.562 40.897 l\n49.362 66.497 l\n49.238 40.697 l\n56.828 40.567 l\nf\n96.4 62.4 m\n96.435 69.533 94.995 75.267 92.08 79.6 c\n89.167 83.86 85.133 86.033 79.98 86.12 c\n74.82 86.208 70.753 84.175 67.78 80.02 c\n64.827 75.84 63.333 70.173 63.3 63.02 c\n63.265 55.82 64.705 50.087 67.62 45.82 c\n70.533 41.56 74.567 39.387 79.72 39.3 c\n84.867 39.212 88.933 41.245 91.92 45.4 c\n94.887 49.533 96.387 55.2 96.42 62.4 c\nh\n85.5 74 m\n86.3 72.62 86.89 71 87.27 69.14 c\n87.649 67.26 87.833 65.063 87.82 62.55 c\n87.807 59.85 87.573 57.56 87.118 55.68 c\n86.663 53.793 86.073 52.273 85.348 51.12 c\n84.608 49.927 83.755 49.067 82.788 48.54 c\n81.835 48.013 80.841 47.758 79.808 47.776 c\n78.761 47.794 77.771 48.073 76.838 48.612 c\n75.918 49.151 75.075 50.031 74.308 51.252 c\n73.595 52.392 73.011 53.962 72.558 55.962 c\n72.122 57.942 71.91 60.242 71.923 62.862 c\n71.936 65.542 72.163 67.822 72.603 69.702 c\n73.058 71.569 73.648 73.089 74.373 74.262 c\n75.1 75.435 75.946 76.295 76.913 76.842 c\n77.88 77.389 78.893 77.654 79.953 77.635 c\n81.02 77.617 82.033 77.318 82.993 76.738 c\n83.953 76.138 84.79 75.228 85.503 74.008 c\nf\n128 48 m\n118 48.172 l\n118.175 84.472 l\n109.895 84.614 l\n109.72 48.314 l\n99.72 48.486 l\n99.678 39.786 l\n127.978 39.301 l\nf\n178 83.4 m\n169.44 83.546 l\n167.18 74.496 l\n155.28 74.7 l\n153.1 83.83 l\n144.76 83.973 l\n156.36 38.773 l\n165.89 38.61 l\nh\n165.1 66.3 m\n161.08 50.2 l\n157.21 66.4 l\nf\n209 52.1 m\n209.01 54.113 208.768 56.09 208.274 58.03 c\n207.78 59.95 207.07 61.573 206.144 62.9 c\n204.871 64.693 203.447 66.057 201.874 66.99 c\n200.314 67.923 198.361 68.41 196.014 68.45 c\n190.864 68.538 l\n190.935 83.138 l\n182.655 83.28 l\n182.438 38.28 l\n196.038 38.047 l\n198.078 38.012 199.798 38.235 201.198 38.714 c\n202.611 39.173 203.858 39.886 204.938 40.854 c\n206.238 42.021 207.231 43.524 207.918 45.364 c\n208.618 47.204 208.974 49.421 208.988 52.014 c\nh\n200.44 52.518 m\n200.434 51.251 200.184 50.168 199.691 49.268 c\n199.198 48.348 198.628 47.715 197.981 47.368 c\n197.114 46.9 196.271 46.653 195.451 46.626 c\n194.631 46.58 193.538 46.568 192.171 46.592 c\n190.751 46.616 l\n190.816 60.116 l\n193.186 60.075 l\n194.593 60.051 195.749 59.911 196.656 59.653 c\n197.576 59.396 198.343 58.899 198.956 58.163 c\n199.485 57.51 199.861 56.74 200.086 55.853 c\n200.326 54.947 200.443 53.847 200.437 52.553 c\nf\n241 51.6 m\n241.01 53.613 240.768 55.59 240.274 57.53 c\n239.78 59.45 239.07 61.073 238.144 62.4 c\n236.871 64.193 235.447 65.557 233.874 66.49 c\n232.314 67.423 230.361 67.91 228.014 67.95 c\n222.864 68.038 l\n222.935 82.638 l\n214.655 82.78 l\n214.438 37.78 l\n228.038 37.547 l\n230.078 37.512 231.798 37.735 233.198 38.214 c\n234.611 38.673 235.858 39.386 236.938 40.354 c\n238.238 41.521 239.231 43.024 239.918 44.864 c\n240.618 46.704 240.974 48.921 240.988 51.514 c\nh\n232.44 52.018 m\n232.434 50.751 232.184 49.668 231.691 48.768 c\n231.198 47.848 230.628 47.215 229.981 46.868 c\n229.114 46.4 228.271 46.153 227.451 46.126 c\n226.631 46.08 225.538 46.068 224.171 46.092 c\n222.751 46.116 l\n222.816 59.616 l\n225.186 59.575 l\n226.593 59.551 227.749 59.411 228.656 59.153 c\n229.576 58.896 230.343 58.399 230.956 57.663 c\n231.485 57.01 231.861 56.24 232.086 55.353 c\n232.326 54.447 232.443 53.347 232.437 52.053 c\nf\n265 50.7 m\n264.995 49.573 264.825 48.61 264.49 47.81 c\n264.155 47.01 263.585 46.387 262.78 45.94 c\n262.218 45.627 261.565 45.447 260.82 45.4 c\n260.073 45.332 259.203 45.307 258.21 45.324 c\n255.21 45.375 l\n255.269 57.475 l\n257.809 57.432 l\n259.129 57.409 260.235 57.299 261.129 57.103 c\n262.022 56.906 262.769 56.479 263.369 55.823 c\n263.941 55.189 264.354 54.499 264.609 53.753 c\n264.878 52.986 265.01 51.966 265.004 50.693 c\nh\n278.1 81.7 m\n268 81.873 l\n259.17 65.573 l\n255.35 65.638 l\n255.43 82.138 l\n247.19 82.279 l\n246.973 37.279 l\n260.873 37.041 l\n262.773 37.009 264.406 37.132 265.773 37.41 c\n267.139 37.689 268.423 38.322 269.623 39.31 c\n270.836 40.297 271.799 41.59 272.513 43.19 c\n273.239 44.77 273.609 46.767 273.623 49.18 c\n273.639 52.5 273.099 55.217 272.003 57.33 c\n270.923 59.444 269.366 61.21 267.333 62.63 c\nf\n313 58.7 m\n313.035 65.833 311.595 71.567 308.68 75.9 c\n305.767 80.16 301.733 82.333 296.58 82.42 c\n291.42 82.508 287.353 80.475 284.38 76.32 c\n281.427 72.14 279.933 66.473 279.9 59.32 c\n279.865 52.12 281.305 46.387 284.22 42.12 c\n287.133 37.86 291.167 35.687 296.32 35.6 c\n301.467 35.512 305.533 37.545 308.52 41.7 c\n311.487 45.833 312.987 51.5 313.02 58.7 c\nh\n302.1 70.3 m\n302.9 68.92 303.49 67.3 303.87 65.44 c\n304.249 63.56 304.433 61.363 304.42 58.85 c\n304.407 56.15 304.173 53.86 303.718 51.98 c\n303.263 50.093 302.673 48.573 301.948 47.42 c\n301.208 46.227 300.355 45.367 299.388 44.84 c\n298.435 44.313 297.441 44.058 296.408 44.076 c\n295.361 44.094 294.371 44.373 293.438 44.912 c\n292.518 45.451 291.675 46.331 290.908 47.552 c\n290.195 48.692 289.611 50.262 289.158 52.262 c\n288.722 54.242 288.51 56.542 288.523 59.162 c\n288.536 61.842 288.763 64.122 289.203 66.002 c\n289.658 67.869 290.248 69.389 290.973 70.562 c\n291.7 71.735 292.546 72.595 293.513 73.142 c\n297.62 73.917 298.633 73.618 299.593 73.038 c\n300.553 72.438 301.39 71.528 302.103 70.308 c\nf\n348 35.6 m\n336.5 80.8 l\n327.23 80.959 l\n315.33 36.159 l\n324.02 36.01 l\n331.93 67.41 l\n339.54 35.71 l\nf\n376 80 m\n352.8 80.397 l\n352.583 35.397 l\n375.783 35 l\n375.825 43.7 l\n360.825 43.956 l\n360.863 51.716 l\n374.762 51.478 l\n374.804 60.178 l\n360.904 60.416 l\n360.958 71.516 l\n375.958 71.26 l\nf\n413 57 m\n413.02 61.187 412.357 64.953 411.01 68.3 c\n409.663 71.627 407.95 74.193 405.87 76 c\n404.31 77.353 402.597 78.31 400.73 78.87 c\n398.863 79.425 396.65 79.725 394.09 79.769 c\n382.79 79.963 l\n382.573 34.963 l\n394.173 34.764 l\n396.786 34.719 399.043 34.993 400.943 35.584 c\n402.843 36.155 404.443 36.992 405.743 38.094 c\n407.963 39.947 409.713 42.474 410.993 45.674 c\n412.286 48.854 412.943 52.621 412.963 56.974 c\nh\n404.44 57.056 m\n404.426 54.096 404.026 51.576 403.24 49.496 c\n402.467 47.396 401.243 45.766 399.57 44.606 c\n398.717 44.037 397.847 43.66 396.96 43.476 c\n396.08 43.269 394.75 43.181 392.97 43.212 c\n390.88 43.248 l\n391.016 71.348 l\n393.106 71.312 l\n395.073 71.278 396.516 71.133 397.436 70.876 c\n398.356 70.599 399.253 70.122 400.126 69.446 c\n401.626 68.213 402.726 66.583 403.426 64.556 c\n404.119 62.509 404.459 59.996 404.446 57.016 c\nf\n"),s=ar,i="Not Approved";break;case"/Departmental":r.setTextStreamData("33.5 13.4 m\n404.5 6.92 l\n419.6 6.657 431.9 18.52 432.1 33.62 c\n432.89 78.92 l\n433.153 94.02 421.29 106.32 406.19 106.52 c\n35.19 113 l\n20.09 113.263 7.79 101.4 7.59 86.3 c\n6.8 41 l\n6.537 25.9 18.4 13.6 33.5 13.4 c\ns\n56.4 63.1 m\n56.412 67.46 55.746 71.393 54.4 74.9 c\n53.06 78.36 51.36 81.03 49.3 82.91 c\n47.753 84.317 46.053 85.31 44.2 85.89 c\n26.42 86.996 l\n26.286 40.196 l\n37.786 40.009 l\n40.379 39.967 42.616 40.256 44.496 40.875 c\n46.376 41.474 47.959 42.35 49.246 43.505 c\n51.446 45.438 53.176 48.072 54.436 51.405 c\n55.709 54.718 56.353 58.652 56.366 63.205 c\nh\n47.92 63.143 m\n47.911 60.063 47.518 57.437 46.74 55.263 c\n45.98 53.077 44.773 51.377 43.12 50.163 c\n42.28 49.569 41.417 49.175 40.53 48.983 c\n39.663 48.767 38.347 48.673 36.58 48.701 c\n34.51 48.735 l\n34.594 78.035 l\n36.664 78.001 l\n38.617 77.97 40.047 77.821 40.954 77.554 c\n41.867 77.267 42.757 76.77 43.624 76.064 c\n45.117 74.784 46.207 73.088 46.894 70.974 c\n47.587 68.848 47.927 66.231 47.914 63.124 c\nf\n85.8 86 m\n62.8 86.373 l\n62.666 39.573 l\n85.666 39.2 l\n85.692 48.26 l\n70.892 48.501 l\n70.915 56.581 l\n84.715 56.357 l\n84.741 65.417 l\n70.941 65.641 l\n70.974 77.241 l\n85.774 77 l\nf\n119 53.4 m\n119.006 55.493 118.763 57.553 118.27 59.58 c\n117.777 61.58 117.071 63.27 116.15 64.65 c\n114.89 66.517 113.477 67.933 111.91 68.9 c\n110.363 69.867 108.43 70.37 106.11 70.41 c\n101.01 70.493 l\n101.054 85.793 l\n92.854 85.926 l\n92.72 39.126 l\n106.22 38.907 l\n108.24 38.874 109.943 39.108 111.33 39.61 c\n112.723 40.091 113.956 40.837 115.03 41.85 c\n116.316 43.063 117.296 44.63 117.97 46.55 c\n118.656 48.47 119.003 50.78 119.01 53.48 c\nh\n110.52 53.821 m\n110.516 52.501 110.271 51.374 109.784 50.441 c\n109.297 49.488 108.734 48.824 108.094 48.451 c\n107.241 47.962 106.407 47.703 105.594 47.674 c\n104.781 47.624 103.697 47.61 102.344 47.632 c\n100.934 47.655 l\n100.974 61.655 l\n103.324 61.617 l\n104.717 61.595 105.864 61.45 106.764 61.184 c\n107.677 60.918 108.437 60.401 109.044 59.634 c\n109.569 58.954 109.945 58.151 110.174 57.224 c\n110.413 56.278 110.531 55.134 110.527 53.794 c\nf\n154 84.9 m\n145.52 85.038 l\n143.29 75.608 l\n131.49 75.799 l\n129.32 85.299 l\n121.06 85.433 l\n132.66 38.433 l\n142.1 38.28 l\nh\n141.3 67.1 m\n137.34 50.4 l\n133.48 67.3 l\nf\n176 52 m\n175.997 50.827 175.83 49.823 175.5 48.99 c\n175.17 48.157 174.607 47.507 173.81 47.04 c\n173.254 46.713 172.604 46.525 171.86 46.474 c\n171.12 46.402 170.26 46.374 169.28 46.39 c\n166.31 46.438 l\n166.346 59.038 l\n168.866 58.998 l\n170.173 58.976 171.269 58.864 172.156 58.662 c\n173.036 58.458 173.776 58.015 174.376 57.332 c\n174.943 56.672 175.353 55.952 175.606 55.172 c\n175.874 54.372 176.006 53.312 176.003 51.992 c\nh\n188.9 84.3 m\n178.9 84.463 l\n170.18 67.463 l\n166.4 67.524 l\n166.449 84.724 l\n158.289 84.856 l\n158.155 38.056 l\n171.955 37.833 l\n173.835 37.803 175.452 37.934 176.805 38.226 c\n178.158 38.519 179.428 39.179 180.615 40.206 c\n181.815 41.233 182.765 42.58 183.465 44.246 c\n184.178 45.893 184.542 47.973 184.555 50.486 c\n184.565 53.946 184.025 56.776 182.935 58.976 c\n181.862 61.176 180.315 63.016 178.295 64.496 c\nf\n218 46.1 m\n208.07 46.261 l\n208.178 84.061 l\n199.978 84.194 l\n199.87 46.394 l\n189.94 46.555 l\n189.914 37.495 l\n218.014 37.039 l\nf\n256 83.2 m\n247.84 83.332 l\n247.75 51.932 l\n241.91 72.332 l\n236.25 72.424 l\n230.3 52.124 l\n230.39 83.524 l\n222.66 83.65 l\n222.526 36.85 l\n232.046 36.695 l\n239.266 60.095 l\n246.336 36.495 l\n255.856 36.34 l\nf\n287 82.7 m\n264 83.073 l\n263.866 36.273 l\n286.866 35.9 l\n286.892 44.96 l\n272.092 45.201 l\n272.115 53.281 l\n285.915 53.057 l\n285.941 62.117 l\n272.141 62.341 l\n272.174 73.941 l\n286.974 73.7 l\nf\n323 82.2 m\n315.1 82.328 l\n301.5 50.428 l\n301.592 82.528 l\n294.072 82.65 l\n293.938 35.85 l\n303.738 35.691 l\n315.438 62.291 l\n315.361 35.491 l\n322.881 35.369 l\nf\n356 43.9 m\n346.07 44.061 l\n346.178 81.861 l\n337.978 81.994 l\n337.87 44.194 l\n327.94 44.355 l\n327.914 35.295 l\n356.014 34.839 l\nf\n390 81.1 m\n381.52 81.238 l\n379.29 71.808 l\n367.49 71.999 l\n365.32 81.499 l\n357.06 81.633 l\n368.66 34.633 l\n378.1 34.48 l\nh\n377.3 63.3 m\n373.34 46.6 l\n369.48 63.5 l\nf\n418 80.6 m\n395.1 80.972 l\n394.966 34.172 l\n403.166 34.039 l\n403.274 71.839 l\n417.974 71.6 l\nf\n"),s=hr,i="Departmental";break;default:throw new Error(`Stamp type '${t.stampType}' is not supported`)}const a=s[0].toFixed(3),o=s[1].toFixed(3),h=s[2].toFixed(3),c=`${a} ${o} ${h} rg ${a} ${o} ${h} RG`,d=new Dn;d.LastModified=n,d.BBox=sr,d.Resources=new Pn,d.Resources.setXObject("/Fm",r),d.Filter="/FlateDecode",d.setTextStreamData(`q 1 0 0 -1 0 ${sr[3]} cm ${c} 1 j 8.58 w /Fm Do Q`);const l=new cr;l.Contents=hn.fromString(i),l.Subj=hn.fromString(i),l.C=s,l.CA=1,l.apStream=d,l.$name=t.uuid,l.CreationDate=e,l.M=n,l.NM=hn.fromString(t.uuid),l.T=hn.fromString(t.author||"unknown"),l.Name=t.stampType,l.Rect=t.rect,d.Matrix=t.matrix;const p=new Proxy(l,l.onChange);return l._proxy=p,l._added=!0,p}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new cr;e.parseProps(t);const n=new Proxy(e,e.onChange);return e._proxy=n,{value:n,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.Name&&r.push(...n.encode("/Name "),...n.encode(this.Name)),this.IT&&r.push(...n.encode("/IT "),...n.encode(this.IT));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}toDto(){var t,e,n;return{annotationType:"/Stamp",uuid:this.$name,pageId:this.$pageId,dateCreated:(null===(t=this.CreationDate)||void 0===t?void 0:t.date.toISOString())||(new Date).toISOString(),dateModified:this.M?this.M instanceof hn?this.M.literal:this.M.date.toISOString():(new Date).toISOString(),author:null===(e=this.T)||void 0===e?void 0:e.literal,rect:this.Rect,matrix:null===(n=this.apStream)||void 0===n?void 0:n.Matrix,stampType:this.Name,stampImageData:null}}parseProps(t){super.parseProps(t);const{parser:e,bounds:n}=t,r=n.contentStart||n.start,s=n.contentEnd||n.end;let i,a,o=e.skipToNextName(r,s-1);for(;a=e.parseNameAt(o),a;)switch(o=a.end+1,i=a.value,i){case"/Name":o=this.parseNameProp(i,e,o);break;default:o=e.skipToNextName(o,s-1)}if(!this.Name)throw new Error("Not all required properties parsed")}}class dr extends Gn{constructor(){super(Ee)}static createFromPenData(t,e){const n=[],r=[];t.paths.forEach((t=>{const e=[];t.positions.forEach((t=>{n.push(t),e.push(t.x,t.y)})),r.push(e)}));const{min:s,max:i}=v(...n),a=t.strokeWidth,o=[s.x-a/2,s.y-a/2,i.x+a/2,i.y+a/2],h=(new Date).toISOString(),c={uuid:l(),annotationType:"/Ink",pageId:null,dateCreated:h,dateModified:h,author:e||"unknown",rect:o,matrix:[1,0,0,1,0,0],inkList:r,color:t.color,strokeWidth:t.strokeWidth,strokeDashGap:null};return this.createFromDto(c)}static createFromDto(t){if("/Ink"!==t.annotationType)throw new Error("Invalid annotation type");const e=new bn;e.W=t.strokeWidth,t.strokeDashGap&&(e.D=t.strokeDashGap);const n=new dr;n.$name=t.uuid,n.NM=hn.fromString(t.uuid),n.T=hn.fromString(t.author),n.M=on.fromDate(new Date(t.dateModified)),n.CreationDate=on.fromDate(new Date(t.dateCreated)),n.InkList=t.inkList,n.Rect=t.rect,n.C=t.color.slice(0,3),n.CA=t.color[3],n.BS=e,n.createApStream();const r=new Proxy(n,n.onChange);return n._proxy=r,n._added=!0,r}static parse(t){if(!t)throw new Error("Parsing information not passed");try{const e=new dr;e.parseProps(t);const n=new Proxy(e,e.onChange);return e._proxy=n,{value:n,start:t.bounds.start,end:t.bounds.end}}catch(t){return console.log(t.message),null}}toArray(t){const e=super.toArray(t),n=new TextEncoder,r=[];this.InkList&&(r.push(...n.encode("/InkList "),$),this.InkList.forEach((t=>{r.push($),t.forEach((t=>r.push(...n.encode(" "+t)))),r.push(et)})),r.push(et));const s=[...e.subarray(0,2),...r,...e.subarray(2,e.length)];return new Uint8Array(s)}toDto(){var t,e,n,r,s,i,a;const o=this.getColorRect();return{annotationType:"/Ink",uuid:this.$name,pageId:this.$pageId,dateCreated:(null===(t=this.CreationDate)||void 0===t?void 0:t.date.toISOString())||(new Date).toISOString(),dateModified:this.M?this.M instanceof hn?this.M.literal:this.M.date.toISOString():(new Date).toISOString(),author:null===(e=this.T)||void 0===e?void 0:e.literal,rect:this.Rect,matrix:null===(n=this.apStream)||void 0===n?void 0:n.Matrix,inkList:this.InkList,color:o,strokeWidth:null!==(a=null!==(s=null===(r=this.BS)||void 0===r?void 0:r.W)&&void 0!==s?s:null===(i=this.Border)||void 0===i?void 0:i.width)&&void 0!==a?a:1}}applyCommonTransform(t){const e=this._proxy||this;let n,r,s,i,a,o;const h=new A;if(e.InkList.forEach((e=>{for(let c=0;c<e.length;c+=2)n=e[c],r=e[c+1],h.set(n,r).applyMat3(t),e[c]=h.x,e[c+1]=h.y,(!s||h.x<s)&&(s=h.x),(!i||h.y<i)&&(i=h.y),(!a||h.x>a)&&(a=h.x),(!o||h.y>o)&&(o=h.y)})),this.Rect=[s,i,a,o],this._bBox){const t=e.getLocalBB();t.ll.set(s,i),t.lr.set(a,i),t.ur.set(a,o),t.ul.set(s,o)}this.createApStream(),e.M=on.fromDate(new Date)}parseProps(t){var e;super.parseProps(t);const{parser:n,bounds:r}=t,s=r.contentStart||r.start,i=r.contentEnd||r.end;let a,o,h=n.skipToNextName(s,i-1);for(;o=n.parseNameAt(h),o;)switch(h=o.end+1,a=o.value,a){case"/InkList":h=n.skipEmpty(h);if(n.getValueTypeAt(h)===we){const t=[];let e=++h;for(;;){const r=n.parseNumberArrayAt(e);if(!r)break;t.push(r.value),e=r.end+1}this.InkList=t;break}throw new Error("Can't parse /InkList property value");default:h=n.skipToNextName(h,i-1)}if(!(null===(e=this.InkList)||void 0===e?void 0:e.length))throw new Error("Not all required properties parsed")}createApStream(){var t,e,n,r,s,i,a,o,h,c,d,l,p;const u=new Dn;let f;if(u.Filter="/FlateDecode",u.LastModified=on.fromDate(new Date),u.BBox=this.Rect,null===(t=this.C)||void 0===t?void 0:t.length)if(this.C.length<3){const t=this.C[0];f=`${t} G ${t} g`}else if(3===this.C.length){const[t,e,n]=this.C;f=`${t} ${e} ${n} RG ${t} ${e} ${n} rg`}else{const[t,e,n,r]=this.C;f=`${t} ${e} ${n} ${r} K ${t} ${e} ${n} ${r} k`}else f="0 G 0 g";const g=this.CA||1,A=null!==(s=null!==(n=null===(e=this.BS)||void 0===e?void 0:e.W)&&void 0!==n?n:null===(r=this.Border)||void 0===r?void 0:r.width)&&void 0!==s?s:1,m=null!==(h=null!==(a=null===(i=this.BS)||void 0===i?void 0:i.D[0])&&void 0!==a?a:null===(o=this.Border)||void 0===o?void 0:o.dash)&&void 0!==h?h:3,w=null!==(p=null!==(d=null===(c=this.BS)||void 0===c?void 0:c.D[1])&&void 0!==d?d:null===(l=this.Border)||void 0===l?void 0:l.gap)&&void 0!==p?p:0,y=new Sn;y.AIS=!0,y.BM="/Normal",y.CA=g,y.ca=g,y.LW=A,y.D=[[m,w],0],u.Resources=new Pn,u.Resources.setGraphicsState("/GS0",y);let v,x,b=`q ${f} /GS0 gs`;this.InkList.forEach((t=>{v=t[0],x=t[1],b+=`\n${v} ${x} m`;for(let e=2;e<t.length;e+=2)v=t[e],x=t[e+1],b+=`\n${v} ${x} l`;b+="\nS"})),b+="\nQ",u.setTextStreamData(b),this.apStream=u}}class lr extends CustomEvent{constructor(t){super("tspdf-annotchange",{detail:t})}}class pr{constructor(t,e){this._pageById=new Map,this._annotIdsByPageId=new Map,this.getObjectParseInfo=t=>{var e,n,r;if(!t)return null;const s=null===(e=this._referenceData)||void 0===e?void 0:e.getOffset(t);if(isNaN(s))return null;const i=an.parse(this._docParser,s);if(!i)return null;const a=this._docParser.getIndirectObjectBoundsAt(i.end+1,!0);if(!a)return null;const o=this.getObjectParseInfo,h={parser:this._docParser,bounds:a,parseInfoGetter:o,cryptInfo:{ref:{id:i.value.id,generation:i.value.generation},stringCryptor:null===(n=this._authResult)||void 0===n?void 0:n.stringCryptor,streamCryptor:null===(r=this._authResult)||void 0===r?void 0:r.streamCryptor}};if(i.value.id===t)return h;const c=nr.parse(h);if(!c)return;const d=c.value.getObjectData(t);return d?(d.parseInfoGetter=o,d):null},this._data=t,this._docParser=new tn(t),this._version=this._docParser.getPdfVersion();const n=this._docParser.getLastXrefIndex();if(!n)throw new Error("File doesn't contain update section");const r=pr.parseAllXrefs(this._docParser,n.value);if(!r.length)throw new Error("Failed to parse cross-reference sections");this._xrefs=r,this._referenceData=new nn(r),this.parseEncryption(),this._userName=e}get userName(){return this._userName}get selectedAnnotation(){return this._selectedAnnotation}get size(){var t;return(null===(t=this._xrefs)||void 0===t?void 0:t.length)?this._xrefs[0].size:0}get encrypted(){return!!this._encryption}get authenticated(){return!this._encryption||!!this._authResult}static parseXref(t,e,n){if(!t||!e)return null;const r=e,s=t.findSubarrayIndex(yt.XREF_TABLE,{minIndex:e,closedOnly:!0});if(s&&s.start===e){const s=t.findSubarrayIndex(yt.XREF_HYBRID,{minIndex:e,maxIndex:n,closedOnly:!0});if(!s){const n=jn.parse(t,e,r);return null==n?void 0:n.value}{const n=t.parseNumberAt(s.end+1);if(!n)return null;e=n.value}}const i=an.parse(t,e,!1);if(!i)return null;const a=t.getIndirectObjectBoundsAt(i.end+1);if(!a)return null;const o=Jn.parse({parser:t,bounds:a},r);return null==o?void 0:o.value}static parseAllXrefs(t,e){const n=[];let r,s=t.maxIndex;for(;e&&(r=pr.parseXref(t,e,s),r);)n.push(r),s=e,e=r.prev;return n}destroy(){this.getAllSupportedAnnotations().forEach((t=>t.$onEditedAction=null))}tryAuthenticate(t=""){return!!this.authenticated||this.authenticate(t)}getPlainData(){return this._data.slice()}getDataWithoutSupportedAnnotations(){const t=this.getSupportedAnnotationMap(),e=[];(null==t?void 0:t.size)&&t.forEach(((t,n)=>{t.slice().forEach((t=>{t.deleted||(t.markAsDeleted(!0),e.push(t))}))}));const n=this.getDataWithUpdatedAnnotations();return e.forEach((t=>t.markAsDeleted(!1))),n}getDataWithUpdatedAnnotations(){const t=this.getSupportedAnnotationMap(),e=[];t.forEach(((t,n)=>{const r=this._pageById.get(n);if(!r)throw new Error(`Page with id '${n}' not found`);const s=this._annotIdsByPageId.get(n).slice()||[];e.push({page:r,allAnnotationIds:s,supportedAnnotations:t||[]})}));return new qn(this._data,this._xrefs[0],this._referenceData,this._authResult).getDataWithUpdatedAnnotations(e)}getPageAnnotations(t){return this.getSupportedAnnotationMap().get(t)||[]}appendAnnotationToPage(t,e){if(isNaN(t)||!e)throw new Error("Undefined argument exception");e.$pageId=t,e.$onEditedAction=this.getOnAnnotationEditAction(e);const n=this.getSupportedAnnotationMap().get(t);n?n.push(e):this.getSupportedAnnotationMap().set(t,[e]),document.dispatchEvent(new lr({type:"add",annotations:[e]}))}removeAnnotation(t){t&&(t.markAsDeleted(!0),this.setSelectedAnnotation(null),document.dispatchEvent(new lr({type:"delete",annotations:[t]})))}setSelectedAnnotation(t){var e,n;if(t===this._selectedAnnotation)return;if(this._selectedAnnotation){this._selectedAnnotation.$translationEnabled=!1;const t=null===(n=null===(e=this._selectedAnnotation)||void 0===e?void 0:e.lastRenderResult)||void 0===n?void 0:n.svg;null==t||t.classList.remove("selected")}const r=null==t?void 0:t.lastRenderResult.svg;return r?(t.$translationEnabled=!0,r.classList.add("selected"),this._selectedAnnotation=t):this._selectedAnnotation=null,document.dispatchEvent(new lr({type:"select",annotations:this._selectedAnnotation?[this._selectedAnnotation]:[]})),this._selectedAnnotation}appendSerializedAnnotations(t){let e;for(const n of t){switch(n.annotationType){case"/Stamp":e=cr.createFromDto(n);break;case"/Ink":e=dr.createFromDto(n);break;default:throw new Error(`Unsupported annotation type: ${n.annotationType}`)}this.appendAnnotationToPage(n.pageId,e)}}serializeAnnotations(t=!1){const e=[];return this.getSupportedAnnotationMap().forEach(((n,r)=>{n.forEach((n=>{t&&!n.added||e.push(n.toDto())}))})),e}getOnAnnotationEditAction(t){return t?()=>document.dispatchEvent(new lr({type:"edit",annotations:[t]})):null}authenticate(t){if(this.authenticated)return!0;const e=this._encryption.toCryptOptions(),n=this._xrefs[0].id[0].hex,r=new $e(e,n);return this._authResult=r.authenticate(t),this.authenticated}checkAuthentication(){if(!this.authenticated)throw new Error("Unauthorized access to file data")}parseEncryption(){const t=this._xrefs[0].encrypt;if(!t)return;const e=this.getObjectParseInfo(t.id),n=er.parse(e);if(!n)throw new Error("Encryption dict can't be parsed");this._encryption=n.value}parsePages(t,e){if(e.Kids.length)for(const n of e.Kids){const e=this.getObjectParseInfo(n.id);if(!e)continue;const r=e.parser.parseDictType(e.bounds);if(r===te){const n=Zn.parse(e);n&&this.parsePages(t,n.value)}else if(r===ee){const n=Yn.parse(e);n&&t.push(n.value)}}}parsePageTree(){const t=this._xrefs[0].root,e=this.getObjectParseInfo(t.id),n=Kn.parse(e);if(!n)throw new Error("Document root catalog not found");this._catalog=n.value;const r=n.value.Pages,s=this.getObjectParseInfo(r.id),i=Zn.parse(s);if(!i)throw new Error("Document root page tree not found");const a=[];this.parsePages(a,i.value),this._pages=a,this._pageById.clear(),a.forEach((t=>this._pageById.set(t.ref.id,t)))}parseSupportedAnnotations(){var t;this.checkAuthentication(),this._catalog||this.parsePageTree();const e=new Map,n=new Map;for(const r of this._pages){const s=[];if(Array.isArray(r.Annots))s.push(...r.Annots);else if(r.Annots instanceof an){const e=this.getObjectParseInfo(r.Annots.id);if(e){const n=an.parseRefArray(e.parser,e.bounds.contentStart);(null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.length)&&s.push(...n.value)}}e.set(r.ref.id,s);const i=[];for(const t of s){const e=this.getObjectParseInfo(t.id);e.rect=r.MediaBox;let n;switch(e.parser.parseDictSubtype(e.bounds)){case _e:n=cr.parse(e);break;case Ee:n=dr.parse(e)}n&&(i.push(n.value),n.value.$pageId=r.id,n.value.$onEditedAction=this.getOnAnnotationEditAction(n.value),console.log(n.value))}n.set(r.id,i)}return this._annotIdsByPageId=e,this._supportedAnnotsByPageId=n,this._supportedAnnotsByPageId}getSupportedAnnotationMap(){return this.checkAuthentication(),this._supportedAnnotsByPageId||(this._supportedAnnotsByPageId=this.parseSupportedAnnotations()),this._supportedAnnotsByPageId}getAllSupportedAnnotations(){const t=[];return this.getSupportedAnnotationMap().forEach(((e,n)=>{t.push(...e)})),t}}var ur=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class fr{constructor(t){if(this.onMouseDown=t=>{var e;this._divModeTimer&&(clearTimeout(this._divModeTimer),this._divModeTimer=null),null===(e=this._renderTask)||void 0===e||e.expandTextDivs(!0)},this.onMouseUp=t=>{this._divModeTimer=setTimeout((()=>{var t;null===(t=this._renderTask)||void 0===t||t.expandTextDivs(!1),this._divModeTimer=null}),300)},!t)throw new Error("Page proxy is not defined");this._pageProxy=t,this._container=document.createElement("div"),this._container.classList.add("page-text"),this._container.addEventListener("mousedown",this.onMouseDown),this._container.addEventListener("mouseup",this.onMouseUp)}static appendPageTextAsync(t,e,n){return ur(this,void 0,void 0,(function*(){const r=new fr(t);return yield r.renderTextLayerAsync(n),e.append(r._container),r}))}destroy(){this.destroyRenderTask(),this._container&&(this._container.remove(),this._container=null)}renderTextLayerAsync(e){return ur(this,void 0,void 0,(function*(){this.clear(),this.destroyRenderTask();const n=this._pageProxy.getViewport({scale:e}),r=this._pageProxy.streamTextContent();this._renderTask=t({container:this._container,textContentStream:r,viewport:n,enhanceTextSelection:!0});try{yield this._renderTask.promise}catch(t){if("TextLayer task cancelled."===t.message)return!1;throw t}return!0}))}clear(){this._container.innerHTML=""}destroyRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}}var gr=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class Ar{constructor(t,e,n){if(this._rendered=new Map,this.onAnnotationSelectionChange=t=>{const e=t.detail.annotation;this._container.style.touchAction=e?"none":""},!t||isNaN(e)||!n)throw new Error("Required argument not found");this._pageId=e,this._pageDimensions=n,this._docData=t,this._container=document.createElement("div"),this._container.classList.add("page-annotations"),this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add("stretch"),this._svg.setAttribute("data-page-id",e+""),this._svg.setAttribute("viewBox",`0 0 ${n.x} ${n.y}`),this._svg.setAttribute("transform","scale(1, -1)"),this._svg.addEventListener("pointerdown",(e=>{e.target===this._svg&&t.setSelectedAnnotation(null)})),this._defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),this._container.append(this._svg)}destroy(){this.remove(),this._container=null,this._destroyed=!0}remove(){var t;null===(t=this._container)||void 0===t||t.remove(),document.removeEventListener("annotationselectionchange",this.onAnnotationSelectionChange)}appendAsync(t){return gr(this,void 0,void 0,(function*(){this._destroyed||(yield this.renderAnnotationsAsync(),t.append(this._container),document.addEventListener("annotationselectionchange",this.onAnnotationSelectionChange))}))}renderAnnotationsAsync(){return gr(this,void 0,void 0,(function*(){this.clear();const t=this._docData.getPageAnnotations(this._pageId)||[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted)continue;let r;if(this._rendered.has(n)?r=this._rendered.get(n):yield new Promise((t=>{setTimeout((()=>gr(this,void 0,void 0,(function*(){r=yield n.renderAsync(),t()}))),0)})),!r)continue;this._rendered.set(n,r);const{svg:s,clipPaths:i}=r;this._svg.append(s),null==i||i.forEach((t=>this._defs.append(t))),s.addEventListener("pointerdown",(()=>this._docData.setSelectedAnnotation(n)))}return this._svg.append(this._defs),!0}))}clear(){this._svg.innerHTML=""}}var mr=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class wr{constructor(t,e,n,r){if(!t)throw new Error("Page proxy is not defined");if(!e)throw new Error("Annotation data is not defined");this._pageProxy=t,this._viewport=t.getViewport({scale:1}),this._maxScale=Math.max(n,1),this._docData=e,this.number=t.pageNumber,this.id=t.ref.num,this.generation=t.ref.gen;const{width:s,height:i}=this._viewport,a=(r=Math.max(null!=r?r:0,50))*(i/s);this._dimensions={width:s,height:i,previewWidth:r,previewHeight:a},this._previewContainer=document.createElement("div"),this._previewContainer.classList.add("page-preview"),this._previewContainer.setAttribute("data-page-number",this.number+""),this._previewContainer.setAttribute("data-page-id",this.id+""),this._previewContainer.setAttribute("data-page-gen",this.generation+""),this._previewContainer.style.width=this._dimensions.previewWidth+"px",this._previewContainer.style.height=this._dimensions.previewHeight+"px",this._viewContainer=document.createElement("div"),this._viewContainer.classList.add("page"),this._viewContainer.setAttribute("data-page-number",this.number+""),this._viewContainer.setAttribute("data-page-id",this.id+""),this._viewContainer.setAttribute("data-page-gen",this.generation+""),this.scale=1}get previewContainer(){return this._previewContainer}get viewContainer(){return this._viewContainer}set _viewRendered(t){this.$viewRendered=t,this._viewContainer.setAttribute("data-loaded",t+"")}get _viewRendered(){return this.$viewRendered}set scale(t){if(t<=0||this._scale===t)return;this._scale=t;const e=window.devicePixelRatio;this._dimensions.scaledWidth=this._dimensions.width*this._scale,this._dimensions.scaledHeight=this._dimensions.height*this._scale,this._dimensions.scaledDprWidth=this._dimensions.scaledWidth*e,this._dimensions.scaledDprHeight=this._dimensions.scaledHeight*e,this._viewContainer.style.width=this._dimensions.scaledWidth+"px",this._viewContainer.style.height=this._dimensions.scaledHeight+"px",this._viewCanvas&&(this._viewCanvas.style.width=this._dimensions.scaledWidth+"px",this._viewCanvas.style.height=this._dimensions.scaledHeight+"px"),this._scaleIsValid=!1}get viewValid(){return this._scaleIsValid&&this._viewRendered}destroy(){this._previewContainer.remove(),this._viewContainer.remove(),this._pageProxy.cleanup()}renderPreviewAsync(t=!1){return mr(this,void 0,void 0,(function*(){if(this._renderPromise&&(t&&this.cancelRenderTask(),yield this._renderPromise),t||!this._previewRendered)return this._renderPromise=this.runPreviewRenderAsync(),this._renderPromise}))}renderViewAsync(t=!1){return mr(this,void 0,void 0,(function*(){if(this._renderPromise&&(t&&this.cancelRenderTask(),yield this._renderPromise),t||!this.viewValid)return this._renderPromise=this.runViewRenderAsync(),this._renderPromise}))}clearPreview(){this._previewContainer.innerHTML=""}clearView(){var t,e,n;null===(t=this._annotations)||void 0===t||t.destroy(),this._annotations=null,null===(e=this._text)||void 0===e||e.destroy(),this._text=null,null===(n=this._viewCanvas)||void 0===n||n.remove(),this._viewRendered=!1}cancelRenderTask(){this._renderTask&&(this._renderTask.cancel(),this._renderTask=null)}runRenderTaskAsync(t){return mr(this,void 0,void 0,(function*(){this.cancelRenderTask(),this._renderTask=this._pageProxy.render(t);try{yield this._renderTask.promise}catch(t){if(t instanceof e)return!1;throw t}finally{this._renderTask=null}return!0}))}createPreviewCanvas(){const t=document.createElement("canvas");t.classList.add("page-canvas");const e=window.devicePixelRatio,{previewWidth:n,previewHeight:r}=this._dimensions;return t.style.width=n+"px",t.style.height=r+"px",t.width=n*e,t.height=r*e,t}createViewCanvas(){const t=document.createElement("canvas");return t.classList.add("page-canvas"),t.style.width=this._dimensions.scaledWidth+"px",t.style.height=this._dimensions.scaledHeight+"px",t.width=this._dimensions.scaledDprWidth,t.height=this._dimensions.scaledDprHeight,t}scaleCanvasImage(t,e){let n,r=this._scale/this._maxScale,s=t;for(;r<.5;)n=document.createElement("canvas"),n.width=.5*s.width,n.height=.5*s.height,n.getContext("2d").drawImage(s,0,0,n.width,n.height),s=n,r*=2;e.getContext("2d").drawImage(s,0,0,e.width,e.height)}runPreviewRenderAsync(){return mr(this,void 0,void 0,(function*(){const t=this.createPreviewCanvas(),e={canvasContext:t.getContext("2d"),viewport:this._viewport.clone({scale:t.width/this._dimensions.width})};(yield this.runRenderTaskAsync(e))?(this._previewContainer.innerHTML="",this._previewContainer.append(t),this._previewRendered=!0):this._previewRendered=!1}))}runViewRenderAsync(){var t,e;return mr(this,void 0,void 0,(function*(){const n=this._scale;null===(t=this._text)||void 0===t||t.destroy(),this._text=null;const r=this.createViewCanvas(),s={canvasContext:r.getContext("2d"),viewport:this._viewport.clone({scale:n*window.devicePixelRatio}),enableWebGL:!0};if((yield this.runRenderTaskAsync(s))&&n===this._scale){if(null===(e=this._viewCanvas)||void 0===e||e.remove(),this._viewContainer.append(r),this._viewCanvas=r,this._viewRendered=!0,this._text=yield fr.appendPageTextAsync(this._pageProxy,this._viewContainer,n),!this._annotations){const{width:t,height:e}=this._dimensions;this._annotations=new Ar(this._docData,this.id,new A(t,e))}yield this._annotations.appendAsync(this.viewContainer),n===this._scale&&(this._scaleIsValid=!0)}}))}}class yr{constructor(){this.onPointerDownOutside=t=>{if(!this._shown)return;t.composedPath()[0].closest("#context-menu")||this.hide()},this._container=document.createElement("div"),this._container.id="context-menu",document.addEventListener("pointerdown",this.onPointerDownOutside)}set content(t){var e;null===(e=this._content)||void 0===e||e.remove(),t?(this._container.append(t),this._content=t):this._content=null}destroy(){this.clear(),document.removeEventListener("pointerdown",this.onPointerDownOutside)}show(t,e){this.setContextMenuPosition(t,e),e.append(this._container),this._shown=!0}hide(){this._container.remove(),this._shown=!1}clear(){this._container.remove(),this.content=null}setContextMenuPosition(t,e){const n=new A(this._container.offsetWidth,this._container.offsetHeight),r=new A,s=e.getBoundingClientRect(),i=new A(t.x-s.x,t.y-s.y);i.x+n.x>s.width+s.x?r.x=i.x-n.x:r.x=i.x,i.y+n.y>s.height+s.y?r.y=i.y-n.y:r.y=i.y,this._container.style.left=r.x+"px",this._container.style.top=r.y+"px"}}class vr{constructor(t,e){if(this._scale=1,this._renderedPages=[],this.onParentScroll=()=>{this.refreshViewBox()},!t)throw new Error("Document data not found");if(!e)throw new Error("Parent container not found");this._docData=t,this._parent=e}get scale(){return this._scale}set scale(t){this._scale=t}get renderedPages(){return this._renderedPages.slice()}set renderedPages(t){this._renderedPages=(null==t?void 0:t.length)?t.slice():[]}get overlayContainer(){return this._overlayContainer}destroy(){var t,e,n;this._overlayContainer.remove(),null===(t=this._parent)||void 0===t||t.removeEventListener("scroll",this.onParentScroll),null===(e=this._parentMutationObserver)||void 0===e||e.disconnect(),null===(n=this._parentResizeObserver)||void 0===n||n.disconnect()}deleteSelectedAnnotation(){const t=this._docData.selectedAnnotation;t&&this._docData.removeAnnotation(t)}refreshViewBox(){const{width:t,height:e}=this._overlay.getBoundingClientRect();if(!t||!e)return;this._overlay.style.left=this._parent.scrollLeft+"px",this._overlay.style.top=this._parent.scrollTop+"px";const n=t/this._scale,r=e/this._scale;this._svgWrapper.setAttribute("viewBox",`0 0 ${n} ${r}`),this._lastScale=this._scale}initObservers(){this._parent.addEventListener("scroll",this.onParentScroll);const t=()=>{this._scale!==this._lastScale&&this.refreshViewBox()},e=new ResizeObserver((e=>{t()})),n=new MutationObserver((n=>{const r=n[0];r&&(r.addedNodes.forEach((t=>{t.classList.contains("page")&&e.observe(t)})),r.removedNodes.forEach((t=>e.unobserve(t))),t())}));n.observe(this._parent,{attributes:!1,childList:!0,subtree:!1}),this._parentMutationObserver=n,this._parentResizeObserver=e}init(){const t=document.createElement("div");t.id="annotation-overlay-container";const e=document.createElement("div");e.id="annotation-overlay";const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("abs-stretch","no-margin","no-padding"),n.setAttribute("transform","matrix(1 0 0 -1 0 0)"),n.setAttribute("opacity","0.5");const r=document.createElementNS("http://www.w3.org/2000/svg","g");n.append(r),e.append(n),t.append(e),this._overlayContainer=t,this._overlay=e,this._svgWrapper=n,this._svgGroup=r,this._parent.append(this._overlayContainer),this.refreshViewBox(),this.initObservers()}updatePageCoords(t,e){const n=this.getPageCoordsUnderPointer(t,e);n?this._svgGroup.classList.remove("out"):this._svgGroup.classList.add("out"),this._pageCoords=n}getPageCoordsUnderPointer(t,e){for(const n of this._renderedPages){const{left:r,top:s,width:i,height:a}=n.viewContainer.getBoundingClientRect(),o=r+i,h=s+a;if(t<r||t>o)continue;if(e<s||e>h)continue;const c=(t-r)/this._scale,d=(h-e)/this._scale;return{pageId:n.id,pageX:c,pageY:d}}return null}}var xr=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class br extends vr{constructor(t,e,n){if(super(t,e),this.onStampPointerMove=t=>{if(!t.isPrimary)return;const{clientX:e,clientY:n}=t,{height:r,top:s,left:i}=this._parent.getBoundingClientRect(),a=s+r,o=(e-i)/this._scale,h=(a-n)/this._scale,[c,d,l,p]=this._tempAnnotation.Rect;this._svgGroup.setAttribute("transform",`translate(${o-(l-c)/2} ${h-(p-d)/2})`),this.updatePageCoords(e,n)},this.onStampPointerUp=t=>{if(!t.isPrimary||2===t.button)return;const{clientX:e,clientY:n}=t,r=this.getPageCoordsUnderPointer(e,n);if(this._pageCoords=r,!r||!this._tempAnnotation)return;const{pageId:s,pageX:i,pageY:a}=this._pageCoords;this._tempAnnotation.moveTo(i,a),this._docData.appendAnnotationToPage(s,this._tempAnnotation),this.createTempStampAnnotationAsync()},n){if(!Object.values(rr).includes(n))throw new Error(`Unsupported stamp type: '${n}'`);this._type=n,br.lastType=this._type}else this._type=br.lastType;this.init()}destroy(){this._tempAnnotation=null,super.destroy()}init(){super.init(),this._overlay.addEventListener("pointermove",this.onStampPointerMove),this._overlay.addEventListener("pointerup",this.onStampPointerUp),this.createTempStampAnnotationAsync()}createTempStampAnnotationAsync(){return xr(this,void 0,void 0,(function*(){const t=cr.createStandard(this._type,this._docData.userName),e=yield t.renderAsync();this._svgGroup.innerHTML="",this._svgGroup.append(...e.clipPaths||[]),this._svgGroup.append(e.svg),this._tempAnnotation=t}))}}br.lastType="/Draft";class _r{constructor(t){this._paths=[],this._positionBuffer=[],this._options=Object.assign({},_r.defaultOptions,t),this._group=document.createElementNS("http://www.w3.org/2000/svg","g")}get id(){return this._options.id}get bufferSize(){return this._options.bufferSize}get strokeWidth(){return this._options.strokeWidth}get color(){return this._options.color.slice()}get group(){return this._group}get paths(){return this._paths.slice()}get pathCount(){return this._paths.length}newPath(t){const[e,n,r,s]=this._options.color||[0,0,0,1],i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("fill","none"),i.setAttribute("stroke",`rgba(${255*e},${255*n},${255*r},${s})`),i.setAttribute("stroke-width",this._options.strokeWidth+"");const a="M"+t.x+" "+t.y;i.setAttribute("d",a),this._positionBuffer=[t],this._currentPath={path:i,positions:[new A(t.x,t.y)]},this._currentPathString=a,this._group.append(i)}endPath(){this._currentPath&&this._currentPath.positions.length>1&&this._paths.push(this._currentPath),this._positionBuffer=null,this._currentPath=null,this._currentPathString=null}removePath(t){t&&(t.remove(),this._paths=this._paths.filter((e=>e.path!==t)))}removeLastPath(){const t=this._paths.pop();null==t||t.path.remove()}addPosition(t){this.appendPositionToBuffer(t),this.updateCurrentPath()}setGroupMatrix(t){this._group.setAttribute("transform",`matrix(${t.join(" ")})`)}appendPositionToBuffer(t){const e=this._positionBuffer;e.push(t),this._positionBuffer=e.slice(Math.max(0,e.length-this._options.bufferSize),e.length)}getAveragePosition(t){const e=this._positionBuffer.length;if(e%2==1||e>=this._options.bufferSize){let n,r,s=0,i=0,a=0;for(r=t;r<e;r++)a++,n=this._positionBuffer[r],s+=n.x,i+=n.y;return new A(s/a,i/a)}return null}updateCurrentPath(){let t=this.getAveragePosition(0);if(t){this._currentPathString+=" L"+t.x+" "+t.y,this._currentPath.positions.push(t);let e="";for(let n=2;n<this._positionBuffer.length;n+=2)t=this.getAveragePosition(n),e+=" L"+t.x+" "+t.y;this._currentPath.path.setAttribute("d",this._currentPathString+e)}}}_r.defaultOptions={bufferSize:8,strokeWidth:2,color:[0,0,0,.5]};class Er extends CustomEvent{constructor(t){super("tspdf-penpathchange",{detail:t})}}class Cr extends vr{constructor(t,e,n){super(t,e),this.onPenPointerDown=t=>{if(!t.isPrimary||2===t.button)return;const{clientX:e,clientY:n}=t;this.updatePageCoords(e,n);const r=this._pageCoords;if(!r)return;const{pageX:s,pageY:i,pageId:a}=r;this._annotationPenData&&a===this._annotationPenData.id||this.resetTempPenData(a),this._annotationPenData.newPath(new A(s,i));const o=t.target;o.addEventListener("pointermove",this.onPenPointerMove),o.addEventListener("pointerup",this.onPenPointerUp),o.addEventListener("pointerout",this.onPenPointerUp),o.setPointerCapture(t.pointerId)},this.onPenPointerMove=t=>{if(!t.isPrimary||!this._annotationPenData)return;const{clientX:e,clientY:n}=t;this.updatePageCoords(e,n);const r=this._pageCoords;r&&r.pageId===this._annotationPenData.id&&this._annotationPenData.addPosition(new A(r.pageX,r.pageY))},this.onPenPointerUp=t=>{var e;if(!t.isPrimary)return;const n=t.target;n.removeEventListener("pointermove",this.onPenPointerMove),n.removeEventListener("pointerup",this.onPenPointerUp),n.removeEventListener("pointerout",this.onPenPointerUp),n.releasePointerCapture(t.pointerId),null===(e=this._annotationPenData)||void 0===e||e.endPath(),this.emitPathCount()},this.init(),this._color=n||Cr.lastColor||[0,0,0,.5],Cr.lastColor=this._color}destroy(){this.removeTempPenData(),super.destroy()}refreshViewBox(){super.refreshViewBox(),this.updatePenGroupPosition()}undoPath(){var t;null===(t=this._annotationPenData)||void 0===t||t.removeLastPath(),this.emitPathCount()}clearPaths(){this.removeTempPenData()}savePathsAsInkAnnotation(){if(!this._annotationPenData)return;const t=this._annotationPenData.id,e=dr.createFromPenData(this._annotationPenData,this._docData.userName);this._docData.appendAnnotationToPage(t,e),this.removeTempPenData()}init(){super.init(),this._overlay.addEventListener("pointerdown",this.onPenPointerDown)}updatePenGroupPosition(){if(!this._annotationPenData)return;const t=this._renderedPages.find((t=>t.id===this._annotationPenData.id));t||this._annotationPenData.setGroupMatrix([0,0,0,0,0,0]);const{height:e,top:n,left:r}=t.viewContainer.getBoundingClientRect(),s=n+e,{height:i,top:a,left:o}=this._parent.getBoundingClientRect(),h=a+i,c=(r-o)/this._scale,d=(h-s)/this._scale;this._annotationPenData.setGroupMatrix([1,0,0,1,c,d])}removeTempPenData(){this._annotationPenData&&(this._annotationPenData.group.remove(),this._annotationPenData=null,this.emitPathCount())}resetTempPenData(t){this.removeTempPenData(),this._annotationPenData=new _r({id:t,color:this._color}),this._svgGroup.append(this._annotationPenData.group),this.updatePenGroupPosition()}emitPathCount(){var t;this._parent.dispatchEvent(new Er({pathCount:(null===(t=this._annotationPenData)||void 0===t?void 0:t.pathCount)||0}))}}var Sr=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function a(t){try{h(r.next(t))}catch(t){i(t)}}function o(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((r=r.apply(t,e||[])).next())}))};class Pr{constructor(t){if(this._visibleAdjPages=0,this._previewWidth=100,this._minScale=.25,this._maxScale=4,this._scale=1,this._previewerHidden=!0,this._pages=[],this._renderedPages=[],this._currentPage=0,this._pointerInfo={lastPos:null,downPos:null,downScroll:null},this._timers={hidePanels:0},this._pinchInfo={active:!1,lastDist:0,minDist:10,sensitivity:.025,target:null},this.onPdfLoadingProgress=t=>{},this.onPdfLoadedAsync=(t,e)=>Sr(this,void 0,void 0,(function*(){this._pdfDocument=t,this._docData=e,this.setAnnotationMode("select"),yield this.refreshPagesAsync(),this.renderVisiblePreviews(),this.renderVisiblePages(),this._shadowRoot.querySelector("#bottom-panel").classList.remove("disabled")})),this.onPdfClosedAsync=()=>Sr(this,void 0,void 0,(function*(){var t,e;this._shadowRoot.querySelector("#bottom-panel").classList.add("disabled"),this.setViewerMode("text"),this._pdfDocument&&(this._pdfDocument.destroy(),this._pdfDocument=null,null===(t=this._annotator)||void 0===t||t.destroy(),this._annotator=null,null===(e=this._docData)||void 0===e||e.destroy(),this._docData=null),yield this.refreshPagesAsync()})),this.onPreviewerToggleClick=()=>{this._previewerHidden?(this._mainContainer.classList.remove("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.add("on"),this._previewerHidden=!1,setTimeout((()=>this.renderVisiblePreviews()),1e3)):(this._mainContainer.classList.add("hide-previewer"),this._shadowRoot.querySelector("div#toggle-previewer").classList.remove("on"),this._previewerHidden=!0)},this.onPreviewerPageClick=t=>{let e,n=t.target;for(;n&&!e;){const t=n.dataset.pageNumber;t?e=+t:n=n.parentElement}e&&this.scrollToPage(e-1)},this.onPreviewerScroll=t=>{this.renderVisiblePreviews()},this.onViewerPointerMove=t=>{const{clientX:e,clientY:n}=t,{x:r,y:s,width:i,height:a}=this._viewer.getBoundingClientRect(),o=e-r,h=n-s,c=i-o,d=a-h;Math.min(o,c,h,d)>100?this._panelsHidden||this._timers.hidePanels||(this._timers.hidePanels=setTimeout((()=>{this._mainContainer.classList.add("hide-panels"),this._panelsHidden=!0,this._timers.hidePanels=null}),5e3)):(this._timers.hidePanels&&(clearTimeout(this._timers.hidePanels),this._timers.hidePanels=null),this._panelsHidden&&(this._mainContainer.classList.remove("hide-panels"),this._panelsHidden=!1)),this._pointerInfo.lastPos=new A(e,n)},this.onTextModeButtonClick=()=>{this.setViewerMode("text")},this.onHandModeButtonClick=()=>{this.setViewerMode("hand")},this.onAnnotationModeButtonClick=()=>{this.setViewerMode("annotation")},this.onViewerScroll=t=>{this._contextMenu.hide(),this.renderVisiblePages()},this.onViewerPointerDownScroll=t=>{if("hand"!==this._viewerMode)return;const{clientX:e,clientY:n}=t;this._pointerInfo.downPos=new A(e,n),this._pointerInfo.downScroll=new A(this._viewer.scrollLeft,this._viewer.scrollTop);const r=t=>{const{x:e,y:n}=this._pointerInfo.downPos,{x:r,y:s}=this._pointerInfo.downScroll,i=t.clientX-e,a=t.clientY-n;this._viewer.scrollTo(r-i,s-a)},s=t=>{this._pointerInfo.downPos=null,this._pointerInfo.downScroll=null,window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",s),window.removeEventListener("pointerout",s)};window.addEventListener("pointermove",r),window.addEventListener("pointerup",s),window.addEventListener("pointerout",s)},this.onViewerWheelZoom=t=>{t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoomOut(this._pointerInfo.lastPos):this.zoomIn(this._pointerInfo.lastPos))},this.onViewerTouchZoom=t=>{if(2!==t.touches.length)return;const e=t.touches[0],n=t.touches[1];this._pinchInfo.active=!0,this._pinchInfo.lastDist=p(e.clientX,e.clientY,n.clientX,n.clientY);const r=t=>{if(2!==t.touches.length)return;const e=t.touches[0],n=t.touches[1],r=p(e.clientX,e.clientY,n.clientX,n.clientY),s=r-this._pinchInfo.lastDist,i=Math.floor(s/this._pinchInfo.minDist);if(i){const t=new A((n.clientX+e.clientX)/2,(n.clientY+e.clientY)/2);this._pinchInfo.lastDist=r,this.zoom(i*this._pinchInfo.sensitivity,t)}},s=e=>{this._pinchInfo.active=!1,this._pinchInfo.lastDist=0,t.target.removeEventListener("touchmove",r),t.target.removeEventListener("touchend",s),t.target.removeEventListener("touchcancel",s)};t.target.addEventListener("touchmove",r),t.target.addEventListener("touchend",s),t.target.addEventListener("touchcancel",s)},this.onZoomOutClick=()=>{this.zoomOut()},this.onZoomInClick=()=>{this.zoomIn()},this.onZoomFitViewerClick=()=>{const t=g((this._viewer.getBoundingClientRect().width-20)/this._pages[this._currentPage].viewContainer.getBoundingClientRect().width*this._scale,this._minScale,this._maxScale);this.setScale(t),this.scrollToPage(this._currentPage)},this.onZoomFitPageClick=()=>{const{width:t,height:e}=this._viewer.getBoundingClientRect(),{width:n,height:r}=this._pages[this._currentPage].viewContainer.getBoundingClientRect(),s=g((t-20)/n*this._scale,this._minScale,this._maxScale),i=g((e-20)/r*this._scale,this._minScale,this._maxScale);this.setScale(Math.min(s,i)),this.scrollToPage(this._currentPage)},this.onPaginatorInput=t=>{t.target instanceof HTMLInputElement&&(t.target.value=t.target.value.replace(/[^\d]+/g,""))},this.onPaginatorChange=t=>{if(t.target instanceof HTMLInputElement){const e=Math.max(Math.min(+t.target.value,this._pdfDocument.numPages),1);e+""!==t.target.value&&(t.target.value=e+""),this.scrollToPage(e-1)}},this.onPaginatorPrevClick=()=>{const t=g(this._currentPage-1,0,this._pages.length-1);this.scrollToPage(t)},this.onPaginatorNextClick=()=>{const t=g(this._currentPage+1,0,this._pages.length-1);this.scrollToPage(t)},this.onAnnotationDeleteButtonClick=()=>this._annotator.deleteSelectedAnnotation(),this.onAnnotationSelectModeButtonClick=()=>{this.setAnnotationMode("select")},this.onAnnotationStampModeButtonClick=()=>{this.setAnnotationMode("stamp")},this.onAnnotationPenModeButtonClick=()=>{this.setAnnotationMode("pen")},this.onAnnotationGeometricModeButtonClick=()=>{this.setAnnotationMode("geometric")},this.onAnnotationChange=t=>{var e,n,r,s;if(!t.detail)return;const i=t.detail.annotations;switch(t.detail.type){case"select":(null==i?void 0:i.length)?this._mainContainer.classList.add("annotation-selected"):this._mainContainer.classList.remove("annotation-selected"),(null===(e=this._annotChangeCallbacks)||void 0===e?void 0:e.select)&&this._annotChangeCallbacks.select(i?i.map((t=>t.toDto())):[]);break;case"add":(null===(n=this._annotChangeCallbacks)||void 0===n?void 0:n.add)&&this._annotChangeCallbacks.add(i?i.map((t=>t.toDto())):[]);break;case"edit":(null===(r=this._annotChangeCallbacks)||void 0===r?void 0:r.edit)&&this._annotChangeCallbacks.edit(i?i.map((t=>t.toDto())):[]);break;case"delete":(null===(s=this._annotChangeCallbacks)||void 0===s?void 0:s.delete)&&this._annotChangeCallbacks.delete(i?i.map((t=>t.toDto())):[])}if(null==i?void 0:i.length){const t=new Set(i.map((t=>t.$pageId)));this._renderedPages.forEach((e=>{t.has(e.id)&&e.renderViewAsync(!0)}))}},this.onDownloadFileButtonClick=()=>{var t;const e=null===(t=this._docData)||void 0===t?void 0:t.getDataWithUpdatedAnnotations();(null==e?void 0:e.length)&&Pr.downloadFile(e,`file_${(new Date).toISOString()}.pdf`)},!t)throw new Error("No options provided");const e=document.querySelector(t.containerSelector);if(!e)throw new Error("Container not found");if(!(e instanceof HTMLDivElement))throw new Error("Container is not a DIV element");if(this._outerContainer=e,!t.workerSource)throw new Error("Worker source path not defined");n.workerSrc=t.workerSource,this._userName=t.userName||"Guest",this._annotChangeCallbacks=t.annotChangeCallbacks,this.initViewerGUI()}static downloadFile(t,e,n="application/pdf"){const r=new Blob([t],{type:n}),s=URL.createObjectURL(r),i=document.createElement("a");i.setAttribute("download",e),i.href=s,document.body.appendChild(i),i.click(),i.remove(),setTimeout((()=>URL.revokeObjectURL(s)),1e4)}destroy(){var t,e,n,r,s;document.removeEventListener("tspdf-annotchange",this.onAnnotationChange),this._annotChangeCallbacks=null,null===(t=this._pdfLoadingTask)||void 0===t||t.destroy(),this._pages.forEach((t=>t.destroy())),this._pdfDocument&&(this._pdfDocument.cleanup(),this._pdfDocument.destroy()),null===(e=this._annotator)||void 0===e||e.destroy(),null===(n=this._docData)||void 0===n||n.destroy(),null===(r=this._contextMenu)||void 0===r||r.destroy(),null===(s=this._mainContainerRObserver)||void 0===s||s.disconnect(),this._shadowRoot.innerHTML=""}openPdfAsync(t){return Sr(this,void 0,void 0,(function*(){let e,n;try{if(t instanceof Uint8Array)e=t;else{let n;if("string"==typeof t){const e=yield fetch(t);n=yield e.blob()}else n=t;const r=yield n.arrayBuffer();e=new Uint8Array(r)}}catch(t){throw new Error(`Cannot load file data: ${t.message}`)}const s=new pr(e,this._userName);let i;for(;;){if(s.tryAuthenticate(i))break;if(i=yield this.showPasswordDialogAsync(),null===i)throw new Error("File loading cancelled: authentication aborted")}e=s.getDataWithoutSupportedAnnotations();try{if(this._pdfLoadingTask)return yield this.closePdfAsync(),this.openPdfAsync(e);this._pdfLoadingTask=r({data:e,password:i}),this._pdfLoadingTask.onProgress=this.onPdfLoadingProgress,n=yield this._pdfLoadingTask.promise,this._pdfLoadingTask=null}catch(t){throw new Error(`Cannot open PDF: ${t.message}`)}yield this.onPdfLoadedAsync(n,s)}))}closePdfAsync(){return Sr(this,void 0,void 0,(function*(){this._pdfLoadingTask&&(this._pdfLoadingTask.destroyed||(yield this._pdfLoadingTask.destroy()),this._pdfLoadingTask=null),yield this.onPdfClosedAsync()}))}importAnnotations(t){var e;try{const n=JSON.parse(t);null===(e=this._docData)||void 0===e||e.appendSerializedAnnotations(n)}catch(t){console.log(`Error while importing annotations: ${t.message}`)}}exportAnnotations(){var t;const e=null===(t=this._docData)||void 0===t?void 0:t.serializeAnnotations(!0);return JSON.stringify(e)}initViewerGUI(){this._shadowRoot=this._outerContainer.attachShadow({mode:"open"}),this._shadowRoot.innerHTML='\n<style>\n  :host {\n    --color-primary-final: var(--color-primary, rgba(40,40,40,1));\n    --color-primary-tr-final: var(--color-primary-tr, rgba(40,40,40,0.9));\n    --color-secondary-final: var(--color-secondary, rgba(60,60,60,1));\n    --color-secondary-tr-final: var(--color-secondary-tr, rgba(60,60,60,0.9));\n    --color-accent-final: var(--color-accent, rgba(96,96,96,1));\n    --color-shadow-final: var(--color-shadow, rgba(0,0,0,0.75));\n    --color-bg-final: var(--color-bg, rgba(128,128,128,1));\n    --color-fg-primary-final: var(--color-fg-primary, rgba(255,255,255,1));\n    --color-fg-secondary-final: var(--color-fg-secondary, rgba(187,187,187,1));\n    --color-fg-accent-final: var(--color-fg-accent, rgba(255,255,255,1));\n    --color-text-selection-final: var(--color-text-selection, rgba(104,104,128,0.3));\n  }\n\n  .disabled {\n    pointer-events: none;\n  }\n\n  .relative {\n    position: relative;\n  }\n  .absolute {\n    position: absolute;\n  }\n  .abs-stretch {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n  }\n  .abs-topleft {\n    position: absolute;\n    left: 0;\n    top: 0;\n  }\n  .stretch {\n    width: 100%;\n    height: 100%;\n  }\n  \n  .no-margin {\n    margin: 0;\n  }\n  .no-padding {\n    padding: 0;\n  }\n  .margin-s-5 {\n    margin: 0 5px;\n  }\n\n  #main-container {\n    box-sizing: border-box;\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    justify-content: stretch;\n    align-items: stretch;\n    width: 100%;\n    height: 100%;\n    background: var(--color-bg-final);\n  }\n\n  #top-panel {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    flex-shrink: 0;\n    width: 100%;\n    height: 50px;\n    background: var(--color-primary-final);\n    box-shadow: 0 0 10px var(--color-shadow-final);\n    z-index: 1;\n    transition: height 0.25s ease-out 0.1s;\n  }\n  .hide-panels #top-panel {\n    height: 0;\n    transition: height 0.25s ease-in 0.2s;\n  }\n\n  #bottom-panel {\n    position: absolute;\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    align-items: center;\n    flex-grow: 0;\n    flex-shrink: 0;\n    left: calc(50% - 160px);\n    bottom: 20px;\n    width: 320px;\n    height: 50px;  \n    background: var(--color-primary-tr-final);\n    box-shadow: 0 0 10px var(--color-shadow-final);\n    z-index: 1;\n    transition: height 0.25s ease-out, bottom 0.1s linear 0.25s;\n  }\n  .hide-panels #bottom-panel {\n    bottom: 0;\n    height: 0;\n    transition: bottom 0.1s linear 0.1s, height 0.25s ease-in 0.2s;\n  }\n  \n  #annotation-panel {\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-end;\n    flex-grow: 1;\n    flex-shrink: 1;\n    top: 80px;\n    right: 20px;\n    z-index: -5;\n    transition: z-index 0s linear 0.25s;\n  }\n  .mode-annotation #annotation-panel {\n    z-index: 1;\n  }\n  \n  .annotation-panel-row {      \n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n      flex-grow: 1;\n      flex-shrink: 1;\n    }\n\n  .annotation-panel-item {\n    margin: 3px;\n    cursor: default;      \n    opacity: 0;\n    background: var(--color-primary-tr-final);\n    box-shadow: 0 0 10px var(--color-shadow-final);\n    transform: scale(0);\n    transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n  }    \n  .mode-annotation .annotation-panel-item { \n    cursor: pointer;\n    opacity: 100;\n    transform: scale(1);    \n    transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n  }\n\n  .annotation-panel-subitem {\n    margin: 3px;    \n    background: var(--color-secondary-tr-final);\n    box-shadow: 0 0 10px var(--color-shadow-final);\n  }  \n  :not(.annotation-selected) #button-annotation-delete,\n  :not(.pen-path-present) #button-annotation-pen-undo,\n  :not(.pen-path-present) #button-annotation-pen-clear,\n  :not(.pen-path-present) #button-annotation-pen-save {\n    cursor: default;      \n    opacity: 0;\n    transform: scale(0);\n    transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n  }\n  .annotation-selected #button-annotation-delete,\n  .pen-path-present #button-annotation-pen-undo,\n  .pen-path-present #button-annotation-pen-clear,\n  .pen-path-present #button-annotation-pen-save { \n    cursor: pointer;\n    opacity: 100;\n    transform: scale(1);    \n    transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n  }\n\n  .panel-v-separator {\n    width: 1px;\n    height: 30px;\n    background-color: var(--color-fg-secondary-final);\n  }\n\n  .panel-button {\n    cursor: pointer;\n    user-select: none;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n  }\n  .panel-button:hover,\n  .panel-button.on {\n    background-color: var(--color-accent-final);\n  }\n  .panel-button img {\n    width: 20px;\n    height: 20px;\n    filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-primary-final)) saturate(1000%);\n  }  \n  .panel-button:hover img,\n  .panel-button.on img {\n    filter: invert() opacity(0.5) drop-shadow(0 0 0 var(--color-fg-accent-final)) saturate(1000%);\n  }\n  \n  .subpanel {\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    align-items: center;\n    margin: 0 4px;\n  }    \n  \n  .panel-item {\n    transform: scale(1);\n    transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n  }\n  .hide-panels .panel-item {\n    cursor: default;      \n    opacity: 0;\n    transform: scale(0);\n    transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n  }\n\n  #paginator {  \n    user-select: none;\n    font-family: sans-serif;\n    font-size: 16px;\n    color: var(--color-fg-primary-final);\n  }\n  #paginator-input {\n    text-align: center; \n    font-size: 16px;\n    width: 30px;\n    height: 30px;\n    margin: 2px;\n    padding: 0;\n    outline: none;\n    border: none;\n    color: var(--color-fg-primary-final);\n    background-color: var(--color-primary-final);\n  }\n  #paginator-total {\n    margin: 4px;\n  }\n\n  #toggle-previewer {\n    margin: 4px;\n  }\n    \n  #previewer {\n    box-sizing: border-box;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    overflow-y: auto;\n    left: 0;\n    top: 50px;\n    bottom: 0;\n    width: 160px; \n    padding-top: 0px;\n    background: var(--color-secondary-final);\n    box-shadow: 0 0 10px var(--color-shadow-final);\n    z-index: 1;\n    transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, width 0.25s ease-out;\n  } \n  .hide-panels #previewer {\n    top: 0;\n    padding-top: 50px;\n    transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n  }   \n  .mobile #previewer {\n    background: var(--color-secondary-tr-final);\n  } \n  .hide-previewer #previewer {\n    width: 0;\n    transition: width 0.25s ease-in 0.1s;\n  }\n  #previewer .page-preview {      \n    transform: scaleX(1);\n    transition: opacity 0.1s ease-out 0.35s, transform 0s linear 0.35s;\n  }\n  .hide-previewer #previewer .page-preview {\n    opacity: 0;\n    transform: scaleX(0);\n    transition: opacity 0.1s ease-in, transform 0s linear 0.1s;\n  }\n\n  #viewer {\n    box-sizing: border-box;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    overflow: auto;\n    left: 160px;\n    right: 0;\n    top: 50px;\n    bottom: 0;\n    padding-top: 0;\n    transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-out;\n  }\n  .mode-hand #viewer {\n    cursor: grab !important;\n    user-select: none !important;\n  }\n  .hide-panels #viewer {\n    top: 0;\n    padding-top: 50px;\n    transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s;\n  }      \n  .hide-panels.mobile #viewer,\n  .hide-panels.hide-previewer #viewer {\n    top: 0;\n    padding-top: 50px;\n    left: 0;\n    transition: padding-top 0.25s ease-in 0.2s, top 0.25s ease-in 0.2s, left 0.25s ease-in;\n  }   \n  .mobile #viewer,\n  .hide-previewer #viewer {\n    top: 50px;\n    padding-top: 0px;\n    left: 0;\n    transition: padding-top 0.25s ease-out 0.1s, top 0.25s ease-out 0.1s, left 0.25s ease-in;\n  }\n  \n  #annotation-overlay-container {\n    position: absolute;\n    top: 0; \n    right: 0;\n    bottom: 0;\n    left: 0; \n    margin-top: 0;\n    transition: margin-top 0.25s ease-out 0.1s;\n  }\n  .hide-panels #annotation-overlay-container {\n    margin-top: 50px;\n    transition: margin-top 0.25s ease-in 0.2s;\n  }\n  \n  #annotation-overlay {\n    position: absolute;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    height: 100%;\n    touch-action: none;\n  }\n\n  .page {    \n    position: relative;\n    display: flex;\n    flex-grow: 0;\n    flex-shrink: 0;\n    margin: 10px auto;\n    background-color: white;\n    box-shadow: 0 0 10px var(--color-shadow-final);\n  }\n  .page-preview {   \n    cursor: pointer; \n    position: relative;\n    display: flex;\n    flex-grow: 0;\n    flex-shrink: 0;\n    margin: 0 auto;\n    background-color: white;\n    background-clip: content-box;\n    border-style: solid;\n    border-width: 10px 10px 20px 10px;\n    border-color: transparent;\n  }\n  .page-preview:hover,\n  .page-preview.current {\n    border-color: var(--color-accent-final);\n  }\n  .page-preview::after {\n    display: inline-block;\n    position: absolute;\n    top: calc(100% + 3px);\n    width: 100%;\n    text-align: center;\n    font-family: sans-serif;\n    font-size: 14px;\n    line-height: 1;\n    color: var(--color-fg-primary-final);\n    content: attr(data-page-number) " ";\n  }\n\n  .page-canvas {\n    background-color: white;\n  } \n  \n  .page-text {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n    line-height: 1;\n  }\n  .page-text span {\n    cursor: text;\n    position: absolute;\n    white-space: pre;\n    color: transparent;\n    transform-origin: 0% 0%;\n  }\n  .page-text ::selection {\n    background: var(--color-text-selection-final);\n  }\n  .mode-hand .page-text span {\n    cursor: grab;\n  }\n  \n  .page-annotations {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n  }\n  .mode-text .page-annotations,\n  .mode-hand .page-annotations {\n    pointer-events: none;\n  }\n  \n  #password-dialog {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background: var(--color-secondary-tr-final);\n    z-index: 2;\n  }\n  #password-dialog .form {\n    position: absolute;\n    display: flex;\n    flex-direction: row;\n    justify-content: stretch;\n    align-items: stretch;\n    flex-grow: 0;\n    flex-shrink: 0;\n    left: calc(50% - 160px);\n    top: calc(50% - 25px);\n    width: 320px;\n    height: 50px;  \n    background: var(--color-primary-tr-final);\n    box-shadow: 0 0 10px var(--color-shadow-final);\n  }\n  #password-dialog input {\n    width: 220px;\n    margin: 10px 0 10px 10px;\n    padding: 5px;\n    font-size: 16px;\n    outline: none;\n    border: none;\n    color: var(--color-fg-primary-final);\n    background-color: var(--color-primary-final);\n  }\n  #password-dialog input::placeholder {\n    font-size: 14px;\n    font-style: italic;\n    color: var(--color-fg-primary-final);\n  }\n  #password-dialog .buttons {\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    align-items: center;\n    flex-grow: 1;\n    flex-shrink: 1;\n    width: 100px;\n  } \n\n  .svg-annotation {\n    cursor: pointer;\n  }     \n  .out .svg-annotation {\n    cursor: not-allowed;\n  }\n  .svg-annot-rect,\n  .svg-annot-box {\n    fill: transparent;\n  }\n  .mode-annotation .svg-annotation.selected {\n    cursor: grab;\n  } \n  .mode-annotation .svg-annotation.selected .svg-annot-rect,\n  .mode-annotation .svg-annotation.selected .svg-annot-box {\n    stroke: var(--color-secondary-tr-final);\n    stroke-dasharray: 3 3;\n  } \n  .mode-annotation .svg-annotation.selected .svg-annot-handle-scale,\n  .mode-annotation .svg-annotation.selected .svg-annot-handle-rotation {\n    r: 8;\n    fill: var(--color-primary-final);\n    cursor: pointer;\n  }\n  .mode-annotation .svg-annotation.selected .svg-annot-rotation {\n    fill: none;\n    cursor: pointer;\n  }\n  .mode-annotation .svg-annotation.selected .svg-annot-rotation .circle {\n    r: 25;\n  }\n  .mode-annotation .svg-annotation.selected .svg-annot-rotation .dashed {\n    stroke: var(--color-secondary-tr-final);\n    stroke-dasharray: 3 3;\n  }\n\n  #context-menu {\n    box-sizing: border-box;\n    position: absolute;\n    z-index: 2;\n    min-width: 50px;\n    min-height: 50px;\n    padding: 5px;\n    background: var(--color-secondary-tr-final);\n    box-shadow: 0 0 10px var(--color-shadow-final);\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    align-items: center;\n  }\n  .context-menu-content {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-grow: 1;\n    flex-shrink: 0;\n  }\n  .context-menu-content.row {\n    flex-direction: row;\n  }\n  .context-menu-content.column {\n    flex-direction: column;\n  }\n  .context-menu-color-icon {\n    width: 20px;\n    height: 20px;\n    border-radius: 3px;\n  }\n  .context-menu-stamp-select-button {\n    box-sizing: border-box;\n    cursor: pointer;\n    user-select: none;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-start;\n    width: 100%;\n    height: 36px;\n    padding: 0 5px;\n    border-radius: 5px;\n    font-family: sans-serif;\n    font-size: 16px;\n    color: var(--color-fg-primary-final); \n  }\n  .context-menu-stamp-select-button:hover {\n    background-color: var(--color-accent-final);\n  }\n</style>\n'+c,this.initMainDivs(),this.initViewControls(),this.initModeSwitchButtons(),this.initAnnotationButtons(),document.addEventListener("tspdf-annotchange",this.onAnnotationChange)}initMainDivs(){const t=this._shadowRoot.querySelector("div#main-container"),e=new ResizeObserver((t=>{var e;const{width:n}=this._mainContainer.getBoundingClientRect();n<721?this._mainContainer.classList.add("mobile"):this._mainContainer.classList.remove("mobile"),this._contextMenu.hide(),null===(e=this._annotator)||void 0===e||e.refreshViewBox()}));e.observe(t),this._mainContainer=t,this._mainContainerRObserver=e,this._previewer=this._shadowRoot.querySelector("#previewer"),this._viewer=this._shadowRoot.querySelector("#viewer"),this._contextMenu=new yr,this._viewer.addEventListener("contextmenu",(t=>{this._contextMenuEnabled&&(t.preventDefault(),this._contextMenu.show(new A(t.clientX,t.clientY),this._mainContainer))}))}initViewControls(){const t=this._shadowRoot.getElementById("paginator-input");t.addEventListener("input",this.onPaginatorInput),t.addEventListener("change",this.onPaginatorChange),this._shadowRoot.querySelector("#paginator-prev").addEventListener("click",this.onPaginatorPrevClick),this._shadowRoot.querySelector("#paginator-next").addEventListener("click",this.onPaginatorNextClick),this._shadowRoot.querySelector("#zoom-out").addEventListener("click",this.onZoomOutClick),this._shadowRoot.querySelector("#zoom-in").addEventListener("click",this.onZoomInClick),this._shadowRoot.querySelector("#zoom-fit-viewer").addEventListener("click",this.onZoomFitViewerClick),this._shadowRoot.querySelector("#zoom-fit-page").addEventListener("click",this.onZoomFitPageClick),this._shadowRoot.querySelector("#toggle-previewer").addEventListener("click",this.onPreviewerToggleClick),this._previewer.addEventListener("scroll",this.onPreviewerScroll),this._viewer.addEventListener("scroll",this.onViewerScroll),this._viewer.addEventListener("wheel",this.onViewerWheelZoom),this._viewer.addEventListener("pointermove",this.onViewerPointerMove),this._viewer.addEventListener("pointerdown",this.onViewerPointerDownScroll),this._viewer.addEventListener("touchstart",this.onViewerTouchZoom),this._shadowRoot.querySelector("#button-download-file").addEventListener("click",this.onDownloadFileButtonClick)}initModeSwitchButtons(){this._shadowRoot.querySelector("#button-mode-text").addEventListener("click",this.onTextModeButtonClick),this._shadowRoot.querySelector("#button-mode-hand").addEventListener("click",this.onHandModeButtonClick),this._shadowRoot.querySelector("#button-mode-annotation").addEventListener("click",this.onAnnotationModeButtonClick),this.setViewerMode("text")}initAnnotationButtons(){this._shadowRoot.querySelector("#button-annotation-mode-select").addEventListener("click",this.onAnnotationSelectModeButtonClick),this._shadowRoot.querySelector("#button-annotation-mode-stamp").addEventListener("click",this.onAnnotationStampModeButtonClick),this._shadowRoot.querySelector("#button-annotation-mode-pen").addEventListener("click",this.onAnnotationPenModeButtonClick),this._shadowRoot.querySelector("#button-annotation-delete").addEventListener("click",this.onAnnotationDeleteButtonClick),this._viewer.addEventListener("tspdf-penpathchange",(t=>{t.detail.pathCount?this._mainContainer.classList.add("pen-path-present"):this._mainContainer.classList.remove("pen-path-present")})),this._shadowRoot.querySelector("#button-annotation-pen-undo").addEventListener("click",(()=>{this._annotator instanceof Cr&&this._annotator.undoPath()})),this._shadowRoot.querySelector("#button-annotation-pen-clear").addEventListener("click",(()=>{this._annotator instanceof Cr&&this._annotator.clearPaths()})),this._shadowRoot.querySelector("#button-annotation-pen-save").addEventListener("click",(()=>{this._annotator instanceof Cr&&this._annotator.savePathsAsInkAnnotation()}))}refreshPagesAsync(){var t;return Sr(this,void 0,void 0,(function*(){this._pages.forEach((t=>{t.previewContainer.removeEventListener("click",this.onPreviewerPageClick),t.destroy()})),this._pages.length=0;const e=(null===(t=this._pdfDocument)||void 0===t?void 0:t.numPages)||0;if(this._shadowRoot.getElementById("paginator-total").innerHTML=e+"",e)for(let t=0;t<e;t++){const e=yield this._pdfDocument.getPage(t+1),n=new wr(e,this._docData,this._maxScale,this._previewWidth);n.scale=this._scale,n.previewContainer.addEventListener("click",this.onPreviewerPageClick),this._previewer.append(n.previewContainer),this._viewer.append(n.viewContainer),this._pages.push(n)}}))}scrollToPreview(t){const{top:e,height:n}=this._previewer.getBoundingClientRect(),{top:r,height:s}=this._pages[t].previewContainer.getBoundingClientRect(),i=r+s/2-(e+n/2)+this._previewer.scrollTop;this._previewer.scrollTo(0,i)}setViewerMode(t){if(t&&t!==this._viewerMode){switch(this.disableCurrentViewerMode(),t){case"text":this._mainContainer.classList.add("mode-text"),this._shadowRoot.querySelector("#button-mode-text").classList.add("on");break;case"hand":this._mainContainer.classList.add("mode-hand"),this._shadowRoot.querySelector("#button-mode-hand").classList.add("on");break;case"annotation":this._mainContainer.classList.add("mode-annotation"),this._shadowRoot.querySelector("#button-mode-annotation").classList.add("on");break;default:throw new Error(`Invalid viewer mode: ${t}`)}this._viewerMode=t}}disableCurrentViewerMode(){switch(this._contextMenu.clear(),this._contextMenuEnabled=!1,this._viewerMode){case"text":this._mainContainer.classList.remove("mode-text"),this._shadowRoot.querySelector("#button-mode-text").classList.remove("on");break;case"hand":this._mainContainer.classList.remove("mode-hand"),this._shadowRoot.querySelector("#button-mode-hand").classList.remove("on");break;case"annotation":this._mainContainer.classList.remove("mode-annotation"),this._shadowRoot.querySelector("#button-mode-annotation").classList.remove("on"),this.setAnnotationMode("select")}}scrollToPage(t){const{top:e}=this._viewer.getBoundingClientRect(),{top:n}=this._pages[t].viewContainer.getBoundingClientRect(),r=n-(e-this._viewer.scrollTop);this._viewer.scrollTo(this._viewer.scrollLeft,r)}setScale(t,e=null){if(!t||t===this._scale)return;let n,r,s;if(e)for(const t of this._pages){const{x:i,y:a}=e,{x:o,y:h,width:c,height:d}=t.viewContainer.getBoundingClientRect();if(o<=i&&o+c>=i&&h<=a&&h+d>=a){n=t.viewContainer,r=(i-o)/c,s=(a-h)/d;break}}if(this._contextMenu.hide(),this._scale=t,this._pages.forEach((t=>t.scale=this._scale)),n&&(this._viewer.scrollHeight>this._viewer.clientHeight||this._viewer.scrollWidth>this._viewer.clientWidth)){const{x:t,y:i}=e,{x:a,y:o,width:h,height:c}=n.getBoundingClientRect(),d=a+h*r,l=o+c*s;let p=this._viewer.scrollLeft+(d-t),u=this._viewer.scrollTop+(l-i);if(p=p<0?0:p,u=u<0?0:u,u!==this._viewer.scrollTop||p!==this._viewer.scrollLeft)return void this._viewer.scrollTo(p,u)}setTimeout((()=>this.renderVisiblePages()),0)}zoom(t,e=null){const n=g(this._scale+t,this._minScale,this._maxScale);this.setScale(n,e||this.getViewerCenterPosition())}zoomOut(t=null){this.zoom(-.25,t)}zoomIn(t=null){this.zoom(.25,t)}getViewerCenterPosition(){const{x:t,y:e,width:n,height:r}=this._viewer.getBoundingClientRect();return new A(t+n/2,e+r/2)}getVisiblePages(t,e,n=!1){const r=new Set;if(!e.length)return r;const s=t.getBoundingClientRect(),i=s.top,a=s.top+s.height;for(let t=0;t<e.length;t++){const s=e[t],o=n?s.previewContainer.getBoundingClientRect():s.viewContainer.getBoundingClientRect(),h=o.top,c=o.top+o.height;if(h<a&&c>i)r.add(t);else if(r.size)break}return r}getCurrentPage(t,e,n){const r=[...n];if(!r.length)return-1;if(1===r.length)return r[0];const s=t.getBoundingClientRect(),i=s.top,a=s.top+s.height/2;for(const t of r){const n=e[t].viewContainer.getBoundingClientRect().top;if(n>i)return n>a?t-1:t}throw new Error("Incorrect argument")}renderVisiblePreviews(){if(this._previewerHidden)return;const t=this._pages,e=this.getVisiblePages(this._previewer,t,!0),n=Math.max(Math.min(...e)-this._visibleAdjPages,0),r=Math.min(Math.max(...e)+this._visibleAdjPages,t.length-1);for(let e=0;e<t.length;e++){const s=t[e];e>=n&&e<=r&&s.renderPreviewAsync()}}renderVisiblePages(){var t,e;const n=this._pages,r=this.getVisiblePages(this._viewer,n),s=this._currentPage,i=this.getCurrentPage(this._viewer,n,r);if(-1===i)return;s&&s===i||(null===(t=n[s])||void 0===t||t.previewContainer.classList.remove("current"),null===(e=n[i])||void 0===e||e.previewContainer.classList.add("current"),this._shadowRoot.getElementById("paginator-input").value=i+1+"",this.scrollToPreview(i),this._currentPage=i);const a=Math.max(Math.min(...r)-this._visibleAdjPages,0),o=Math.min(Math.max(...r)+this._visibleAdjPages,n.length-1),h=[];for(let t=0;t<n.length;t++){const e=n[t];h.push(e),t>=a&&t<=o?e.renderViewAsync():e.clearView()}this._renderedPages=h,this.updateAnnotatorPageData()}setAnnotationMode(t){var e;if(t&&t!==this._annotatorMode){switch(this._contextMenu.clear(),this._contextMenuEnabled=!1,null===(e=this._annotator)||void 0===e||e.destroy(),this._annotatorMode){case"select":this._shadowRoot.querySelector("#button-annotation-mode-select").classList.remove("on"),this._docData.setSelectedAnnotation(null);break;case"stamp":this._shadowRoot.querySelector("#button-annotation-mode-stamp").classList.remove("on");break;case"pen":this._shadowRoot.querySelector("#button-annotation-mode-pen").classList.remove("on");break;case"geometric":this._shadowRoot.querySelector("#button-annotation-mode-geometric").classList.remove("on")}switch(this._annotatorMode=t,t){case"select":this._shadowRoot.querySelector("#button-annotation-mode-select").classList.add("on");break;case"stamp":this._shadowRoot.querySelector("#button-annotation-mode-stamp").classList.add("on"),this._annotator=new br(this._docData,this._viewer),this.initContextStampPicker();break;case"pen":this._shadowRoot.querySelector("#button-annotation-mode-pen").classList.add("on"),this._annotator=new Cr(this._docData,this._viewer),this.initContextPenColorPicker();break;case"geometric":this._shadowRoot.querySelector("#button-annotation-mode-geometric").classList.add("on");break;default:throw new Error(`Invalid annotation mode: ${t}`)}this.updateAnnotatorPageData()}}initContextStampPicker(){const t=document.createElement("div");t.classList.add("context-menu-content","column"),[{type:"/Draft",name:"Draft"},{type:"/Approved",name:"Approved"},{type:"/NotApproved",name:"Not Approved"},{type:"/Departmental",name:"Departmental"}].forEach((e=>{const n=document.createElement("div");n.classList.add("context-menu-stamp-select-button"),n.addEventListener("click",(()=>{var t;this._contextMenu.hide(),null===(t=this._annotator)||void 0===t||t.destroy(),this._annotator=new br(this._docData,this._viewer,e.type),this.updateAnnotatorPageData()}));const r=document.createElement("div");r.innerHTML=e.name,n.append(r),t.append(n)})),this._contextMenu.content=t,this._contextMenuEnabled=!0}initContextPenColorPicker(){const t=document.createElement("div");t.classList.add("context-menu-content","row"),[[0,0,0,.5],[.804,0,0,.5],[0,.804,0,.5],[0,0,.804,.5]].forEach((e=>{const n=document.createElement("div");n.classList.add("panel-button"),n.addEventListener("click",(()=>{var t;this._contextMenu.hide(),null===(t=this._annotator)||void 0===t||t.destroy(),this._annotator=new Cr(this._docData,this._viewer,e),this.updateAnnotatorPageData()}));const r=document.createElement("div");r.classList.add("context-menu-color-icon"),r.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`,n.append(r),t.append(n)})),this._contextMenu.content=t,this._contextMenuEnabled=!0}updateAnnotatorPageData(){this._annotator&&(this._annotator.scale=this._scale,this._annotator.renderedPages=this._renderedPages,this._annotator.refreshViewBox())}showPasswordDialogAsync(){return Sr(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{const n=document.createElement("div");n.id="password-dialog",n.innerHTML=d,this._mainContainer.append(n);let r="";const s=this._shadowRoot.getElementById("password-input");s.placeholder="Enter password...",s.addEventListener("change",(()=>r=s.value));const i=()=>{n.remove(),t(null)};n.addEventListener("click",(t=>{t.target===n&&i()})),this._shadowRoot.getElementById("password-ok").addEventListener("click",(()=>{n.remove(),t(r)})),this._shadowRoot.getElementById("password-cancel").addEventListener("click",i)}))}))}}export{lr as AnnotEvent,Pr as TsPdfViewer};
